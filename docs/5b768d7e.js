import{_ as S,a7 as H,L as N,A,r as B,a as P,c as w,q as O,aa as M,b as i,d as b,e as L,p as s,w as u,f as V,g as T,ab as z,a3 as x,ac as G,ad as F,ae as R,F as q,E as U,l as D,t as v,h as E}from"./assets/index-bfb8b166.js";import{P as W}from"./900661ab.js";/* empty css        *//* empty css        *//* empty css        */import{b as j,c as J,E as K,a as Q}from"./0c6f0279.js";import"./ac1fb290.js";import"./d4160b91.js";import"./e9c84fe1.js";import"./bfd91185.js";import"./vander_initCloneObject-e0643cb3.js";import"./c1c5b84c.js";const X={components:{ButtonBox:H,LoadingIcon:N,AsyncButtom:A,PageHeader:W,ElTable:j,ElTableColumn:J,ElRadioGroup:K,ElRadio:Q},setup(){const a=B("/"),l=B("kooritea.github.io"),_=P({}),t=P([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of t)_[e.value]={};const d=w(()=>_[l.value]),f=B(!1),c=P([]),{devMode:y}=O(),o=w(()=>({repo:y.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),C=e=>{c.splice(0,c.length),c.push(...e)},h=w(()=>{const e=[...d.value[a.value]||[]];return!f.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,m)=>{if(a.value=e,!d.value[e]||m)return d.value[e]=void 0,f.value=!0,z({...o.value,path:e}).then(p=>{p.type==="dir"&&(d.value[e]=[...p.children.filter(k=>k.type==="dir"),...p.children.filter(k=>k.type==="file")])}).finally(()=>{f.value=!1})};r("/"),M(l,()=>{r("/")});const g=e=>{x({title:"提示",message:`确认删除${e.length>1?`选中的${e.length}个文件`:e[0].name}`,type:"warning",confirmHandlerPromise:m=>G({...o.value,files:e.map(p=>({isDel:!0,path:p.path}))}).then(()=>r(a.value,!0))})};return{dataBaseList:t,onSelectionChange:C,repoConfig:o,tableData:h,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>x({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:m=>R({...o.value,branch:void 0,file:e[0]}).then(({sha:p})=>G({...o.value,files:[{sha:p,path:m.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:m=>!!m,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",confirm:!1,disabled:()=>c.length===0,handler:()=>g(c)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in d.value)delete d.value[e];return r("/")}}],deleteItem:g,deleteDir:e=>{x({title:"提示",message:`确认删除${e}`,type:"warning",confirmHandlerPromise:m=>F({...o.value,dir:e}).then(()=>r(a.value,!0))})},database:l}},methods:{onCellClick(a,l,_,t){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},Y={class:"page"};function Z(a,l,_,t,d,f){const c=i("PageHeader"),y=i("el-radio"),o=i("el-radio-group"),C=i("LoadingIcon"),h=i("el-table-column"),r=i("AsyncButtom"),g=i("el-table"),I=i("ButtonBox");return b(),L("div",Y,[s(c),s(o,{modelValue:t.database,"onUpdate:modelValue":l[0]||(l[0]=n=>t.database=n)},{default:u(()=>[(b(!0),L(q,null,U(t.dataBaseList,n=>(b(),V(y,{key:n.value,value:n.value,size:"large"},{default:u(()=>[D(v(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(g,{border:"",data:t.tableData,style:{width:"100%"},onCellClick:f.onCellClick,onSelectionChange:t.onSelectionChange},{empty:u(()=>[E("div",null,[s(C)])]),default:u(()=>[s(h,{type:"selection",selectable:n=>n.type==="file"},null,8,["selectable"]),s(h,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{header:u(()=>[D(" ["+v(t.currentPath.startsWith("/")?"":"/")+v(t.currentPath)+"]文件名 ",1)]),default:u(n=>[E("span",null,v(n.row.type==="dir"?"📁":"📄")+v(n.row.name),1)]),_:1}),s(h,{label:"操作",width:"120px"},{default:u(n=>[s(r,{type:"danger",size:"mini",confirm:!1,onLoadingClick:()=>n.row.type==="dir"?t.deleteDir(n.row.path):t.deleteItem([n.row])},{default:u(()=>l[1]||(l[1]=[D(" 删除 ")])),_:2},1032,["onLoadingClick"])]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),t.handlers.length>0?(b(),V(I,{key:0,handlers:t.handlers},null,8,["handlers"])):T("",!0)])}const ce=S(X,[["render",Z],["__scopeId","data-v-53a102d9"]]);export{ce as default};
