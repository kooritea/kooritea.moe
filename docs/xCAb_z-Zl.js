import{_ as L,aa as O,M as K,f8 as z,f9 as W,j as f,k as d,d as S,w as V,b as v,e as D,f as c,l as P,z as y,S as T,A as N,p as G,a as R,r as w,F as x,B as U,t as k,n as $,fa as q,fb as J,fc as Q,a1 as I,fd as X,bc as Y,a6 as Z,u as ee,O as oe,al as te,am as ae,ad as le,c as se,fe as ne,T as re,cx as ie,W as de,b6 as ce,a2 as ue,ff as me,fg as fe,fh as j,fi as pe}from"./assets/index-CvIYzVtv.js";import{P as he}from"./x4k-nu6eF.js";import{E as F}from"./xIi9-x1Xr.js";import{M as ge}from"./xDE6Pu_SN.js";import{I as ve}from"./xBllqSTRu.js";/* empty css         *//* empty css         *//* empty css         *//* empty css         */import{E as ye,a as _e}from"./xHwUBrbrA.js";/* empty css         */import{E as Ve}from"./xDjopf8xY.js";import{E as be}from"./xDKFoUa4r.js";const we={components:{ElDialog:F,ButtonBox:O,AsyncSwitch:K,PreviewScreenshots:he},data(){return{dialogVisible:!1,resolve:null,reject:null,file:null,sourceSrc:null,sourceKeyname:null,screenshots:"00:00:00.0",isLoop:!1,handlers:[{name:"返回",type:"default",handler:()=>{this.reject()}},{name:"确认",type:"primary",handler:async()=>{const l=await z(await this.$refs.PreviewScreenshots.getScreenshots(this.screenshots,"png"),"thumbnail.png");return this.resolve({thumbnail:l,file:this.file,isLoop:this.isLoop})}}]}},methods:{async open({callback:l,file:e}={}){return this.dialogVisible=!0,this.file=e,this.sourceSrc=URL.createObjectURL(e),this.sourceKeyname=await W(e),this.screenshots="00:00:00.0",this.isLoop=!1,new Promise((s,t)=>{this.resolve=o=>{if(this.reject=null,l){const u=l(o);return Promise.resolve(u).then(()=>{s(o)})}else s(o)},this.reject=o=>{t(o)}}).finally(()=>{this.dialogVisible=!1})}}},Ee=["loop","src"],Se={class:"cell"};function Me(l,e,s,t,o,u){const p=f("PreviewScreenshots"),h=f("AsyncSwitch"),g=f("ButtonBox"),_=f("el-dialog");return d(),S(_,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[3]||(e[3]=m=>o.dialogVisible=m),top:"10px",class:"fv4w4f5616f5wefew",title:"视频上传","lock-scroll":!0,"close-on-click-modal":!1,"before-close":m=>{o.reject&&(m(),o.reject())}},{default:V(()=>[o.dialogVisible?(d(),v("video",{key:0,class:"video",controls:"",preload:"none",loop:o.isLoop,src:o.sourceSrc,onError:e[0]||(e[0]=m=>{l.$message({type:"error",message:"视频播放失败",duration:5e3})})},null,40,Ee)):D("",!0),o.dialogVisible?(d(),S(p,{key:1,ref:"PreviewScreenshots",modelValue:o.screenshots,"onUpdate:modelValue":e[1]||(e[1]=m=>o.screenshots=m),sourceKeyname:o.sourceKeyname},null,8,["modelValue","sourceKeyname"])):D("",!0),c("div",Se,[e[4]||(e[4]=P(" 循环播放： ")),y(h,{modelValue:o.isLoop,"onUpdate:modelValue":e[2]||(e[2]=m=>o.isLoop=m)},null,8,["modelValue"])]),y(g,{handlers:o.handlers},null,8,["handlers"])]),_:1},8,["modelValue","before-close"])}const De=L(we,[["render",Me],["__scopeId","data-v-63f04aac"]]),ke={components:{SvgIcon:T,ImageCon:ve,AsyncButtom:N,ElDialog:F,ElSelect:ye,ElOption:_e},props:{init:{type:Boolean,default:!0},safeMode:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:e}){const{emoteHistory:s}=G(),t=R({name:"history",emote:s.value}),o=R([]),u=w("history"),p=n=>{if(u.value=n.name,n.emote.length===0)return q(n.name).then(r=>{u.value=n.name,n.emote=r.emote.map(i=>({...i,scope:n.name}))})},h=()=>{o.splice(0,o.length),o.push(t),J().then(n=>{o.push(...n.sort((r,i)=>{const b=s.value.findIndex(B=>B.scope===r.name),C=s.value.findIndex(B=>B.scope===i.name);return(b===-1?1/0:b)-(C===-1?1/0:C)})),l.safeMode||o.push({name:"add",emote:[]})})};h();const g=n=>{e("select",n),s.value=s.value.filter(r=>!(r.scope===n.scope&&r.name===n.name)),s.value=[n,...s.value].slice(0,30),t.emote=s.value},_=w(!1),m=n=>Q(n).then(()=>{I.success("添加成功"),h()}),E=w(null),a=w([]),M=w(!1);return{onSelect:g,currentScope:u,emotePackages:o,selectScope:p,addEmotePackage:m,addEmoteDialogVisible:_,addEmoteDialogValue:E,addEmoteDialogOptions:a,addEmoteDialogRemoteMethod:n=>{n?(M.value=!0,X(n).then(r=>{a.value=r.map(i=>({...i,label:i.text,value:i.id})),M.value=!1})):(a.value=[],M.value=!1)},addEmoteDialogLoading:M}}},Be={class:"emote-selector"},xe={class:"emotes"},He={class:"scopes"},Ie=["onClick"],Ce={class:"option"},Ue={class:"info-box"},Ae={class:"label"},Pe={class:"value"},Le={class:"dialog-footer"};function Re(l,e,s,t,o,u){const p=f("ImageCon"),h=f("SvgIcon"),g=f("el-option"),_=f("el-select"),m=f("AsyncButtom"),E=f("el-dialog");return d(),v("div",Be,[c("div",xe,[(d(!0),v(x,null,U((t.emotePackages.find(a=>a.name===t.currentScope)||{}).emote||[],a=>(d(),S(p,{key:a.name,class:"emote",alt:a.name,src:`/emoji/${a.scope}/${a.name}.png`,onClick:M=>t.onSelect(a)},{error:V(()=>[c("span",null,k(a.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),c("div",He,[(d(!0),v(x,null,U(t.emotePackages,a=>(d(),v("div",{key:a.name,class:$(["scope",{"selected-scope":t.currentScope===a.name}]),onClick:()=>{a.name==="add"?t.addEmoteDialogVisible=!0:t.selectScope(a)}},[a.name==="history"?(d(),S(h,{key:0,class:"emote history",name:"icon-time"})):a.name==="add"?(d(),S(h,{key:1,class:"emote history",name:"add"})):(d(),S(p,{key:2,class:"emote",src:`/emoji/${a.name}/${a.name}.png`},{error:V(()=>[c("span",null,k(a.name),1)]),_:2},1032,["src"]))],10,Ie))),128))]),y(E,{modelValue:t.addEmoteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=a=>t.addEmoteDialogVisible=a),title:"添加表情包","close-on-click-modal":!1,"append-to-body":""},{footer:V(()=>[c("div",Le,[y(m,{type:"primary",size:"mini",onLoadingClick:()=>{t.addEmoteDialogVisible=!1}},{default:V(()=>e[2]||(e[2]=[P(" 取消 ")])),_:1},8,["onLoadingClick"]),y(m,{type:"primary",size:"mini",onLoadingClick:()=>(t.addEmoteDialogVisible=!1,t.addEmotePackage(t.addEmoteDialogValue))},{default:V(()=>e[3]||(e[3]=[P(" 确认 ")])),_:1},8,["onLoadingClick"])])]),default:V(()=>[y(_,{modelValue:t.addEmoteDialogValue,"onUpdate:modelValue":e[0]||(e[0]=a=>t.addEmoteDialogValue=a),filterable:"",remote:"","remote-method":t.addEmoteDialogRemoteMethod,loading:t.addEmoteDialogLoading,"popper-class":"add-emote-selector"},{default:V(()=>[(d(!0),v(x,null,U(t.addEmoteDialogOptions,a=>(d(),S(g,{key:a.value,label:a.label,value:a.value},{default:V(()=>[c("div",Ce,[c("div",Ue,[c("div",Ae,k(a.label),1),c("div",Pe,k(a.value),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","loading"])]),_:1},8,["modelValue"])])}const je=L(ke,[["render",Re],["__scopeId","data-v-3b808619"]]);function Oe(l){const e=w(null),s=Y(Ve,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:e.value,"onUpdate:modelValue":t=>{var o;e.value=t,(o=s.component)!=null&&o.props&&(s.component.props.modelValue=t)}});Z({title:"选择预约时间",message:s,confirmHandlerPromise:t=>l(e),inputValidator:t=>!!e.value,inputErrorMessage:"请选择预约时间"})}const A={},Te={components:{SvgIcon:T,Markdown:ge,ButtonBox:O,EmoteSelector:je,ElPopover:be,VideoUploader:De},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},safeMode:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(l,{emit:e}){const{darkMode:s}=ee(),t=w(!0),{computedModelValue:o}=oe(l,e),u=w(!1),p=w(null);if(l.cache){const n=ue();if(A[n.fullPath]&&l.cache===!0)I.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const r="MDEditorCache."+(l.cache===!0?n.fullPath:`${n.fullPath}.${l.cache}`);o.value=localStorage.getItem(r)||l.defaultValue,te(()=>{A[r]=!0}),ae(()=>{A[r]=!1});const i=pe(()=>{u.value=!0,localStorage.setItem(r,o.value||"")},1e3);le(o,()=>{u.value=!1,i()})}}const h=n=>{const r=p.value.selectionStart,i=o.value.slice(0,r),b=o.value.slice(r);o.value=`${i}${n}${b}`},g=w(o.value),_=({reservationDate:n}={})=>{const r=l.onSubmit(o.value,n==null?void 0:n.value);return r instanceof Promise?r.then(()=>{o.value=l.defaultValue||"",g.value=l.defaultValue||""}):(o.value=l.defaultValue||"",g.value=l.defaultValue||""),r},m=()=>{o.value=""},E=()=>{o.value=g.value},a=[{name:"提交",type:"primary",handler:_,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("submit"):l.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{Oe(n=>{_({reservationDate:n})})},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reservation"):l.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:m,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("clean"):l.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:E,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reset"):l.showDefaultHandlers)&&!!g.value,sort:30}],M=se(()=>[...a,...l.exHandlers]),H=n=>{const r=me(URL.createObjectURL(n),{handlers:[{name:"上传",type:"primary",handler:()=>{const i=new Date().valueOf().toString();h(`![${i}](--------------------)`),fe(n,b=>{const B=Math.round(100*b.loaded/b.total)/10*2;o.value=o.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${i}](${"#".repeat(B)}${"-".repeat(20-B)})`)}).then(b=>{o.value=o.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${b.keyname}](${b.local})`)}).catch(()=>{o.value=o.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),"")}),r.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{j(n,16,9).then(i=>{r.callClose(),H(i)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{j(n,160,67).then(i=>{r.callClose(),H(i)})}},{name:"取消",type:"default",handler:()=>{r.callClose()}}]})};return{darkMode:s,isEditMode:t,computedModelValue:o,resetCache:g,isSave:u,handlers:M,submitHandler:_,cleanHandler:m,resetHandler:E,previewImageBeforeUpload:H,textarea:p,insertText:h}},methods:{pasteHandler(l){if(!(l.clipboardData&&l.clipboardData.items))return;const e=Array.from(l.clipboardData.items).filter(s=>s.kind==="file");if(e.length===1){l.preventDefault();for(const s of e)if(s.type.startsWith("image/")){this.previewImageBeforeUpload(s.getAsFile());return}else if(s.type.startsWith("video/")){this.previewVideoBeforeUpload(s.getAsFile());return}else I.warning(`不支持的文件类型: ${s.type}`)}},dropHandler(l){for(const e of l.dataTransfer.files)if(l.preventDefault(),e.type.startsWith("image/")){this.previewImageBeforeUpload(e);return}else if(e.type.startsWith("video/")){this.previewVideoBeforeUpload(e.getAsFile());return}else I.warning(`不支持的文件类型: ${e.type}`)},previewVideoBeforeUpload(l){this.$refs.VideoUploader.open({file:l,callback:e=>{const s=new Date().valueOf().toString(),t=e.isLoop?"video-loop":"video";this.insertText(`[${t} ${s}](--------------------)`),ne(l,o=>{const p=Math.round(100*o.loaded/o.total)/10*2;this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${t} ${s}]\\((#*?)(-*?)\\)`),`[${t} ${s}](${"#".repeat(p)}${"-".repeat(20-p)})`)},e.thumbnail).then(o=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${t} ${s}]\\((#*?)(-*?)\\)`),`[${t} ${o.local}]`)}).catch(()=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${t} ${s}]\\((#*?)(-*?)\\)`),"")})}})}}},$e={class:"fill"},Fe=["disabled"],Ke={key:1,class:"preview"},ze={class:"bar"},We={class:"bar-left"},Ne={class:"title"},Ge={key:0,class:"uploader"},qe={key:1,class:"uploader"},Je={class:"bar-right"},Qe={key:0,class:"is-save info"};function Xe(l,e,s,t,o,u){const p=f("Markdown"),h=f("SvgIcon"),g=f("EmoteSelector"),_=f("el-popover"),m=f("ButtonBox"),E=f("VideoUploader");return d(),v(x,null,[c("div",ce({class:"md-editor"},l.$attrs),[t.isEditMode?(d(),v("div",{key:0,class:$(["textarea-box",{"auto-height":s.autoHeight}])},[c("pre",$e,k(t.computedModelValue),1),re(c("textarea",{ref:"textarea","onUpdate:modelValue":e[0]||(e[0]=a=>t.computedModelValue=a),class:"textarea",disabled:s.disabled,onPaste:e[1]||(e[1]=(...a)=>u.pasteHandler&&u.pasteHandler(...a)),onDragover:e[2]||(e[2]=de(()=>{},["prevent"])),onDrop:e[3]||(e[3]=(...a)=>u.dropHandler&&u.dropHandler(...a))},null,40,Fe),[[ie,t.computedModelValue]])],2)):(d(),v("div",Ke,[y(p,{"model-value":t.computedModelValue,safeMode:s.safeMode},null,8,["model-value","safeMode"])])),c("div",ze,[c("div",We,[s.disabled?D("",!0):(d(),v(x,{key:0},[c("div",Ne,k(s.title),1),s.safeMode?D("",!0):(d(),v("label",Ge,[y(h,{class:"button",name:"14"}),c("input",{type:"file",accept:"image/*",onChange:e[4]||(e[4]=a=>{t.previewImageBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)])),s.safeMode?D("",!0):(d(),v("label",qe,[y(h,{class:"button",name:"video"}),c("input",{type:"file",accept:"video/*",onChange:e[5]||(e[5]=a=>{u.previewVideoBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)])),y(_,{width:"auto",trigger:"click",effect:t.darkMode?"dark":"light"},{reference:V(()=>[y(h,{class:"button",name:"biaoqing"})]),default:V(()=>[y(g,{safeMode:s.safeMode,onSelect:e[6]||(e[6]=a=>{t.insertText(`[emoji ${a.scope}/${a.name}]`)})},null,8,["safeMode"])]),_:1},8,["effect"])],64))]),c("div",Je,[t.isSave?(d(),v("span",Qe,"已保存")):D("",!0),c("span",{class:"preview-switch button",onClick:e[7]||(e[7]=a=>t.isEditMode=!t.isEditMode)},k(t.isEditMode?"预览":"返回编辑"),1)])])],16),t.handlers.length>0?(d(),S(m,{key:0,handlers:t.handlers},null,8,["handlers"])):D("",!0),y(E,{ref:"VideoUploader"},null,512)],64)}const Ye=L(Te,[["render",Xe],["__scopeId","data-v-a40fff88"]]),fo=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{Ye as M,fo as a,Oe as u};
