import{_ as L,a9 as $,K as F,g7 as z,g8 as N,j as p,k as c,d as S,w as _,b as V,e as M,f as i,l as P,z as v,S as O,A as W,p as G,a as R,r as w,F as x,B as U,t as k,n as K,g9 as q,ga as J,gb as Q,a0 as I,gc as X,b7 as Y,a5 as Z,u as ee,N as te,ak as oe,al as ae,ac as le,c as se,gd as ne,R as re,cs as ie,V as de,a$ as ce,a1 as ue,ge as me,gf as pe,gg as j,gh as fe}from"./assets/index-D_LFPdhH.js";import{P as he}from"./xD7UGavlf.js";import{E as T}from"./x4effQY_8.js";import{M as ge}from"./xVljz32n8.js";import{I as ve}from"./xCYmYNvJy.js";/* empty css         *//* empty css         *//* empty css         *//* empty css         */import{E as ye,a as _e}from"./xBEF20XvS.js";/* empty css         */import{E as Ve}from"./xjg0qRPOi.js";import{E as be}from"./xCfxBK22m.js";const we={components:{ElDialog:T,ButtonBox:$,AsyncSwitch:F,PreviewScreenshots:he},data(){return{dialogVisible:!1,resolve:null,reject:null,file:null,sourceSrc:null,sourceKeyname:null,screenshots:"00:00:00.0",isLoop:!1,handlers:[{name:"返回",type:"default",handler:()=>{this.reject()}},{name:"确认",type:"primary",handler:async()=>{const l=await z(await this.$refs.PreviewScreenshots.getScreenshots(this.screenshots,"png"),"thumbnail.png");return this.resolve({thumbnail:l,file:this.file,isLoop:this.isLoop})}}]}},methods:{async open({callback:l,file:e}={}){return this.dialogVisible=!0,this.file=e,this.sourceSrc=URL.createObjectURL(e),this.sourceKeyname=await N(e),this.screenshots="00:00:00.0",this.isLoop=!1,new Promise((s,o)=>{this.resolve=t=>{if(this.reject=null,l){const u=l(t);return Promise.resolve(u).then(()=>{s(t)})}else s(t)},this.reject=t=>{o(t)}}).finally(()=>{this.dialogVisible=!1})}}},Ee=["loop","src"],Se={class:"cell"};function De(l,e,s,o,t,u){const f=p("PreviewScreenshots"),h=p("AsyncSwitch"),g=p("ButtonBox"),y=p("el-dialog");return c(),S(y,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[3]||(e[3]=m=>t.dialogVisible=m),top:"10px",class:"fv4w4f5616f5wefew",title:"视频上传","lock-scroll":!0,"close-on-click-modal":!1,"before-close":m=>{t.reject&&(m(),t.reject())}},{default:_(()=>[t.dialogVisible?(c(),V("video",{key:0,class:"video",controls:"",preload:"none",loop:t.isLoop,src:t.sourceSrc,onError:e[0]||(e[0]=m=>{l.$message({type:"error",message:"视频播放失败",duration:5e3})})},null,40,Ee)):M("",!0),t.dialogVisible?(c(),S(f,{key:1,ref:"PreviewScreenshots",modelValue:t.screenshots,"onUpdate:modelValue":e[1]||(e[1]=m=>t.screenshots=m),sourceKeyname:t.sourceKeyname},null,8,["modelValue","sourceKeyname"])):M("",!0),i("div",Se,[e[4]||(e[4]=P(" 循环播放： ")),v(h,{modelValue:t.isLoop,"onUpdate:modelValue":e[2]||(e[2]=m=>t.isLoop=m)},null,8,["modelValue"])]),v(g,{handlers:t.handlers},null,8,["handlers"])]),_:1},8,["modelValue","before-close"])}const ke=L(we,[["render",De],["__scopeId","data-v-63f04aac"]]),Be={components:{SvgIcon:O,ImageCon:ve,AsyncButtom:W,ElDialog:T,ElSelect:ye,ElOption:_e},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(l,{emit:e}){const{emoteHistory:s}=G(),o=R({name:"history",emote:s.value}),t=R([]),u=w("history"),f=n=>{if(u.value=n.name,n.emote.length===0)return q(n.name).then(r=>{u.value=n.name,n.emote=r.emote.map(d=>({...d,scope:n.name}))})},h=()=>{t.splice(0,t.length),t.push(o),J().then(n=>{t.push(...n.sort((r,d)=>{const b=s.value.findIndex(B=>B.scope===r.name),C=s.value.findIndex(B=>B.scope===d.name);return(b===-1?1/0:b)-(C===-1?1/0:C)})),t.push({name:"add",emote:[]})})};h();const g=n=>{e("select",n),s.value=s.value.filter(r=>!(r.scope===n.scope&&r.name===n.name)),s.value=[n,...s.value].slice(0,30),o.emote=s.value},y=w(!1),m=n=>Q(n).then(()=>{I.success("添加成功"),h()}),E=w(null),a=w([]),D=w(!1);return{onSelect:g,currentScope:u,emotePackages:t,selectScope:f,addEmotePackage:m,addEmoteDialogVisible:y,addEmoteDialogValue:E,addEmoteDialogOptions:a,addEmoteDialogRemoteMethod:n=>{n?(D.value=!0,X(n).then(r=>{a.value=r.map(d=>({...d,label:d.text,value:d.id})),D.value=!1})):(a.value=[],D.value=!1)},addEmoteDialogLoading:D}}},Me={class:"emote-selector"},xe={class:"emotes"},He={class:"scopes"},Ie=["onClick"],Ce={class:"option"},Ue={class:"info-box"},Ae={class:"label"},Pe={class:"value"},Le={class:"dialog-footer"};function Re(l,e,s,o,t,u){const f=p("ImageCon"),h=p("SvgIcon"),g=p("el-option"),y=p("el-select"),m=p("AsyncButtom"),E=p("el-dialog");return c(),V("div",Me,[i("div",xe,[(c(!0),V(x,null,U((o.emotePackages.find(a=>a.name===o.currentScope)||{}).emote||[],a=>(c(),S(f,{key:a.name,class:"emote",alt:a.name,src:`/emoji/${a.scope}/${a.name}.png`,onClick:D=>o.onSelect(a)},{error:_(()=>[i("span",null,k(a.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),i("div",He,[(c(!0),V(x,null,U(o.emotePackages,a=>(c(),V("div",{key:a.name,class:K(["scope",{"selected-scope":o.currentScope===a.name}]),onClick:()=>{a.name==="add"?o.addEmoteDialogVisible=!0:o.selectScope(a)}},[a.name==="history"?(c(),S(h,{key:0,class:"emote history",name:"icon-time"})):a.name==="add"?(c(),S(h,{key:1,class:"emote history",name:"add"})):(c(),S(f,{key:2,class:"emote",src:`/emoji/${a.name}/${a.name}.png`},{error:_(()=>[i("span",null,k(a.name),1)]),_:2},1032,["src"]))],10,Ie))),128))]),v(E,{modelValue:o.addEmoteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=a=>o.addEmoteDialogVisible=a),title:"添加表情包","close-on-click-modal":!1,"append-to-body":""},{footer:_(()=>[i("div",Le,[v(m,{type:"primary",size:"mini",onLoadingClick:()=>{o.addEmoteDialogVisible=!1}},{default:_(()=>e[2]||(e[2]=[P(" 取消 ")])),_:1},8,["onLoadingClick"]),v(m,{type:"primary",size:"mini",onLoadingClick:()=>(o.addEmoteDialogVisible=!1,o.addEmotePackage(o.addEmoteDialogValue))},{default:_(()=>e[3]||(e[3]=[P(" 确认 ")])),_:1},8,["onLoadingClick"])])]),default:_(()=>[v(y,{modelValue:o.addEmoteDialogValue,"onUpdate:modelValue":e[0]||(e[0]=a=>o.addEmoteDialogValue=a),filterable:"",remote:"","remote-method":o.addEmoteDialogRemoteMethod,loading:o.addEmoteDialogLoading,"popper-class":"add-emote-selector"},{default:_(()=>[(c(!0),V(x,null,U(o.addEmoteDialogOptions,a=>(c(),S(g,{key:a.value,label:a.label,value:a.value},{default:_(()=>[i("div",Ce,[i("div",Ue,[i("div",Ae,k(a.label),1),i("div",Pe,k(a.value),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","loading"])]),_:1},8,["modelValue"])])}const je=L(Be,[["render",Re],["__scopeId","data-v-b52e3bf9"]]);function $e(l){const e=w(null),s=Y(Ve,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:e.value,"onUpdate:modelValue":o=>{var t;e.value=o,(t=s.component)!=null&&t.props&&(s.component.props.modelValue=o)}});Z({title:"选择预约时间",message:s,confirmHandlerPromise:o=>l(e),inputValidator:o=>!!e.value,inputErrorMessage:"请选择预约时间"})}const A={},Oe={components:{SvgIcon:O,Markdown:ge,ButtonBox:$,EmoteSelector:je,ElPopover:be,VideoUploader:ke},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(l,{emit:e}){const{darkMode:s}=ee(),o=w(!0),{computedModelValue:t}=te(l,e),u=w(!1),f=w(null);if(l.cache){const n=ue();if(A[n.fullPath]&&l.cache===!0)I.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const r="MDEditorCache."+(l.cache===!0?n.fullPath:`${n.fullPath}.${l.cache}`);t.value=localStorage.getItem(r)||l.defaultValue,oe(()=>{A[r]=!0}),ae(()=>{A[r]=!1});const d=fe(()=>{u.value=!0,localStorage.setItem(r,t.value||"")},1e3);le(t,()=>{u.value=!1,d()})}}const h=n=>{const r=f.value.selectionStart,d=t.value.slice(0,r),b=t.value.slice(r);t.value=`${d}${n}${b}`},g=w(t.value),y=({reservationDate:n}={})=>{const r=l.onSubmit(t.value,n==null?void 0:n.value);return r instanceof Promise?r.then(()=>{t.value=l.defaultValue||"",g.value=l.defaultValue||""}):(t.value=l.defaultValue||"",g.value=l.defaultValue||""),r},m=()=>{t.value=""},E=()=>{t.value=g.value},a=[{name:"提交",type:"primary",handler:y,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("submit"):l.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{$e(n=>{y({reservationDate:n})})},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reservation"):l.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:m,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("clean"):l.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:E,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reset"):l.showDefaultHandlers)&&!!g.value,sort:30}],D=se(()=>[...a,...l.exHandlers]),H=n=>{const r=me(URL.createObjectURL(n),{handlers:[{name:"上传",type:"primary",handler:()=>{const d=new Date().valueOf().toString();h(`![${d}](--------------------)`),pe(n,b=>{const B=Math.round(100*b.loaded/b.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),`![${d}](${"#".repeat(B)}${"-".repeat(20-B)})`)}).then(b=>{t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),`![${b.keyname}](${b.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),"")}),r.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{j(n,16,9).then(d=>{r.callClose(),H(d)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{j(n,160,67).then(d=>{r.callClose(),H(d)})}},{name:"取消",type:"default",handler:()=>{r.callClose()}}]})};return{darkMode:s,isEditMode:o,computedModelValue:t,resetCache:g,isSave:u,handlers:D,submitHandler:y,cleanHandler:m,resetHandler:E,previewImageBeforeUpload:H,textarea:f,insertText:h}},methods:{pasteHandler(l){if(!(l.clipboardData&&l.clipboardData.items))return;const e=Array.from(l.clipboardData.items).filter(s=>s.kind==="file");if(e.length===1){l.preventDefault();for(const s of e)if(s.type.startsWith("image/")){this.previewImageBeforeUpload(s.getAsFile());return}else if(s.type.startsWith("video/")){this.previewVideoBeforeUpload(s.getAsFile());return}else I.warning(`不支持的文件类型: ${s.type}`)}},dropHandler(l){for(const e of l.dataTransfer.files)if(l.preventDefault(),e.type.startsWith("image/")){this.previewImageBeforeUpload(e);return}else if(e.type.startsWith("video/")){this.previewVideoBeforeUpload(e.getAsFile());return}else I.warning(`不支持的文件类型: ${e.type}`)},previewVideoBeforeUpload(l){this.$refs.VideoUploader.open({file:l,callback:e=>{const s=new Date().valueOf().toString(),o=e.isLoop?"video-loop":"video";this.insertText(`[${o} ${s}](--------------------)`),ne(l,t=>{const f=Math.round(100*t.loaded/t.total)/10*2;this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),`[${o} ${s}](${"#".repeat(f)}${"-".repeat(20-f)})`)},e.thumbnail).then(t=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),`[${o} ${t.local}]`)}).catch(()=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),"")})}})}}},Ke={class:"fill"},Te=["disabled"],Fe={key:1,class:"preview"},ze={class:"bar"},Ne={class:"bar-left"},We={class:"title"},Ge={class:"uploader"},qe={class:"uploader"},Je={class:"bar-right"},Qe={key:0,class:"is-save info"};function Xe(l,e,s,o,t,u){const f=p("Markdown"),h=p("SvgIcon"),g=p("EmoteSelector"),y=p("el-popover"),m=p("ButtonBox"),E=p("VideoUploader");return c(),V(x,null,[i("div",ce({class:"md-editor"},l.$attrs),[o.isEditMode?(c(),V("div",{key:0,class:K(["textarea-box",{"auto-height":s.autoHeight}])},[i("pre",Ke,k(o.computedModelValue),1),re(i("textarea",{ref:"textarea","onUpdate:modelValue":e[0]||(e[0]=a=>o.computedModelValue=a),class:"textarea",disabled:s.disabled,onPaste:e[1]||(e[1]=(...a)=>u.pasteHandler&&u.pasteHandler(...a)),onDragover:e[2]||(e[2]=de(()=>{},["prevent"])),onDrop:e[3]||(e[3]=(...a)=>u.dropHandler&&u.dropHandler(...a))},null,40,Te),[[ie,o.computedModelValue]])],2)):(c(),V("div",Fe,[v(f,{"model-value":o.computedModelValue},null,8,["model-value"])])),i("div",ze,[i("div",Ne,[s.disabled?M("",!0):(c(),V(x,{key:0},[i("div",We,k(s.title),1),i("label",Ge,[v(h,{class:"button",name:"14"}),i("input",{type:"file",accept:"image/*",onChange:e[4]||(e[4]=a=>{o.previewImageBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)]),i("label",qe,[v(h,{class:"button",name:"video"}),i("input",{type:"file",accept:"video/*",onChange:e[5]||(e[5]=a=>{u.previewVideoBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)]),v(y,{width:"auto",trigger:"click",effect:o.darkMode?"dark":"light"},{reference:_(()=>[v(h,{class:"button",name:"biaoqing"})]),default:_(()=>[v(g,{onSelect:e[6]||(e[6]=a=>{o.insertText(`[emoji ${a.scope}/${a.name}]`)})})]),_:1},8,["effect"])],64))]),i("div",Je,[o.isSave?(c(),V("span",Qe,"已保存")):M("",!0),i("span",{class:"preview-switch button",onClick:e[7]||(e[7]=a=>o.isEditMode=!o.isEditMode)},k(o.isEditMode?"预览":"返回编辑"),1)])])],16),o.handlers.length>0?(c(),S(m,{key:0,handlers:o.handlers},null,8,["handlers"])):M("",!0),v(E,{ref:"VideoUploader"},null,512)],64)}const Ye=L(Oe,[["render",Xe],["__scopeId","data-v-24118e5a"]]),mt=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{Ye as M,mt as a,$e as u};
