import{P as A}from"./54c4fd6d.js";import{_ as B,X as C,A as P,u as E,q as V,Y as I,Z as T,r as g,b as p,d as L,e as S,p as d,h as w,w as k,$ as D,a0 as H,l as K}from"./assets/index-72082f34.js";const U={components:{PageHeader:A,TextInput:C,AsyncButtom:P},setup(){const{temporaryPublicKey:m}=E(),{usernameCache:a,accessKey:y,accessExp:s,isExpiredGreatOldOne:_}=V(),f=I(),l=T(),r=g(a.value),u=g("");function c(e){const t=new ArrayBuffer(e.length),o=new Uint8Array(t);for(let n=0,i=e.length;n<i;n++)o[n]=e.charCodeAt(n);return t}function b(e){const t="-----BEGIN PUBLIC KEY-----",o="-----END PUBLIC KEY-----",n=e.substring(t.length,e.length-o.length),i=window.atob(n),v=c(i);return window.crypto.subtle.importKey("spki",v,{name:"RSA-OAEP",hash:"SHA-1"},!0,["encrypt"])}function h(e){const t=new Uint8Array(e);let o="";for(let n=0;n<t.byteLength;n++)o+=String.fromCharCode(t[n]);return btoa(o)}async function x(e){if(!window.crypto.subtle)throw new Error("仅HTTPS环境可用");const t=new TextEncoder().encode(e),o=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},await b(m.value),t);return h(o)}return{username:r,password:u,access:()=>x(u.value).then(e=>D(r.value,e).then(t=>{H.success("认证成功"),y.value=t.token,s.value=t.exp,_.value=!0,a.value=r.value,l.push({path:f.query.redirect||"/great-old-one/index"})}))}}},N={class:"page"},R={class:"login-box"},O={class:"button-box"};function Y(m,a,y,s,_,f){const l=p("PageHeader"),r=p("TextInput"),u=p("AsyncButtom");return L(),S("div",N,[d(l),w("div",R,[d(r,{modelValue:s.username,"onUpdate:modelValue":a[0]||(a[0]=c=>s.username=c),border:""},null,8,["modelValue"]),d(r,{modelValue:s.password,"onUpdate:modelValue":a[1]||(a[1]=c=>s.password=c),border:"",type:"password"},null,8,["modelValue"]),w("div",O,[d(u,{onLoadingClick:s.access},{default:k(()=>[K(" 契约 ")]),_:1},8,["onLoadingClick"])])])])}const M=B(U,[["render",Y],["__scopeId","data-v-d6572192"]]);export{M as default};
