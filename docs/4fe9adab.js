import{_ as U,S as j,q as F,a as A,r as w,b as _,d as m,e as v,h as u,F as x,E as $,f as E,w as B,t as H,n as R,g1 as L,g2 as N,a2 as O,g3 as q,a0 as I,b0 as z,a6 as K,u as W,K as G,Y as Q,ah as Y,ai as J,a9 as X,c as Z,Q as ee,ct as te,T as ae,p as b,g as V,aT as ne,g4 as oe,g5 as le,g6 as T}from"./assets/index-306e3e3a.js";import{M as se}from"./e67b0458.js";import{I as re}from"./dd89c649.js";/* empty css        *//* empty css        *//* empty css        */import{E as ce}from"./07d4fadd.js";import{E as ie}from"./bc04975b.js";const de={components:{SvgIcon:j,ImageCon:re},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(a,{emit:o}){const{emoteHistory:i}=F(),e=A({name:"history",emote:i.value}),t=A([]),h=w("history"),p=r=>{if(h.value=r.name,r.emote.length===0)return L(r.name).then(c=>{h.value=r.name,r.emote=c.emote.map(S=>({...S,scope:r.name}))})},f=()=>{t.splice(0,t.length),t.push(e),N().then(r=>{t.push(...r.sort((c,S)=>{const M=i.value.findIndex(D=>D.scope===c.name),g=i.value.findIndex(D=>D.scope===S.name);return(M===-1?1/0:M)-(g===-1?1/0:g)})),t.push({name:"add",emote:[]})})};return f(),{onSelect:r=>{o("select",r),i.value=i.value.filter(c=>!(c.scope===r.scope&&c.name===r.name)),i.value=[r,...i.value].slice(0,30),e.emote=i.value},addEmotePackage:()=>{O({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:r=>q(r.inputValue).then(()=>{I.success("添加成功"),f()}),inputValidator:r=>/^\d+$/.test(r),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:h,emotePackages:t,selectScope:p}}},ue={class:"emote-selector"},me={class:"emotes"},fe={class:"scopes"},he=["onClick"];function pe(a,o,i,e,t,h){const p=_("ImageCon"),f=_("SvgIcon");return m(),v("div",ue,[u("div",me,[(m(!0),v(x,null,$((e.emotePackages.find(n=>n.name===e.currentScope)||{}).emote||[],n=>(m(),E(p,{key:n.name,class:"emote",alt:n.name,src:`/kooritea/kooritea.github.io/emoji/${n.scope}/${n.name}.png`,onClick:y=>e.onSelect(n)},{error:B(()=>[u("span",null,H(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),u("div",fe,[(m(!0),v(x,null,$(e.emotePackages,n=>(m(),v("div",{key:n.name,class:R(["scope",{"selected-scope":e.currentScope===n.name}]),onClick:()=>{n.name==="add"?e.addEmotePackage():e.selectScope(n)}},[n.name==="history"?(m(),E(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(m(),E(f,{key:1,class:"emote history",name:"add"})):(m(),E(p,{key:2,class:"emote",src:`/kooritea/kooritea.github.io/emoji/${n.name}/${n.name}.png`},{error:B(()=>[u("span",null,H(n.name),1)]),_:2},1032,["src"]))],10,he))),128))])])}const ve=U(de,[["render",pe],["__scopeId","data-v-aba84f95"]]);function ge(a){const o=w(null),i=z(ce,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:o.value,"onUpdate:modelValue":e=>{var t;o.value=e,(t=i.component)!=null&&t.props&&(i.component.props.modelValue=e)}});O({title:"选择预约时间",message:i,confirmHandlerPromise:e=>a(o),inputValidator:e=>!!o.value,inputErrorMessage:"请选择预约时间"})}const C={},ye={components:{SvgIcon:j,Markdown:se,ButtonBox:K,EmoteSelector:ve,ElPopover:ie},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(a,{emit:o}){const{darkMode:i}=W(),e=w(!0),{computedModelValue:t}=G(a,o),h=w(!1),p=w(null);if(a.cache){const l=Q();if(C[l.fullPath]&&a.cache===!0)I.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const s="MDEditorCache."+(a.cache===!0?l.fullPath:`${l.fullPath}.${a.cache}`);t.value=localStorage.getItem(s)||a.defaultValue;let d=null;Y(()=>{C[s]=!0,d=setInterval(()=>{h.value=!0,localStorage.setItem(s,t.value||"")},1e3)}),J(()=>{C[s]=!1,clearInterval(d)}),X(t,()=>{h.value=!1})}}const f=l=>{const s=p.value.selectionStart,d=t.value.slice(0,s),k=t.value.slice(s);t.value=`${d}${l}${k}`},n=w(t.value),y=({reservationDate:l}={})=>{const s=a.onSubmit(t.value,l==null?void 0:l.value);return s instanceof Promise?s.then(()=>{t.value=a.defaultValue,n.value=a.defaultValue}):(t.value=a.defaultValue,n.value=a.defaultValue),s},r=()=>{t.value=""},c=()=>{t.value=n.value},S=[{name:"提交",type:"primary",handler:y,show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("submit"):a.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{ge(l=>{y({reservationDate:l})})},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reservation"):a.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:r,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("clean"):a.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:c,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reset"):a.showDefaultHandlers)&&!!n.value,sort:30}],M=Z(()=>[...S,...a.exHandlers]),g=l=>{const s=oe(URL.createObjectURL(l),{handlers:[{name:"上传",type:"primary",handler:()=>{const d=new Date().valueOf().toString();f(`![${d}](--------------------)`),le(l,k=>{const P=Math.round(100*event.loaded/event.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),`![${d}](${"#".repeat(P)}${"-".repeat(20-P)})`)}).then(k=>{t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),`![${k.keyname}](${k.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${d}]\\((#*?)(-*?)\\)`),"")}),s.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{T(l,16,9).then(d=>{s.callClose(),g(d)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{T(l,160,67).then(d=>{s.callClose(),g(d)})}},{name:"取消",type:"default",handler:()=>{s.callClose()}}]})};return{darkMode:i,isEditMode:e,computedModelValue:t,resetCache:n,isSave:h,handlers:M,submitHandler:y,cleanHandler:r,resetHandler:c,previewImageBeforeUpload:g,pasteHandler:l=>{if(!(l.clipboardData&&l.clipboardData.items))return;const s=Array.from(l.clipboardData.items).filter(d=>d.kind==="file");if(s.length>0){l.preventDefault();for(const d of s)if(d.type.startsWith("image/")){g(d.getAsFile());return}else I.warning(`不支持的文件类型: ${d.type}`)}},dropHandler:l=>{for(const s of l.dataTransfer.files)if(l.preventDefault(),s.type.startsWith("image/")){g(s);return}else I.warning(`不支持的文件类型: ${s.type}`)},textarea:p,insertText:f}}},_e={class:"fill"},we=["disabled"],Se={key:1,class:"preview"},ke={class:"bar"},be={class:"bar-left"},Ee={class:"title"},He={class:"uploader"},Me={class:"bar-right"},De={key:0,class:"is-save info"};function Ie(a,o,i,e,t,h){const p=_("Markdown"),f=_("SvgIcon"),n=_("EmoteSelector"),y=_("el-popover"),r=_("ButtonBox");return m(),v(x,null,[u("div",ne({class:"md-editor"},a.$attrs),[e.isEditMode?(m(),v("div",{key:0,class:R(["textarea-box",{"auto-height":i.autoHeight}])},[u("pre",_e,H(e.computedModelValue),1),ee(u("textarea",{ref:"textarea","onUpdate:modelValue":o[0]||(o[0]=c=>e.computedModelValue=c),class:"textarea",disabled:i.disabled,onPaste:o[1]||(o[1]=(...c)=>e.pasteHandler&&e.pasteHandler(...c)),onDragover:o[2]||(o[2]=ae(()=>{},["prevent"])),onDrop:o[3]||(o[3]=(...c)=>e.dropHandler&&e.dropHandler(...c))},null,40,we),[[te,e.computedModelValue]])],2)):(m(),v("div",Se,[b(p,{"model-value":e.computedModelValue},null,8,["model-value"])])),u("div",ke,[u("div",be,[i.disabled?V("",!0):(m(),v(x,{key:0},[u("div",Ee,H(i.title),1),u("label",He,[b(f,{class:"button",name:"14"}),u("input",{type:"file",accept:"image/*",onChange:o[4]||(o[4]=c=>{e.previewImageBeforeUpload(c.srcElement.files[0]),c.srcElement.value=""})},null,32)]),b(y,{width:"auto",trigger:"click",effect:e.darkMode?"dark":"light"},{reference:B(()=>[b(f,{class:"button",name:"biaoqing"})]),default:B(()=>[b(n,{onSelect:o[5]||(o[5]=c=>{e.insertText(`[emoji ${c.scope}/${c.name}]`)})})]),_:1},8,["effect"])],64))]),u("div",Me,[e.isSave?(m(),v("span",De,"已保存")):V("",!0),u("span",{class:"preview-switch button",onClick:o[6]||(o[6]=c=>e.isEditMode=!e.isEditMode)},H(e.isEditMode?"预览":"返回编辑"),1)])])],16),e.handlers.length>0?(m(),E(r,{key:0,handlers:e.handlers},null,8,["handlers"])):V("",!0)],64)}const xe=U(ye,[["render",Ie],["__scopeId","data-v-6530e061"]]),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{xe as M,Oe as a,ge as u};
