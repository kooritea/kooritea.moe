import{_ as S,a8 as H,L as N,A,r as k,a as B,c as w,q as O,ab as M,b as s,d as g,e as I,p as i,w as p,f as L,g as T,ac as z,a4 as P,ad as V,ae as F,af as R,F as q,E as U,l as G,t as x,h as E}from"./assets/index-fcd48c4f.js";import{P as $}from"./55b945a7.js";/* empty css        *//* empty css        *//* empty css        */import{b as j,c as J,E as K,a as Q}from"./b33170a1.js";import"./0ef71ce4.js";import"./4b45712f.js";import"./6fa86724.js";import"./vander_initCloneObject-2513a7d6.js";const W={components:{ButtonBox:H,LoadingIcon:N,AsyncButtom:A,PageHeader:$,ElTable:j,ElTableColumn:J,ElRadioGroup:K,ElRadio:Q},setup(){const a=k("/"),l=k("kooritea.github.io"),h=B({}),n=B([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of n)h[e.value]={};const u=w(()=>h[l.value]),f=k(!1),d=B([]),{devMode:b}=O(),o=w(()=>({repo:b.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),y=e=>{d.splice(0,d.length),d.push(...e)},v=w(()=>{const e=[...u.value[a.value]||[]];return!f.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,c)=>{if(a.value=e,!u.value[e]||c)return u.value[e]=void 0,f.value=!0,z({...o.value,path:e}).then(m=>{m.type==="dir"&&(u.value[e]=[...m.children.filter(C=>C.type==="dir"),...m.children.filter(C=>C.type==="file")])}).finally(()=>{f.value=!1})};r("/"),M(l,()=>{r("/")});const _=e=>{P({title:"提示",message:`确认删除${e.length>1?`选中的${e.length}个文件`:e[0].name}`,type:"warning",confirmHandlerPromise:c=>V({...o.value,files:e.map(m=>({isDel:!0,path:m.path}))}).then(()=>r(a.value,!0))})};return{dataBaseList:n,onSelectionChange:y,repoConfig:o,tableData:v,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>P({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:c=>R({...o.value,branch:void 0,file:e[0]}).then(({sha:m})=>V({...o.value,files:[{sha:m,path:c.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:c=>!!c,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",confirm:!1,disabled:()=>d.length===0,handler:()=>_(d)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in u.value)delete u.value[e];return r("/")}}],deleteItem:_,deleteDir:e=>{P({title:"提示",message:`确认删除${e}`,type:"warning",confirmHandlerPromise:c=>F({...o.value,dir:e}).then(()=>r(a.value,!0))})},database:l}},methods:{onCellClick(a,l,h,n){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},X={class:"page"};function Y(a,l,h,n,u,f){const d=s("PageHeader"),b=s("el-radio"),o=s("el-radio-group"),y=s("LoadingIcon"),v=s("el-table-column"),r=s("AsyncButtom"),_=s("el-table"),D=s("ButtonBox");return g(),I("div",X,[i(d),i(o,{modelValue:n.database,"onUpdate:modelValue":l[0]||(l[0]=t=>n.database=t)},{default:p(()=>[(g(!0),I(q,null,U(n.dataBaseList,t=>(g(),L(b,{key:t.value,value:t.value,size:"large"},{default:p(()=>[G(x(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(_,{border:"",data:n.tableData,style:{width:"100%"},onCellClick:f.onCellClick,onSelectionChange:n.onSelectionChange},{empty:p(()=>[E("div",null,[i(y)])]),default:p(()=>[i(v,{type:"selection",selectable:t=>t.type==="file"},null,8,["selectable"]),i(v,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:p(t=>[E("span",null,x(t.row.type==="dir"?"📁":"📄")+x(t.row.name),1)]),_:1}),i(v,{label:"操作",width:"120px"},{default:p(t=>[i(r,{type:"danger",size:"mini",confirm:!1,onLoadingClick:()=>t.row.type==="dir"?n.deleteDir(t.row.path):n.deleteItem([t.row])},{default:p(()=>[G(" 删除 ")]),_:2},1032,["onLoadingClick"])]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),n.handlers.length>0?(g(),L(D,{key:0,handlers:n.handlers},null,8,["handlers"])):T("",!0)])}const ue=S(W,[["render",Y],["__scopeId","data-v-6d252e1f"]]);export{ue as default};
