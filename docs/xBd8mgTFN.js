import{_ as C,A as N,r as h,c as x,k as u,b as p,f as g,F as d,B as _,n as S,g as B,l as y,e as I,V as v,z as D,w as z,a as A,j as T,d as V,t as K}from"./assets/index-t2FEOT64.js";class f{constructor(e,t){this.x=e,this.y=t,this.key=String(Math.random())}}class w extends f{constructor(e,t){super(e,t),this.itemType="kabe"}}class b extends f{constructor(e,t){super(e,t),this.itemType="box"}}class M extends f{constructor(e,t){super(e,t),this.itemType="target"}}class H extends f{constructor(e,t){super(e,t),this.itemType="neko"}}class L{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let t=0;t<e.length;t++){const s=e[t],r=[];this.instance.push(r);for(let a=0;a<s.length;a++){const k=s[a];let i=null;for(const m of k.split(""))switch(m){case"k":{i=new w(a,t);break}case"x":{const n=new b(a,t);this.boxs.push(n),i=n;break}case"o":{this.targets.push(new M(a,t));break}case"s":{const n=new H(a,t);this.neko=n,i=n;break}}r.push(i)}}}getItem({x:e,y:t}){var s;return(s=this.instance[t])==null?void 0:s[e]}getDirectionCoordinate({x:e,y:t},s){switch(s){case"2":{t=t+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{t=t-1;break}}return{x:e,y:t}}getNextItem({x:e,y:t},s){const r=this.getItem(this.getDirectionCoordinate({x:e,y:t},s));return r===void 0||r instanceof w?!1:r}moveItem({x:e,y:t},s){const r=this.getItem({x:e,y:t}),a=this.getDirectionCoordinate({x:e,y:t},s);r.x=a.x,r.y=a.y,this.instance[t][e]=null,this.instance[a.y][a.x]=r}}let F=class{constructor(e){this.map=new L(e)}get neko(){return this.map.neko}operate(e){const t=this.map.getNextItem(this.neko,e);if(t===!1)return!1;if(t===null&&this.map.moveItem(this.neko,e),t instanceof b){if(this.map.getNextItem(t,e)!==null)return!1;this.map.moveItem(t,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof b))}};const $={components:{AsyncButtom:N},props:{map:{type:String,default:()=>""}},setup(l){const e=h(null),t=h(50),s=h(!1),r=function(){let n=[];const o=[];for(const c of l.map.split(","))c==="n"?(o.push(n),n=[]):n.push(c);e.value=A(new F(o)),s.value=!1};r();const a=function(n){n.preventDefault();const o={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(n.keyCode)];e.value.operate(o),s.value=e.value.check()},k=function(n,o){const c=e.value.neko;n-c.x===0&&o-c.y===1&&e.value.operate("2"),n-c.x===0&&o-c.y===-1&&e.value.operate("8"),n-c.x===1&&o-c.y===0&&e.value.operate("6"),n-c.x===-1&&o-c.y===0&&e.value.operate("4"),s.value=e.value.check()},i=x(()=>{var n,o;return((o=(n=e.value)==null?void 0:n.map)==null?void 0:o.targets)||[]}),m=function(n,o){return i.value.some(c=>c.x===n&&c.y===o)};return{mapInstance:x(()=>{var n,o;return((o=(n=e.value)==null?void 0:n.map)==null?void 0:o.instance)||[]}),isTarget:m,size:t,reset:r,congratulations:s,keyupHandler:a,touchMove:k}}},j={class:"sokoban-box"},E=["onClick"],q={key:0,class:"congratulations"},G={class:"buttons"};function J(l,e,t,s,r,a){const k=T("AsyncButtom");return u(),p("div",j,[g("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=v(i=>{i.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=v(i=>{i.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=v((...i)=>s.keyupHandler&&s.keyupHandler(...i),["stop"]))},[(u(!0),p(d,null,_(s.mapInstance,(i,m)=>(u(),p("div",{key:m,class:"row"},[(u(!0),p(d,null,_(i,(n,o)=>(u(),p("div",{key:(n==null?void 0:n.key)||o+m,class:S(["col",{[(n==null?void 0:n.itemType)||"empty"]:!0,target:s.isTarget(o,m)}]),style:B({width:`${s.size}px`,height:`${s.size}px`}),onClick:()=>{s.touchMove(o,m)}},[(n==null?void 0:n.itemType)==="neko"?(u(),p(d,{key:0},[y(" 😾 ")],64)):(n==null?void 0:n.itemType)==="box"?(u(),p(d,{key:1},[y(" 📦 ")],64)):I("",!0)],14,E))),128))]))),128)),s.congratulations?(u(),p("div",q," 通关 ")):I("",!0),e[3]||(e[3]=g("div",{class:"mask"}," 点击开始 ",-1))],32),g("div",G,[D(k,{type:"primary",onLoadingClick:s.reset},{default:z(()=>e[4]||(e[4]=[y(" 重置 ")])),_:1},8,["onLoadingClick"])])])}const O=C($,[["render",J],["__scopeId","data-v-e740188f"]]),P={components:{Sokoban:O},props:{content:{type:Array,default:()=>[]}}},Q={key:1};function R(l,e,t,s,r,a){const k=T("Sokoban");return u(),p("div",null,[t.content[0]==="sokoban"?(u(),V(k,{key:0,map:t.content[1]},null,8,["map"])):(u(),p("span",Q,"[component "+K(t.content)+" not found]",1))])}const X=C(P,[["render",R]]);export{X as default};
