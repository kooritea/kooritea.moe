import{_ as S,a1 as B,p as A,r as h,G as I,j as m,k as a,b as l,f as u,z as g,l as k,e as f,L as D,u as b,N as V,gI as U,a3 as C,gJ as L,gK as H,a8 as N,gL as O,d as y,F as M,B as T,t as E}from"./assets/index-Ci6lRQ3U.js";import{I as x}from"./xCFUvfJxE.js";import{M as q}from"./xDhmsQg3r.js";import{M as F}from"./xDUpDL6mq.js";import"./xDNBO6MTb.js";/* empty css         *//* empty css         */import"./xDlumPUkd.js";import"./xDSpHJm7g.js";import"./vander_commonjsHelpers-CqkleIqs.js";import"./xBUXpCyLe.js";import"./xDJk7YYUq.js";import"./xBW1J9R8p.js";import"./xBI7IVt5R.js";import"./xCVr2HHRa.js";import"./vander_baseFindIndex-D7XfJLKM.js";import"./xCU5VJXzR.js";/* empty css         *//* empty css         */import"./xDb8PYaiQ.js";import"./xCqUaNoCd.js";import"./vander_baseIteratee-DGhGZrN7.js";import"./xR90l-W5R.js";/* empty css         */import"./xDqF_D7W6.js";import"./xBbrj46XU.js";const G={components:{ImageCon:x,MDEditor:F,TextInput:B},props:{onCancel:{type:Function,default:null},onSubmit:{type:Function,default:null},title:{type:String,default:()=>""},needUserInfo:{type:Boolean,default:()=>!0},defaultContent:{type:String,default:()=>""}},setup(t){const{guestName:n,guestEmail:r}=A(),o=h(n.value||""),s=h(r.value||""),i=h(""),_=h(t.defaultContent||"");I(o,()=>{n.value=o.value}),I(s,()=>{r.value=s.value});const c=async()=>{if(/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/.test(s.value)){const p=new TextEncoder().encode(s.value.trim().toLowerCase()),d=await window.crypto.subtle.digest("SHA-256",p),w=Array.from(new Uint8Array(d));i.value=w.map(e=>e.toString(16).padStart(2,"0")).join("")}};return c(),{name:o,email:s,gravatar:i,content:_,onEmailInput:c}},methods:{beforeSubmit(t){return this.onSubmit({content:t,name:this.name,email:this.email})}}},j={class:"comment-editor"},z={key:0,class:"editor-header"},J={class:"head-box"},K={class:"input name"},P={class:"input email"};function Q(t,n,r,o,s,i){const _=m("ImageCon"),c=m("TextInput"),p=m("MDEditor");return a(),l("div",j,[r.needUserInfo?(a(),l("div",z,[u("div",J,[g(_,{src:o.gravatar?`https://www.gravatar.com/avatar/${o.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),u("div",K,[n[3]||(n[3]=k(" 名称：")),g(c,{modelValue:o.name,"onUpdate:modelValue":n[0]||(n[0]=d=>o.name=d)},null,8,["modelValue"])]),u("div",P,[n[4]||(n[4]=k(" 邮箱：")),g(c,{modelValue:o.email,"onUpdate:modelValue":n[1]||(n[1]=d=>o.email=d),type:"email",onInput:o.onEmailInput},null,8,["modelValue","onInput"])])])):f("",!0),g(p,{"model-value":o.content,"onUpdate:modelValue":n[2]||(n[2]=d=>o.content=d),cache:!1,showDefaultHandlers:["submit","clean"],safeMode:!0,title:r.title,"on-submit":i.beforeSubmit,"ex-handlers":r.onCancel?[{name:"取消",handler:r.onCancel}]:[]},null,8,["model-value","title","on-submit","ex-handlers"])])}const R=S(G,[["render",Q],["__scopeId","data-v-76ae7099"]]),W={name:"Comment",components:{LoadingIcon:D,ImageCon:x,Markdown:q,CommentMDEditor:R},props:{deep:{type:Number,default:()=>0},query:{type:Object,default:()=>null},replys:{type:Array,default:()=>null}},setup(){const{mobileMode:t}=b(),{isGreatOldOne:n}=b();return{mobileMode:t,isGreatOldOne:n}},data(){return{loading:!1,comments:[],parentId:null}},created(){this.load()},methods:{formatDate:V,load(){this.query?(this.loading=!0,U(this.query).then(t=>{this.comments=t}).finally(()=>{this.loading=!1})):this.replys&&(this.comments=this.replys)},async onSubmitComment(t){if(!t.name)throw C.warning("必须填写名称"),new Error("必须填写名称");if(!t.content)throw C.warning("必须填写内容"),new Error("必须填写内容");if(t.email&&!/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/.test(t.email))throw C.warning("邮箱格式错误"),new Error("邮箱格式错误");return L({...t,...this.query}).then(()=>{this.parentId=null,this.load()})},onEditComment(t,n){return H(t.id,{content:n.content}).then(()=>{t.content=n.content,t.editing=!1})},deleteComment(t){N({title:"提示",message:"确认这条评论操作?",type:"warning",confirmHandlerPromise:n=>O(t.id).then(()=>{this.comments=this.comments.filter(r=>r.id!==t.id)})})}}},X={class:"comments"},Y={class:"head-box"},Z={class:"content"},$={class:"info"},ee={class:"name"},te={class:"time"},ne=["onClick"],oe=["onClick"],se=["onClick"],ae={key:0,class:"no-comment"};function re(t,n,r,o,s,i){const _=m("LoadingIcon"),c=m("ImageCon"),p=m("CommentMDEditor"),d=m("Markdown"),w=m("Comment",!0);return a(),l("div",X,[s.loading?(a(),y(_,{key:0})):(a(),l(M,{key:1},[(a(!0),l(M,null,T(s.comments,e=>(a(),l("div",{key:e.id,class:"comment"},[u("div",Y,[g(c,{src:e.gravatar?`https://www.gravatar.com/avatar/${e.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),u("div",Z,[u("div",$,[u("div",ee,E(e.name),1),u("div",te,E(i.formatDate(e.uptime||e.time,o.mobileMode?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd HH:mm:ss UTC DD")),1),r.deep===0&&!s.parentId?(a(),l("div",{key:0,class:"reply",onClick:()=>{e.editing=!1,s.parentId=e.id}}," 回复 ",8,ne)):f("",!0),(e.isSelf||o.isGreatOldOne)&&!e.editing?(a(),l("div",{key:1,class:"edit",onClick:()=>{e.editing=!0,s.parentId=null}}," 编辑 ",8,oe)):f("",!0),(e.isSelf||o.isGreatOldOne)&&!e.editing&&!e.editing?(a(),l("div",{key:2,class:"delete",onClick:()=>{i.deleteComment(e)}}," 删除 ",8,se)):f("",!0)]),e.editing?(a(),y(p,{key:0,needUserInfo:!1,defaultContent:e.content,"on-submit":v=>i.onEditComment(e,v),"on-cancel":()=>{e.editing=!1}},null,8,["defaultContent","on-submit","on-cancel"])):(a(),y(d,{key:1,"model-value":e.content,safeMode:!0},null,8,["model-value"])),g(w,{class:"replys",deep:1,replys:e.replys},null,8,["replys"]),r.deep===0&&s.parentId===e.id?(a(),y(p,{key:2,title:`回复${e.name}`,"on-submit":v=>i.onSubmitComment({parentId:e.id,...v}),"on-cancel":()=>{s.parentId=null}},null,8,["title","on-submit","on-cancel"])):f("",!0)])]))),128)),r.deep===0&&s.comments.length===0?(a(),l("div",ae," 暂无评论 ")):f("",!0)],64)),r.deep===0&&s.parentId===null?(a(),y(p,{key:2,"on-submit":e=>i.onSubmitComment(e)},null,8,["on-submit"])):f("",!0)])}const Ue=S(W,[["render",re],["__scopeId","data-v-c1d752b1"]]);export{Ue as default};
