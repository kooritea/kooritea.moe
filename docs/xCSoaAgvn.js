import{_ as S,a7 as H,L as A,A as N,r as B,a as P,c as w,q as M,aa as T,b as V,p as i,w as s,d as D,e as O,ab as z,a3 as x,ac as E,ad as F,ae as R,j as u,k as b,F as j,E as q,l as I,t as v,f as G}from"./assets/index-BtZJFWXm.js";import{P as U}from"./xp_1m6gsU.js";/* empty css         *//* empty css         *//* empty css         *//* empty css         */import{b as W,c as J,E as K,a as Q}from"./xDDbT97hr.js";import"./xB8onCzLX.js";import"./xDG_k2Tfu.js";import"./xC8Q2h3sr.js";import"./vander_initCloneObject-BXm7ojWL.js";import"./xDigGAP_c.js";import"./vander_baseIteratee-DIbc09P2.js";import"./xX-mkVmDo.js";const X={components:{ButtonBox:H,LoadingIcon:A,AsyncButtom:N,PageHeader:U,ElTable:W,ElTableColumn:J,ElRadioGroup:K,ElRadio:Q},setup(){const a=B("/"),l=B("kooritea.github.io"),g=P({}),t=P([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of t)g[e.value]={};const d=w(()=>g[l.value]),f=B(!1),c=P([]),{devMode:y}=M(),o=w(()=>({repo:y.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),C=e=>{c.splice(0,c.length),c.push(...e)},h=w(()=>{const e=[...d.value[a.value]||[]];return!f.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,m)=>{if(a.value=e,!d.value[e]||m)return d.value[e]=void 0,f.value=!0,z({...o.value,path:e}).then(p=>{p.type==="dir"&&(d.value[e]=[...p.children.filter(k=>k.type==="dir"),...p.children.filter(k=>k.type==="file")])}).finally(()=>{f.value=!1})};r("/"),T(l,()=>{r("/")});const _=e=>{x({title:"提示",message:`确认删除${e.length>1?`选中的${e.length}个文件`:e[0].name}`,type:"warning",confirmHandlerPromise:m=>E({...o.value,files:e.map(p=>({isDel:!0,path:p.path}))}).then(()=>r(a.value,!0))})};return{dataBaseList:t,onSelectionChange:C,repoConfig:o,tableData:h,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>x({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:m=>R({...o.value,branch:void 0,file:e[0]}).then(({sha:p})=>E({...o.value,files:[{sha:p,path:m.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:m=>!!m,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",confirm:!1,disabled:()=>c.length===0,handler:()=>_(c)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in d.value)delete d.value[e];return r("/")}}],deleteItem:_,deleteDir:e=>{x({title:"提示",message:`确认删除${e}`,type:"warning",confirmHandlerPromise:m=>F({...o.value,dir:e}).then(()=>r(a.value,!0))})},database:l}},methods:{onCellClick(a,l,g,t){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},Y={class:"page"};function Z(a,l,g,t,d,f){const c=u("PageHeader"),y=u("el-radio"),o=u("el-radio-group"),C=u("LoadingIcon"),h=u("el-table-column"),r=u("AsyncButtom"),_=u("el-table"),L=u("ButtonBox");return b(),V("div",Y,[i(c),i(o,{modelValue:t.database,"onUpdate:modelValue":l[0]||(l[0]=n=>t.database=n)},{default:s(()=>[(b(!0),V(j,null,q(t.dataBaseList,n=>(b(),D(y,{key:n.value,value:n.value,size:"large"},{default:s(()=>[I(v(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(_,{border:"",data:t.tableData,style:{width:"100%"},onCellClick:f.onCellClick,onSelectionChange:t.onSelectionChange},{empty:s(()=>[G("div",null,[i(C)])]),default:s(()=>[i(h,{type:"selection",selectable:n=>n.type==="file"},null,8,["selectable"]),i(h,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{header:s(()=>[I(" ["+v(t.currentPath.startsWith("/")?"":"/")+v(t.currentPath)+"]文件名 ",1)]),default:s(n=>[G("span",null,v(n.row.type==="dir"?"📁":"📄")+v(n.row.name),1)]),_:1}),i(h,{label:"操作",width:"120px"},{default:s(n=>[i(r,{type:"danger",size:"mini",confirm:!1,onLoadingClick:()=>n.row.type==="dir"?t.deleteDir(n.row.path):t.deleteItem([n.row])},{default:s(()=>l[1]||(l[1]=[I(" 删除 ")])),_:2},1032,["onLoadingClick"])]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),t.handlers.length>0?(b(),D(L,{key:0,handlers:t.handlers},null,8,["handlers"])):O("",!0)])}const pe=S(X,[["render",Z],["__scopeId","data-v-53a102d9"]]);export{pe as default};
