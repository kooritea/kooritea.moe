import{P as j}from"./xBUwqwuX2.js";import{_ as E,A as F,K as N,aC as C,aD as q,aE as J,a0 as S,aF as z,b as L,z as w,f as M,w as k,l as I,j as y,k as b,F as D,B as V,d as R,t as U,e as H}from"./assets/index-D_LFPdhH.js";import{g as X}from"./vander_commonjsHelpers-CqkleIqs.js";var P={exports:{}},Y=P.exports,B;function G(){return B||(B=1,function(t,n){(function(r,h){t.exports=h()})(Y,function(){function r(e){var i=[];return e.AMapUI&&i.push(h(e.AMapUI)),e.Loca&&i.push(c(e.Loca)),Promise.all(i)}function h(e){return new Promise(function(i,s){var p=[];if(e.plugins)for(var l=0;l<e.plugins.length;l+=1)a.AMapUI.plugins.indexOf(e.plugins[l])==-1&&p.push(e.plugins[l]);if(u.AMapUI===o.failed)s("前次请求 AMapUI 失败");else if(u.AMapUI===o.notload){u.AMapUI=o.loading,a.AMapUI.version=e.version||a.AMapUI.version,l=a.AMapUI.version;var m=document.body||document.head,f=document.createElement("script");f.type="text/javascript",f.src="https://webapi.amap.com/ui/"+l+"/main.js",f.onerror=function(d){u.AMapUI=o.failed,s("请求 AMapUI 失败")},f.onload=function(){if(u.AMapUI=o.loaded,p.length)window.AMapUI.loadUI(p,function(){for(var d=0,A=p.length;d<A;d++){var _=p[d].split("/").slice(-1)[0];window.AMapUI[_]=arguments[d]}for(i();g.AMapUI.length;)g.AMapUI.splice(0,1)[0]()});else for(i();g.AMapUI.length;)g.AMapUI.splice(0,1)[0]()},m.appendChild(f)}else u.AMapUI===o.loaded?e.version&&e.version!==a.AMapUI.version?s("不允许多个版本 AMapUI 混用"):p.length?window.AMapUI.loadUI(p,function(){for(var d=0,A=p.length;d<A;d++){var _=p[d].split("/").slice(-1)[0];window.AMapUI[_]=arguments[d]}i()}):i():e.version&&e.version!==a.AMapUI.version?s("不允许多个版本 AMapUI 混用"):g.AMapUI.push(function(d){d?s(d):p.length?window.AMapUI.loadUI(p,function(){for(var A=0,_=p.length;A<_;A++){var O=p[A].split("/").slice(-1)[0];window.AMapUI[O]=arguments[A]}i()}):i()})})}function c(e){return new Promise(function(i,s){if(u.Loca===o.failed)s("前次请求 Loca 失败");else if(u.Loca===o.notload){u.Loca=o.loading,a.Loca.version=e.version||a.Loca.version;var p=a.Loca.version,l=a.AMap.version.startsWith("2"),m=p.startsWith("2");if(l&&!m||!l&&m)s("JSAPI 与 Loca 版本不对应！！");else{l=a.key,m=document.body||document.head;var f=document.createElement("script");f.type="text/javascript",f.src="https://webapi.amap.com/loca?v="+p+"&key="+l,f.onerror=function(d){u.Loca=o.failed,s("请求 AMapUI 失败")},f.onload=function(){for(u.Loca=o.loaded,i();g.Loca.length;)g.Loca.splice(0,1)[0]()},m.appendChild(f)}}else u.Loca===o.loaded?e.version&&e.version!==a.Loca.version?s("不允许多个版本 Loca 混用"):i():e.version&&e.version!==a.Loca.version?s("不允许多个版本 Loca 混用"):g.Loca.push(function(d){d?s(d):s()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},g={AMap:[],AMapUI:[],Loca:[]},v=[],x=function(e){typeof e=="function"&&(u.AMap===o.loaded?e(window.AMap):v.push(e))};return{load:function(e){return new Promise(function(i,s){if(u.AMap==o.failed)s("");else if(u.AMap==o.notload){var p=e.key,l=e.version,m=e.plugins;p?(window.AMap&&location.host!=="lbs.amap.com"&&s("禁止多种API加载方式混用"),a.key=p,a.AMap.version=l||a.AMap.version,a.AMap.plugins=m||a.AMap.plugins,u.AMap=o.loading,l=document.body||document.head,window.___onAPILoaded=function(d){if(delete window.___onAPILoaded,d)u.AMap=o.failed,s(d);else for(u.AMap=o.loaded,r(e).then(function(){i(window.AMap)}).catch(s);v.length;)v.splice(0,1)[0]()},m=document.createElement("script"),m.type="text/javascript",m.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+a.AMap.version+"&key="+p+"&plugin="+a.AMap.plugins.join(","),m.onerror=function(d){u.AMap=o.failed,s(d)},l.appendChild(m)):s("请填写key")}else if(u.AMap==o.loaded)if(e.key&&e.key!==a.key)s("多个不一致的 key");else if(e.version&&e.version!==a.AMap.version)s("不允许多个版本 JSAPI 混用");else{if(p=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)a.AMap.plugins.indexOf(e.plugins[l])==-1&&p.push(e.plugins[l]);p.length?window.AMap.plugin(p,function(){r(e).then(function(){i(window.AMap)}).catch(s)}):r(e).then(function(){i(window.AMap)}).catch(s)}else if(e.key&&e.key!==a.key)s("多个不一致的 key");else if(e.version&&e.version!==a.AMap.version)s("不允许多个版本 JSAPI 混用");else{var f=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)a.AMap.plugins.indexOf(e.plugins[l])==-1&&f.push(e.plugins[l]);x(function(){f.length?window.AMap.plugin(f,function(){r(e).then(function(){i(window.AMap)}).catch(s)}):r(e).then(function(){i(window.AMap)}).catch(s)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},g={AMap:[],AMapUI:[],Loca:[]}}}})}(P)),P.exports}var K=G();const T=X(K);function W(t,n={}){return new Promise((r,h)=>{t.plugin("AMap.Geolocation",function(){new t.Geolocation({enableHighAccuracy:!0,timeout:1e4,offset:[10,20],zoomToAccuracy:!0,position:"RB",...n}).getCurrentPosition(function(o,a){o==="complete"?r(a):h(a.message)})})})}function $(t,n){function r(v){return v*(Math.PI/180)}const h=6371,c=r(n.lat-t.lat),o=r(n.lng-t.lng),a=Math.sin(c/2)*Math.sin(c/2)+Math.cos(r(t.lat))*Math.cos(r(n.lat))*Math.sin(o/2)*Math.sin(o/2),u=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return h*u}const Q={components:{PageHeader:j,AsyncButtom:F,AsyncSwitch:N},data(){return{security:C(q()),AMap:null,parkingData:[],distance:50,activePark:"",isSwitchSelfMarker:!1}},watch:{async parkingData(){const t=await this.AMap;for(const n of Object.values(this.parkingMarkers||{}))n.remove();this.parkingMarkers={};for(const n of this.parkingData){const r=new t.Marker({position:new t.LngLat(n.positionX,n.positionY),content:'<img src="/assets/park.png" style="width: 28px;">',offset:[-14,-28],extData:n});r.on("click",h=>{var c,o,a;this.activePark=n.parkId,(a=(o=(c=this.$refs[`collapse-${n.parkId}`])==null?void 0:c[0])==null?void 0:o.scrollIntoView)==null||a.call(o,{behavior:"smooth",block:"center",inline:"center"})}),this.map.add(r),this.parkingMarkers[n.parkId]=r}},activePark(){const t=this.parkingData.find(n=>n.parkId===this.activePark);this.map.setCenter([t.positionX,t.positionY],!0);for(const n of Object.values(this.parkingMarkers||{}))n.setContent('<img src="/assets/park.png" style="width: 28px;">');this.parkingMarkers[t.parkId].setContent('<img src="/assets/park_active.png" style="width: 28px;">'),t.order||(t.order=J({parkId:t.parkId}).then(n=>{t.order=n}))}},created(){let t=null;this.AMap=C(new Promise(n=>{t=n})),this.security.then(n=>{window._AMapSecurityConfig={securityJsCode:n.amapJsCode},t(T.load({key:"ad6be402e09782b82c8fc2bd151ca9a9",version:"2.0",plugins:["AMap.Scale"]}))})},beforeUnmount(){var t;(t=this.map)==null||t.destroy()},mounted(){this.AMap.then(t=>{W(t).then(n=>{this.map=new t.Map("map-container",{zoom:12,center:[n.position.lng,n.position.lat]}),this.selfMarker=new t.Marker({content:'<img src="/assets/marker_self.png" style="width: 19px;">',offset:[-9.5,-31],position:new t.LngLat(n.position.lng,n.position.lat)}),this.map.add(this.selfMarker),this.getParking(),this.map.on("click",r=>{this.isSwitchSelfMarker&&this.selfMarker.setPosition([r.lnglat.lng,r.lnglat.lat])})}).catch(n=>{this.map=new t.Map("map-container"),S.warning(n)})})},methods:{async getParking(){const t=this.selfMarker.getPosition();this.parkingData=await z({lng:t.lng,lat:t.lat,distance:this.distance}).then(n=>n.map(r=>({...r,lineDistance:$(t,{lng:r.positionX,lat:r.positionY}).toFixed(2)}))),this.parkingData.length===0&&S.warning(`范围${this.distance}公里内无可用停车场`)},openOrder(t){window.open(`https://g.qcyuns.com/park-shop/scanQrFixCode?fixCodeId=${t.id}`,"_blank")},gotoAPP(t){window.open(`https://uri.amap.com/marker?position=${t.positionX},${t.positionY}&coordinate=gaode&callnative=1`,"_blank")}}},Z={class:"page"},ee={class:"btn-box"},ne={class:"btn-box"},oe={class:"name"},te={class:"line-distance"},ae={class:"remark"},ie={key:0,class:"order-list"},se={class:"shopName"},re={class:"amount"},ue={class:"btn-box"};function le(t,n,r,h,c,o){const a=y("PageHeader"),u=y("el-input"),g=y("AsyncButtom"),v=y("AsyncSwitch"),x=y("el-collapse-item"),e=y("el-collapse");return b(),L("div",Z,[w(a),M("div",ee,[w(u,{modelValue:c.distance,"onUpdate:modelValue":n[0]||(n[0]=i=>c.distance=i)},{append:k(()=>n[3]||(n[3]=[I(" 公里 ")])),_:1},8,["modelValue"]),w(g,{type:"primary",onLoadingClick:()=>o.getParking()},{default:k(()=>n[4]||(n[4]=[I(" 获取当前位置附近停车场 ")])),_:1},8,["onLoadingClick"])]),M("div",ne,[n[5]||(n[5]=I(" 修改当前定位 ")),w(v,{modelValue:c.isSwitchSelfMarker,"onUpdate:modelValue":n[1]||(n[1]=i=>c.isSwitchSelfMarker=i)},null,8,["modelValue"])]),n[8]||(n[8]=M("div",{id:"map-container"},null,-1)),w(e,{modelValue:c.activePark,"onUpdate:modelValue":n[2]||(n[2]=i=>c.activePark=i),accordion:""},{default:k(()=>[(b(!0),L(D,null,V(c.parkingData,i=>(b(),R(x,{key:i.parkId,name:i.parkId},{title:k(()=>[M("div",{ref_for:!0,ref:`collapse-${i.parkId}`,class:"collapse-title"},[M("div",oe,[I(U(i.parkName)+" ",1),M("span",te," 直线距离: "+U(i.lineDistance)+"公里 ",1)])],512)]),default:k(()=>[M("div",ae,[I(U(i.remark)+" ",1),w(g,{type:"primary",size:"mini",onLoadingClick:()=>{o.gotoAPP(i)}},{default:k(()=>n[6]||(n[6]=[I(" 导航 ")])),_:2},1032,["onLoadingClick"])]),Array.isArray(i.order)?(b(),L("div",ie,[(b(!0),L(D,null,V(i.order,s=>(b(),L("div",{key:s.id,class:"order"},[M("div",se,U(s.shopName),1),M("div",re,U(s.amount),1),M("div",ue,[w(g,{type:"primary",size:"mini",onLoadingClick:()=>{o.openOrder(s)}},{default:k(()=>n[7]||(n[7]=[I(" 打开 ")])),_:2},1032,["onLoadingClick"])])]))),128))])):H("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])}const fe=E(Q,[["render",le],["__scopeId","data-v-5d55f0ac"]]);export{fe as default};
