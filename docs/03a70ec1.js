import{_ as U,S as R,q as F,a as A,r as w,b as y,d as m,e as g,h as u,F as V,E as P,f as H,w as I,t as M,n as T,fY as L,fZ as N,a4 as O,f_ as q,a0 as D,av as z,a8 as K,u as W,K as Y,Y as G,aj as Q,ak as Z,ab as J,c as X,Q as ee,cp as te,T as ae,p as E,g as $,f$ as ne,g0 as oe,g1 as j}from"./assets/index-6e8a4740.js";import{M as le}from"./881cbaa2.js";import{I as re}from"./cc2a1798.js";/* empty css        *//* empty css        *//* empty css        */import{E as se}from"./240d77fa.js";import{E as ce}from"./9aa2953e.js";const ie={components:{SvgIcon:R,ImageCon:re},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(a,{emit:o}){const{emoteHistory:d}=F(),e=A({name:"history",emote:d.value}),t=A([]),h=w("history"),p=s=>{if(h.value=s.name,s.emote.length===0)return L(s.name).then(c=>{h.value=s.name,s.emote=c.emote.map(S=>({...S,scope:s.name}))})},f=()=>{t.splice(0,t.length),t.push(e),N().then(s=>{t.push(...s.sort((c,S)=>{const b=d.value.findIndex(x=>x.scope===c.name),v=d.value.findIndex(x=>x.scope===S.name);return(b===-1?1/0:b)-(v===-1?1/0:v)})),t.push({name:"add",emote:[]})})};return f(),{onSelect:s=>{o("select",s),d.value=d.value.filter(c=>!(c.scope===s.scope&&c.name===s.name)),d.value=[s,...d.value].slice(0,30),e.emote=d.value},addEmotePackage:()=>{O({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:s=>q(s.inputValue).then(()=>{D.success("添加成功"),f()}),inputValidator:s=>/^\d+$/.test(s),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:h,emotePackages:t,selectScope:p}}},de={class:"emote-selector"},ue={class:"emotes"},me={class:"scopes"},fe=["onClick"];function he(a,o,d,e,t,h){const p=y("ImageCon"),f=y("SvgIcon");return m(),g("div",de,[u("div",ue,[(m(!0),g(V,null,P((e.emotePackages.find(n=>n.name===e.currentScope)||{}).emote||[],n=>(m(),H(p,{key:n.name,class:"emote",alt:n.name,src:`/kooritea/kooritea.github.io/emoji/${n.scope}/${n.name}.png`,onClick:_=>e.onSelect(n)},{error:I(()=>[u("span",null,M(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),u("div",me,[(m(!0),g(V,null,P(e.emotePackages,n=>(m(),g("div",{key:n.name,class:T(["scope",{"selected-scope":e.currentScope===n.name}]),onClick:()=>{n.name==="add"?e.addEmotePackage():e.selectScope(n)}},[n.name==="history"?(m(),H(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(m(),H(f,{key:1,class:"emote history",name:"add"})):(m(),H(p,{key:2,class:"emote",src:`/kooritea/kooritea.github.io/emoji/${n.name}/${n.name}.png`},{error:I(()=>[u("span",null,M(n.name),1)]),_:2},1032,["src"]))],10,fe))),128))])])}const pe=U(ie,[["render",he],["__scopeId","data-v-aba84f95"]]);function ve(a){const o=w(null),d=z(se,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:o.value,"onUpdate:modelValue":e=>{var t;o.value=e,(t=d.component)!=null&&t.props&&(d.component.props.modelValue=e)}});O({title:"选择预约时间",message:d,confirmHandlerPromise:e=>a(o),inputValidator:e=>!!o.value,inputErrorMessage:"请选择预约时间"})}const B={},ge={components:{SvgIcon:R,Markdown:le,ButtonBox:K,EmoteSelector:pe,ElPopover:ce},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(a,{emit:o}){const{darkMode:d}=W(),e=w(!0),{computedModelValue:t}=Y(a,o),h=w(!1),p=w(null);if(a.cache){const l=G();if(B[l.fullPath]&&a.cache===!0)D.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const r="MDEditorCache."+(a.cache===!0?l.fullPath:`${l.fullPath}.${a.cache}`);t.value=localStorage.getItem(r)||a.defaultValue;let i=null;Q(()=>{B[r]=!0,i=setInterval(()=>{h.value=!0,localStorage.setItem(r,t.value||"")},1e3)}),Z(()=>{B[r]=!1,clearInterval(i)}),J(t,()=>{h.value=!1})}}const f=l=>{const r=p.value.selectionStart,i=t.value.slice(0,r),k=t.value.slice(r);t.value=`${i}${l}${k}`},n=w(t.value),_=({reservationDate:l}={})=>{const r=a.onSubmit(t.value,l==null?void 0:l.value);return r instanceof Promise?r.then(()=>{t.value=a.defaultValue,n.value=a.defaultValue}):(t.value=a.defaultValue,n.value=a.defaultValue),r},s=()=>{t.value=""},c=()=>{t.value=n.value},S=[{name:"提交",type:"primary",handler:_,show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("submit"):a.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{ve(l=>{_({reservationDate:l})})},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reservation"):a.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:s,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("clean"):a.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:c,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reset"):a.showDefaultHandlers)&&!!n.value,sort:30}],b=X(()=>[...S,...a.exHandlers]),v=l=>{const r=ne(URL.createObjectURL(l),{handlers:[{name:"上传",type:"primary",handler:()=>{const i=new Date().valueOf().toString();f(`![${i}](--------------------)`),oe(l,k=>{const C=Math.round(100*event.loaded/event.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${i}](${"#".repeat(C)}${"-".repeat(20-C)})`)}).then(k=>{t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${k.keyname}](${k.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),"")}),r.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{j(l,16,9).then(i=>{r.callClose(),v(i)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{j(l,160,67).then(i=>{r.callClose(),v(i)})}},{name:"取消",type:"default",handler:()=>{r.callClose()}}]})};return{darkMode:d,isEditMode:e,computedModelValue:t,resetCache:n,isSave:h,handlers:b,submitHandler:_,cleanHandler:s,resetHandler:c,previewImageBeforeUpload:v,pasteHandler:l=>{if(!(l.clipboardData&&l.clipboardData.items))return;const r=Array.from(l.clipboardData.items).filter(i=>i.kind==="file");if(r.length>0){l.preventDefault();for(const i of r)if(i.type.startsWith("image/")){v(i.getAsFile());return}else D.warning(`不支持的文件类型: ${i.type}`)}},dropHandler:l=>{for(const r of l.dataTransfer.files)if(l.preventDefault(),r.type.startsWith("image/")){v(r);return}else D.warning(`不支持的文件类型: ${r.type}`)},textarea:p,insertText:f}}},_e={class:"md-editor"},ye={class:"fill"},we={key:1,class:"preview"},Se={class:"bar"},ke={class:"bar-left"},Ee={class:"title"},He={class:"uploader"},Me={class:"bar-right"},be={key:0,class:"is-save info"};function xe(a,o,d,e,t,h){const p=y("Markdown"),f=y("SvgIcon"),n=y("EmoteSelector"),_=y("el-popover"),s=y("ButtonBox");return m(),g(V,null,[u("div",_e,[e.isEditMode?(m(),g("div",{key:0,class:T(["textarea-box",{"auto-height":d.autoHeight}])},[u("pre",ye,M(e.computedModelValue),1),ee(u("textarea",{ref:"textarea","onUpdate:modelValue":o[0]||(o[0]=c=>e.computedModelValue=c),class:"textarea",onPaste:o[1]||(o[1]=(...c)=>e.pasteHandler&&e.pasteHandler(...c)),onDragover:o[2]||(o[2]=ae(()=>{},["prevent"])),onDrop:o[3]||(o[3]=(...c)=>e.dropHandler&&e.dropHandler(...c))},null,544),[[te,e.computedModelValue]])],2)):(m(),g("div",we,[E(p,{"model-value":e.computedModelValue},null,8,["model-value"])])),u("div",Se,[u("div",ke,[u("div",Ee,M(d.title),1),u("label",He,[E(f,{class:"button",name:"14"}),u("input",{type:"file",accept:"image/*",onChange:o[4]||(o[4]=c=>{e.previewImageBeforeUpload(c.srcElement.files[0]),c.srcElement.value=""})},null,32)]),E(_,{width:"auto",trigger:"click",effect:e.darkMode?"dark":"light"},{reference:I(()=>[E(f,{class:"button",name:"biaoqing"})]),default:I(()=>[E(n,{onSelect:o[5]||(o[5]=c=>{e.insertText(`[emoji ${c.scope}/${c.name}]`)})})]),_:1},8,["effect"])]),u("div",Me,[e.isSave?(m(),g("span",be,"已保存")):$("",!0),u("span",{class:"preview-switch button",onClick:o[6]||(o[6]=c=>e.isEditMode=!e.isEditMode)},M(e.isEditMode?"预览":"返回编辑"),1)])])]),e.handlers.length>0?(m(),H(s,{key:0,handlers:e.handlers},null,8,["handlers"])):$("",!0)],64)}const De=U(ge,[["render",xe],["__scopeId","data-v-39666810"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{De as M,Te as a,ve as u};
