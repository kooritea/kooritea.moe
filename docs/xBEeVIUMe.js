import{P as A}from"./xDxly3N35.js";import{_ as B,$ as C,A as E,u as P,p as V,r as b,b as I,z as l,f as g,w as T,a0 as k,a1 as H,j as p,k as L,l as S,a2 as D,a3 as K}from"./assets/index-CvIYzVtv.js";const U={components:{PageHeader:A,TextInput:C,AsyncButtom:E},setup(){const{temporaryPublicKey:m}=P(),{usernameCache:n,accessKey:y,accessExp:a,isExpiredGreatOldOne:f}=V(),w=D(),d=K(),s=b(n.value),u=b("");function c(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let o=0,i=e.length;o<i;o++)r[o]=e.charCodeAt(o);return t}function _(e){const o=e.substring("-----BEGIN PUBLIC KEY-----".length,e.length-"-----END PUBLIC KEY-----".length),i=window.atob(o),v=c(i);return window.crypto.subtle.importKey("spki",v,{name:"RSA-OAEP",hash:"SHA-1"},!0,["encrypt"])}function x(e){const t=new Uint8Array(e);let r="";for(let o=0;o<t.byteLength;o++)r+=String.fromCharCode(t[o]);return btoa(r)}async function h(e){if(!window.crypto.subtle)throw new Error("仅HTTPS环境可用");const t=new TextEncoder().encode(e),r=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},await _(m.value),t);return x(r)}return{username:s,password:u,access:()=>h(u.value).then(e=>k(s.value,e).then(t=>{H.success("认证成功"),y.value=t.token,a.value=t.exp,f.value=!0,n.value=s.value,d.push({path:w.query.redirect||"/great-old-one/index"})}))}}},N={class:"page"},R={class:"login-box"},O={class:"button-box"};function F(m,n,y,a,f,w){const d=p("PageHeader"),s=p("TextInput"),u=p("AsyncButtom");return L(),I("div",N,[l(d),g("div",R,[l(s,{modelValue:a.username,"onUpdate:modelValue":n[0]||(n[0]=c=>a.username=c),border:""},null,8,["modelValue"]),l(s,{modelValue:a.password,"onUpdate:modelValue":n[1]||(n[1]=c=>a.password=c),border:"",type:"password"},null,8,["modelValue"]),g("div",O,[l(u,{onLoadingClick:a.access},{default:T(()=>n[2]||(n[2]=[S(" 契约 ")])),_:1},8,["onLoadingClick"])])])])}const q=B(U,[["render",F],["__scopeId","data-v-d6572192"]]);export{q as default};
