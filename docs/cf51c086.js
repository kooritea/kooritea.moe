import{a as de,_ as U,al as ue,b as _,P as G,d as s,e as V,F as v,E as b,m as k,f as g,aT as S,h as z,aU as y,aV as M,i as $,t as D,aQ as E,w as c,l as A,g as w,Q as x,p as I,n as L,aW as fe,aX as Y,aY as q,aZ as ee,a_ as me}from"./assets/index-cf86c5d1.js";import{d as K}from"./02b52d33.js";import"./vander_commonjsHelpers-87174ba5.js";const he={},ce={},H={BaseOptionsLoader:async t=>(console.warn("未设置基础库映射表加载方法，无法使用optionsBaseCode字段"),[]),ComponentCover:{}},j=function(t,r){let l=t,o=r;if(typeof r=="string"){const i=r.split(".");o=i.pop();for(const e of i)t[e]||(t[e]=T({})),l=t[e]}return[l,o]};function te(t,r){const l=[];for(const o in t){const i=(r?`${r}.`:"")+o;typeof t[o]=="object"&&t[o]!==null&&!Array.isArray(t[o])?l.push(...te(t[o],i)):l.push(i)}return l}function T(t){return t=de(t||{}),t._isPathObject?t:new Proxy(t,{set:(r,l,o)=>{const[i,e]=j(r,l);return i[e]=o,!0},get:(r,l)=>{if(l==="_isPathObject")return!0;if(l==="_pathKeys")return te(r);const[o,i]=j(r,l);return o[i]},has:(r,l)=>{const[o,i]=j(r,l);return i in o},deleteProperty:(r,l)=>{const[o,i]=j(r,l);return delete o[i],!0}})}const J=new Set;function ge(t){J.has(t)||(console.warn(`[EasyComponent]${t}`),J.add(t))}function le(t,r,l){for(const o of t){if(r(o))return o;if(typeof l=="number"&&(l=l-1),Array.isArray(o.children)&&(typeof l!="number"||l>0)){const i=le(o.children,r,l);if(i)return i}}}function W(t,r,l={index:-1}){for(const o of t){if(l.index++,r(o))return l.index;if(Array.isArray(o.children)){const i=W(o.children,r,l);if(i>-1)return i}}return-1}function re(t,r,l=[]){for(const o of t)r(o)&&l.push(o),Array.isArray(o.children)&&re(o.children,r,l);return l}function X(t){return JSON.stringify(t,(r,l)=>typeof l=="function"?l.toString():l)}function N(t){if(typeof t!="object"||t===null||t instanceof File)return t;if(Array.isArray(t)){const l=[];for(const o of t)l.push(N(o));return l}const r={};for(const l in t)typeof t[l]=="object"?r[l]=N(t[l]):r[l]=t[l];return r}function ae(...t){for(const r of t)if(r!==void 0)return r}const R=T({}),Z=[];function ie(t){if(Array.isArray(R[t]))return R[t];if(!R[t]&&!Z.includes(t))if(typeof H.BaseOptionsLoader=="function"){if(R[t]=H.BaseOptionsLoader(t),Array.isArray(R[t]))return R[t];if(R[t]instanceof Promise)return R[t].then(r=>{if(Array.isArray(r))R[t]=r;else throw new Error("BaseOptionsLoader必须返回Array或Promise<Array>")}).catch(r=>{console.error(r),Z.push(t),delete R[t]}),[];throw new Error("BaseOptionsLoader必须返回Array或Promise<Array>")}else throw new Error("BaseOptionsLoader必须是一个方法");return[]}const pe={name:"EasyFormItem",components:{Plus:ue},props:{field:{type:Object,default:()=>({})},componentScope:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},configReadOnly:{type:Boolean,default:()=>!1},configIsView:{type:Boolean,default:()=>!1},configTrim:{type:Boolean,default:()=>!0},configDisableValidates:{type:Boolean,default:()=>!1},configSelectEditMode:{type:Boolean,default:()=>!1},dontValidateRequired:{type:Boolean,default:()=>!1},useSubmitValidate:{type:Boolean,default:()=>!1},itemController:{type:Object,default:()=>({})},selectEditProps:{type:Array,default:()=>[]}},emits:["change","update:rules","beforeDestroy","created"],data(){return{isEasyFormItem:!0,onChangeTimer:null,onChangeIsFromUser:!1,appendModel:"",OptionsMap:R}},computed:{ComponentConfig(){return H},easyFormItemScope(){return{...this._componentScope,options:this.options,optionsLoading:this.optionsLoading,placeholder:this.placeholder,isMultipleValue:this.isMultipleValue,isView:this.isView,disabled:this._disabled,viewValue:typeof this.field.viewer=="function"?this.field.viewer(this._componentScope,this.modelValue):this.defaultViewer(),getPropValue:this.getPropValue,getFormProps:this.getFormProps}},_componentScope(){return{formData:this.formDataRef,field:this.field,getOptionValue:this.getOptionValue,fieldInstance:this,...this.componentScope}},formDataRef(){return this.formData},componentModel:{set(t){this.modelValue=this.applyComputed(t,"set")},get(){return this.applyComputed(this.modelValue,"get")}},modelValue:{set(t){if(this.getFormProps("allowCreate")===!0&&this.field.createOptionValidator){const r=t.find(l=>!this.options.some(o=>o.value===l));if(r){if(this.field.createOptionValidator(this._componentScope,r)){this.formDataRef[this.field.prop]=t,this.callOnChange(t,!0);return}}else this.formDataRef[this.field.prop]=t,this.callOnChange(t,!0);return}else this.formDataRef[this.field.prop]=t,this.callOnChange(t,!0)},get(){return this.initModelValue(),this.formDataRef[this.field.prop]}},fieldType(){return this.getPropValue(this.field.type)},placeholder(){if(this.getPropValue(this.configReadOnly))return"未录入";{const t=this.getValueByLevel(this.getPropValue(this.field.placeholder),this.getFormProps("placeholder"));return t||`${this.fieldTips}${this.getPropValue(this.field.label)||""}`}},isView(){return this.fieldType==="view"||this.getValueByLevel(this.getPropValue(this.field.isView),this.getPropValue(this.configIsView))},isMultipleValue(){return["checkbox"].includes(this.fieldType)||this.fieldType==="select"&&this.getFormProps("multiple")===!0||this.fieldType==="cascader"&&(this.getFormProps("props")||{}).multiple===!0||this.getPropValue(this.field.multiple)},fieldTips(){if(this.field.fieldTips)return this.field.fieldTips;switch(this.fieldType){case"textarea":case"input":return"请输入";case"select":case"radio":case"checkbox":case"date-picker":return"请选择";default:return"请录入"}},options(){return this.getOptions(this.field.options,this.field.optionsBaseCode)},optionsFilterShow(){return this.optionsFilterShowMethod(this.options)},rules(){let t=[];const r=this.getValueByLevel(this.getPropValue(this.field.disableValidates),this.getPropValue(this.configDisableValidates));if(this.field.prop&&!this.isView&&!r&&this.isSelectEditModeAndCanEditOrNot){const l={input:"blur",textarea:"blur",select:"change","date-picker":"change",radio:"change",checkbox:"change"}[this.field.type]||"submit";t=(this.getPropValue(this.field.rules)||[]).filter(o=>!!o).map(o=>{if(o.trigger===void 0&&(o.trigger=o.trigger||l),o.trigger==="submit"){const i=o.validator;o.validator=(e,m,h)=>{this.useSubmitValidate?i(e,m,h):h()}}return o}),this.getPropValue(this.field.required)&&t.push({required:!0,message:this.getPropValue(this.field.requiredMessage)||this.fieldTips+(this.getPropValue(this.field.label)||""),trigger:l,validator:(o,i,e)=>{this.dontValidateRequired&&!this.getPropValue(this.field.forceRequired)?e():this.isMultipleValue?e(Array.isArray(i)&&i.length>0?void 0:o.message):e([void 0,null,""].includes(i)?o.message:void 0)}}),t.push({trigger:"submit",validator:(o,i,e)=>{if(!this.modelValue){e();return}if(!this.useSubmitValidate){e();return}if(this.fieldType==="select"&&this.getFormProps("remote")===!0){e();return}if(this.fieldType==="select"&&this.getFormProps("allowCreate")===!0){e();return}if(this.getPropValue(this.field.dontValidateOption)){e();return}if(["radio","select","cascader"].includes(this.fieldType)&&!this.isMultipleValue){const m=this.findOption(null,{predicate:h=>{if(typeof h.value=="object"&&h.value!==null){const C=this.modelValue?this.modelValue._key:"",p=C===h.value._key;return!p&&String(C)&&String(C)===String(h.value._key)&&console.warn(`所选值[${C}](${typeof C})与选项值[${h.value._key}](${typeof h.value._key})类型不一致`),p}else{const C=this.modelValue===h.value;return!C&&String(this.modelValue)&&String(this.modelValue)===String(h.value)&&console.warn(`所选值[${this.modelValue}](${typeof this.modelValue})与选项值[${h.value}](${typeof h.value})类型不一致`),C}}});if(m){if(m.show===!1){const h=this.getPropValue(m.notFoundReason,i,m,this.options);e(h||`选择的[${this.modelValue}]不存在于选项中，请重新选择。`),this.modelValue="";return}else if(m.disabled===!0){const h=this.getPropValue(m.disabledReason,i,m,this.options);e(h||`当前选择的[${m.label}]已禁用，请重新选择。`),this.modelValue="";return}}else{let h="";this.$refs.ElComponent&&(h=this.$refs.ElComponent.selectedLabel),e(`选择的[${h||this.modelValue}]不存在于选项中，请重新选择。`),this.modelValue="";return}}else if(this.isMultipleValue&&Array.isArray(this.modelValue))for(const m of this.modelValue){const h=this.findOption(m);if(h){if(h.show===!1){e(`选择的[${h.label}]不存在于选项中，此项已重置，请重新选择。`),this.modelValue=[];return}else if(h.disabled===!0){e(`选择的[${h.label}]已禁用，此项已重置，请重新选择。`),this.modelValue=[];return}}else{e(`选择的[${m}]不存在于选项中，此项已重置，请重新选择。`),this.modelValue=[];return}}e()}})}return t},_disabled(){return this.configReadOnly||this.getFormProps("disabled")||this.getPropValue(this.field.disabled)||this.itemController.disabled||!this.isSelectEditModeAndCanEditOrNot},isSelectEditModeAndCanEditOrNot(){return!this.configSelectEditMode||this.selectEditProps.includes(this.field.prop)},buttons(){return(this.getPropValue(this.field.buttons)||[]).filter(t=>this.getPropValue(t.show)!==!1)},optionsLoading(){if(this.itemController.userOptionsLoading)return!0;const t=this.getPropValue(this.field.optionsBaseCode);return t?this.OptionsMap[t]instanceof Promise:!1}},watch:{fieldType:{immediate:!0,handler(t){t==="cascader"&&ge("cascader为测试中的组件，建议使用type: slot 自行实现")}},modelValue(t,r){this.callOnChange(t,!1)},rules(t){this.$emit("update:rules",t)}},created(){this.initModelValue(),this.$emit("update:rules",this.rules),this.$emit("created",this),this.callOnChange(this.modelValue,!1),this.callOnCreated()},mounted(){this.callOnMounted()},beforeUnmount(){this.$emit("beforeDestroy",this)},methods:{getOptions(t,r,l){const o=r?ie(this.getPropValue(r)):[],i=t?this.getPropValue(t,o)||[]:o,{labelKeyName:e="label",valueKeyName:m="value",childrenKeyName:h="children",leafKeyName:F="leaf",isLeaf:C,subLabel:p}=this.getPropValue(this.field.optionConfig)||{};return i.map(d=>typeof d=="object"?{...d,label:[void 0,null].includes(d[e])?d[m]:d[e],value:[void 0,null].includes(d[m])?d[e]:d[m],children:d[h],leaf:d[F]}:{value:d,label:d}).map(d=>{const u={};for(const n in d)u[n]=this.getPropValue(d[n]);return u}).map(d=>{const u=[];l&&(Array.isArray(l._parent)&&l._parent.length>0&&u.push(...l._parent),u.push({...l,children:void 0}));const n={...d,_parent:u};let a;return typeof C=="function"?a=C(d)?void 0:this.getOptions(d.children||[],void 0,n):a=d.children?this.getOptions(d.children,void 0,n):void 0,n.children=a,n}).map(d=>{const u=typeof d.value=="object"&&d.value!==null;return u&&!d.key&&console.error("当value为Object时，必须为Options的每一个对象设置一个key值",i),u?{...d,value:{_key:d.key,...d.value}}:{_key:d.key??d.value,...d}}).map(d=>{const u=typeof p=="function"?p(d):p;return{...d,subLabel:u===void 0&&d.subLabel===void 0?(d._parent||[]).map(n=>n.label).join(this.getFormProps("separator")||"/"):d.subLabel||u}})},optionsFilterShowMethod(t){return t.filter(r=>r.show!==!1).map(r=>({...r,children:Array.isArray(r.children)?this.optionsFilterShowMethod(r.children):void 0}))},getOptionValue(t="",r){if(t&&t!==this.field.prop)throw new Error("组件上层未提供getOptionValue，无法查询其他项的值");return this.isMultipleValue?this.modelValue.map(l=>this.findOption(l,r)).filter(l=>!!l):this.findOption(this.modelValue,r)},getFormProps(t){return(this.getPropValue(this.field.formProps)||{})[t]},initModelValue(){if(this.field.prop){if(this.formDataRef&&!(this.field.prop in this.formDataRef)&&(this.formDataRef[this.field.prop]=void 0),this.formDataRef[this.field.prop]===void 0||this.formDataRef[this.field.prop]===null)if(this.field.defaultValue!==void 0)if(typeof this.field.defaultValue=="function")try{this.formDataRef[this.field.prop]=this.field.defaultValue(this._componentScope,this.formDataRef[this.field.prop])}catch(t){console.error(t)}else this.formDataRef[this.field.prop]=this.field.defaultValue;else this.isMultipleValue?this.formDataRef[this.field.prop]=[]:this.fieldType==="date-picker"&&this.getFormProps("type")==="daterange"&&(this.formDataRef[this.field.prop]=[]);else if(this.field.praseValue)if(typeof this.field.praseValue=="function")try{this.formDataRef[this.field.prop]=this.field.praseValue(this._componentScope,this.formDataRef[this.field.prop])}catch(t){console.error(t)}else this.formDataRef[this.field.prop]=this.field.praseValue;else if(this.isMultipleValue&&typeof this.formDataRef[this.field.prop]=="string"&&this.getPropValue(this.field.valueSplitChar)){const t=this.formDataRef[this.field.prop];this.formDataRef[this.field.prop]=t?t.split(this.getPropValue(this.field.valueSplitChar)):[]}if(this.isMultipleValue&&Array.isArray(this.formDataRef[this.field.prop]))for(const t of re(this.options,r=>r.required))this.formDataRef[this.field.prop].includes(t.value)||this.formDataRef[this.field.prop].push(t.value)}},callButtonHandler(t){t.loading=!0;try{const r=t.handler(this._componentScope,t);r instanceof Promise?r.finally(()=>{t.loading=!1}):t.loading=!1}catch(r){console.error(r),t.loading=!1}},callOnChange(t,r){this.onChangeIsFromUser=this.onChangeIsFromUser||r,this.onChangeTimer===null&&(this.onChangeTimer=setTimeout(()=>{var l;try{if(this.fieldType==="date-picker"){if(this.getFormProps("type")==="daterange"&&Array.isArray(this.modelValue)){const o=this.getFormProps("valueFormat")||"YYYY-MM-DD HH:mm:ss",i=new Date(this.modelValue[0]);i.setHours(0,0,0,0);const e=new Date(this.modelValue[1]);e.setHours(23,59,59,999),this.modelValue[0]=K(i).format(o),this.modelValue[1]=K(e).format(o)}Array.isArray(this.modelValue)||(this.modelValue=K(this.modelValue).format(this.getFormProps("valueFormat")||"YYYY-MM-DD HH:mm:ss"))}this.field.cnProp&&(this.formDataRef[this.field.cnProp]=(l=this.options.find(o=>this.modelValue===o.value))==null?void 0:l.label),typeof this.field.onChange=="function"&&this.field.onChange(this._componentScope,this.modelValue,this.onChangeIsFromUser),this.$emit("change",this._componentScope,this.modelValue,this.onChangeIsFromUser)}catch(o){console.error(o)}this.onChangeTimer=null,this.onChangeIsFromUser=!1}))},callOnCreated(){if(typeof this.field.onCreated=="function")try{this.field.onCreated(this._componentScope)}catch(t){console.error(t)}},callOnMounted(){if(typeof this.field.onMounted=="function")try{this.field.onMounted(this._componentScope)}catch(t){console.error(t)}},getPropValue(t,...r){return typeof t=="function"?t(this._componentScope,...r):t},getPropArrayValue(t,...r){const l=this.getPropValue(t,...r);return[null,void 0].includes(l)?[]:Array.isArray(l)?l:[l]},getValueByLevel(...t){for(const r of t)if(r!==void 0)return r},defaultViewer(){if(this.isMultipleValue&&Array.isArray(this.modelValue))return this.modelValue.map(t=>{const r=this.findOption(t);return r?r.label:t}).join("、");{let t=this.modelValue;const r=this.findOption(t);if(r)return r.label;if(t&&this.fieldType==="date-picker"&&this.getFormProps("format")){const l=K(t);return l.isValid()?l.format(this.getFormProps("format")||"YYYY-MM-DD"):t}return this.getPropValue(this.field.append)&&(t=`${t}${this.getPropValue(this.field.append)}`),this.getPropValue(this.field.prepend)&&(t=`${this.getPropValue(this.field.prepend)}${t}`),t}},parseData(){let t=typeof this.modelValue=="object"?N(this.modelValue):this.modelValue;const r="value";if(this.isMultipleValue&&(t=t.sort((l,o)=>W(this.options,i=>l===i.value)-W(this.options,i=>o===i.value))),typeof this.field.valueFormat=="function")try{t=this.field.valueFormat(this._componentScope,t)}catch(l){console.error(l)}else this.isMultipleValue&&this.getPropValue(this.field.valueSplitChar)&&(t=t.join(this.getPropValue(this.field.valueSplitChar)));return t=this.trimValue(t),{value:t,type:r}},getComputer(){const t=this.getPropValue(this.field.computer);if(t)return t;{const r=this.getPropValue(this.field.autoAppend);return{get:l=>{if(r&&l)if(Array.isArray(r)){for(const o of this.getOptions(r))if(l.endsWith(o.value))return l.slice(0,l.length-o.value.length)}else return l.slice(0,l.length-r.length);return this.trimValue(l)},set:l=>r&&l?Array.isArray(r)?l+this.appendModel:l+r:this.isMultipleValue&&Array.isArray(l)?l.sort((o,i)=>W(this.options,e=>o===e.value)-W(this.options,e=>i===e.value)):this.trimValue(l)}}},applyComputed(t,r){const l=this.getComputer();if(r==="get")return l.get(t);if(r==="set")return l.set(t)},trimValue(t){return this.getValueByLevel(this.field.trim,this.configTrim)!==!1&&typeof t=="string"?t.trim():t},findOption(t,{predicate:r,deepLimit:l}={}){return le(this.options,r||(o=>o.value===t),l||(this.fieldType==="cascader"?void 0:1))}}},ye={key:0,class:"name"},Ve={key:1},Pe={key:0,class:"el-icon-loading"},_e={key:1,class:"el-icon-search"},be={key:1,class:"select-option-item-label"},Ce={key:2,class:"select-option-item-subLabel"},we={key:16,style:{"margin-left":"10px","flex-shrink":"0"}};function Fe(t,r,l,o,i,e){var n;const m=_("el-option"),h=_("el-select"),F=_("el-checkbox"),C=_("Plus"),p=_("el-icon"),d=_("el-button"),u=G("loading");return s(),V("div",null,[(s(!0),V(v,null,b(e.getPropArrayValue(l.field.beforeSlotName),a=>k(t.$slots,a,{formData:e.formDataRef,field:l.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0)),256)),(s(!0),V(v,null,b(e.getPropArrayValue(l.field.beforeSlot),a=>(s(),g(S(a),{key:a,"form-data":e.formDataRef,field:l.field,options:e.options,"is-view":e.isView,disabled:e._disabled,"view-value":typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),"get-prop-value":e.getPropValue},null,8,["form-data","field","options","is-view","disabled","view-value","get-prop-value"]))),128)),z("div",{class:L(["easy-form-item",{"default-display":!["slot","component"].includes(e.fieldType)||e.getPropValue(l.field.useDefaultDisplay),["easy-form-item-"+e.fieldType]:!0,["easy-form-item-"+(l.field.prop||l.field.key)]:!0}])},[e.fieldType==="slot"?k(t.$slots,e.getPropValue(l.field.slotName),{key:0,formData:e.formDataRef,field:l.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0):e.fieldType==="component"?(s(),g(S(e.getPropValue(l.field.is)),y({key:1,modelValue:e.componentModel,"onUpdate:modelValue":r[0]||(r[0]=a=>e.componentModel=a),easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps),M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","easyFormItemScope"])):e.isView?(s(),V("span",{key:2,class:"el-form-item-view",style:$({"white-space":e.fieldType==="textarea"?"pre-wrap":void 0})},D(typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer()),5)):["input","textarea"].includes(e.fieldType)?(s(),g(S(e.optionsFilterShow.length>0&&e.fieldType!=="textarea"?"el-autocomplete":"el-input"),y({key:3,modelValue:e.componentModel,"onUpdate:modelValue":r[2]||(r[2]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,type:e.getFormProps("type")||(e.fieldType==="textarea"?"textarea":void 0)},{rows:5,showWordLimit:!!e.getFormProps("maxlength"),fetchSuggestions:(a,P)=>{P(e.optionsFilterShow.filter(f=>f.filter===void 0?!a||f.label.includes(a):e.getPropValue(f.filter,a,f)))},...e.getPropValue(l.field.formProps)||{}},M(e.getPropValue(l.field.formListeners)||{})),E({default:c(a=>[a?(s(),V("div",ye,D(a.item.label),1)):w("",!0)]),_:2},[e.getPropValue(l.field.prepend)?{name:"prepend",fn:c(()=>[A(D(e.getPropValue(l.field.prepend)),1)]),key:"0"}:void 0,e.getPropValue(l.field.autoAppend)||e.getPropValue(l.field.append)?{name:"append",fn:c(()=>[Array.isArray(e.getPropValue(l.field.autoAppend))?(s(),g(h,{key:0,modelValue:i.appendModel,"onUpdate:modelValue":r[1]||(r[1]=a=>i.appendModel=a),loading:e.optionsLoading,"loading-text":e.getFormProps("loadingText")||"正在加载远程数据"},{default:c(()=>[(s(!0),V(v,null,b(e.getOptions(e.getPropValue(l.field.autoAppend)).filter(a=>a.show!==!1),a=>(s(),g(m,{key:a.key||a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","loading-text"])):(s(),V("span",Ve,D(e.getPropValue(l.field.autoAppend)||e.getPropValue(l.field.append)),1))]),key:"1"}:void 0]),1040,["modelValue","placeholder","disabled","type"])):e.fieldType==="number"?(s(),g(S(e.ComponentConfig.ComponentCover.number||"el-input-number"),y({key:4,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":r[3]||(r[3]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{...e.getPropValue(l.field.formProps,e.options)||{}},M(e.getPropValue(l.field.formListeners,e.options)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="select"?(s(),g(S(e.ComponentConfig.ComponentCover.select||"el-select"),y({key:5,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":r[4]||(r[4]=a=>e.componentModel=a),placeholder:e.placeholder,"value-key":"_key",disabled:e._disabled,filterable:e.getValueByLevel(e.getFormProps("filterable"),e.optionsFilterShow.length>7),"popper-class":["easy-form-item-select","easy-form-item-"+l.field.prop,e.getFormProps("popperClass")||""].join(" "),multiple:e.isMultipleValue,loading:e.optionsLoading,"loading-text":e.getFormProps("loadingText")||"正在加载远程数据",easyFormItemScope:e.easyFormItemScope},{clearable:!0,...e.getPropValue(l.field.formProps,e.options)||{}},M(e.getPropValue(l.field.formListeners,e.options)||{})),E({default:c(()=>[(s(!0),V(v,null,b(e.optionsFilterShow,a=>(s(),g(m,{key:a.key||a.value,label:a.label,value:a.value,disabled:a.disabled||e.isMultipleValue&&a.required},{default:c(()=>[z("div",y({class:"select-option-item"},M(e.getPropValue(a.listeners||l.field.optionListeners,a)||{},!0)),[e.isMultipleValue?(s(),g(F,{key:0,modelValue:e.modelValue.includes(a.value),class:"select-option-item-label",value:a.value,disabled:a.disabled||a.required},{default:c(()=>[A(D(a.label),1)]),_:2},1032,["modelValue","value","disabled"])):(s(),V("div",be,D(a.label),1)),a.subLabel?(s(),V("div",Ce,D(a.subLabel),1)):w("",!0)],16)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.getValueByLevel(e.getFormProps("filterable"),e.optionsFilterShow.length>7)||e.optionsLoading?{name:"prefix",fn:c(()=>[e.optionsLoading?(s(),V("i",Pe)):(s(),V("i",_e))]),key:"0"}:void 0]),1040,["modelValue","placeholder","disabled","filterable","popper-class","multiple","loading","loading-text","easyFormItemScope"])):e.fieldType==="cascader"?x((s(),g(S(e.ComponentConfig.ComponentCover.cascader||"el-cascader"),y({key:6,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":r[5]||(r[5]=a=>e.componentModel=a),placeholder:e.placeholder,options:e.optionsFilterShow,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{clearable:!0,filterable:!0,showAllLevels:!1,...e.getPropValue(l.field.formProps),props:{multiple:e.isMultipleValue,emitPath:!1,...e.getFormProps("props")||{}}},M(e.getPropValue(l.field.formListeners,e.options)||{})),null,16,["modelValue","placeholder","options","disabled","easyFormItemScope"])),[[u,e.optionsLoading]]):e.fieldType==="date-picker"?(s(),g(S(e.ComponentConfig.ComponentCover["date-picker"]||"el-date-picker"),y({key:7,modelValue:e.componentModel,"onUpdate:modelValue":r[6]||(r[6]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD",...e.getPropValue(l.field.formProps)},M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="time-picker"?(s(),g(S(e.ComponentConfig.ComponentCover["time-picker"]||"el-time-picker"),y({key:8,modelValue:e.componentModel,"onUpdate:modelValue":r[7]||(r[7]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{valueFormat:"HH:mm:ss",format:"HH:mm:ss",...e.getPropValue(l.field.formProps)},M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="radio"?x((s(),g(S(e.ComponentConfig.ComponentCover.radio||"el-radio-group"),y({key:9,modelValue:e.componentModel,"onUpdate:modelValue":r[8]||(r[8]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps,e.options),M(e.getPropValue(l.field.formListeners,e.options)||{})),{default:c(()=>[(s(!0),V(v,null,b(e.optionsFilterShow,a=>(s(),g(S(l.field.useRadioButton?"el-radio-button":"el-radio"),{key:a.key||a.value,value:a.value,disabled:a.disabled,border:l.field.border},{default:c(()=>[A(D(a.label),1)]),_:2},1032,["value","disabled","border"]))),128))]),_:1},16,["modelValue","placeholder","disabled","easyFormItemScope"])),[[u,e.optionsLoading]]):e.fieldType==="checkbox"?x((s(),g(S(e.ComponentConfig.ComponentCover.checkbox||"el-checkbox-group"),y({key:10,modelValue:e.componentModel,"onUpdate:modelValue":r[9]||(r[9]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps,e.options),M(e.getPropValue(l.field.formListeners,e.options)||{})),{default:c(()=>[(s(!0),V(v,null,b(e.optionsFilterShow,a=>(s(),g(F,{key:a.key||a.value,value:a.value,disabled:a.disabled||a.required},{default:c(()=>[A(D(a.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},16,["modelValue","disabled","easyFormItemScope"])),[[u,e.optionsLoading]]):e.fieldType==="confirm"?(s(),g(S(e.ComponentConfig.ComponentCover.confirm||"el-checkbox"),y({key:11,modelValue:e.componentModel,"onUpdate:modelValue":r[10]||(r[10]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps),M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="switch"?(s(),g(S(e.ComponentConfig.ComponentCover.switch||"el-switch"),y({key:12,modelValue:e.componentModel,"onUpdate:modelValue":r[11]||(r[11]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps),M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="rate"?(s(),g(S(e.ComponentConfig.ComponentCover.rate||"el-rate"),y({key:13,modelValue:e.componentModel,"onUpdate:modelValue":r[12]||(r[12]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps),M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="upload"?(s(),g(S(e.ComponentConfig.ComponentCover.upload||"el-upload"),y({key:14,class:{"el-upload-readonly":l.configReadOnly,"el-upload-limit":e.getFormProps("limit")&&Number(e.getFormProps("limit"))===((n=e.componentModel)==null?void 0:n.length)},"file-list":e.componentModel,"on-change":(a,P)=>{e.componentModel=P;const f=e.getPropValue(l.field.formProps);f&&typeof f.onChange=="function"&&f.onChange(a,P)},"on-remove":(a,P)=>{e.componentModel=P;const f=e.getPropValue(l.field.formProps);f&&typeof f.onRemove=="function"&&f.onRemove(a,P)},easyFormItemScope:e.easyFormItemScope},{action:"",autoUpload:!!e.getFormProps("action"),...e.getPropValue(l.field.formProps)||{}},M(e.getPropValue(l.field.formListeners)||{})),E({default:c(()=>[e.getFormProps("listType")==="picture-card"?(s(),g(p,{key:0},{default:c(()=>[I(C)]),_:1})):w("",!0)]),_:2},[e.getFormProps("listType")?void 0:{name:"trigger",fn:c(()=>[l.configReadOnly?w("",!0):(s(),g(d,{key:0,disabled:e._disabled,size:"small",type:"primary"},{default:c(()=>r[14]||(r[14]=[A(" 选取文件 ")])),_:1},8,["disabled"]))]),key:"0"},!l.configReadOnly&&l.field.tips?{name:"tip",fn:c(()=>[z("span",null,D(l.field.tips),1)]),key:"1"}:void 0]),1040,["class","file-list","on-change","on-remove","easyFormItemScope"])):e.ComponentConfig.ComponentCover[e.fieldType]?(s(),g(S(e.ComponentConfig.ComponentCover[e.fieldType]),y({key:15,modelValue:e.componentModel,"onUpdate:modelValue":r[13]||(r[13]=a=>e.componentModel=a),easyFormItemScope:e.easyFormItemScope},e.getPropValue(l.field.formProps),M(e.getPropValue(l.field.formListeners)||{})),null,16,["modelValue","easyFormItemScope"])):w("",!0),e.buttons.length>0?(s(),V("div",we,[(s(!0),V(v,null,b(e.buttons,a=>(s(),g(d,y({key:e.getPropValue(a.label),loading:e.getPropValue(a.loading),type:e.getPropValue(a.type),size:e.getPropValue(a.size),disabled:e.getPropValue(a.disabled),icon:e.getPropValue(a.leftIcon)||e.getPropValue(a.icon),ref_for:!0},e.getPropValue(a.buttonProps),{onClick:P=>e.callButtonHandler(a)}),{default:c(()=>[A(D(e.getPropValue(a.label))+" ",1),e.getPropValue(a.rightIcon)?(s(),V("i",{key:0,class:L(["el-icon--right",e.getPropValue(a.rightIcon)])},null,2)):w("",!0)]),_:2},1040,["loading","type","size","disabled","icon","onClick"]))),128))])):w("",!0)],2),(s(!0),V(v,null,b(e.getPropArrayValue(l.field.afterSlot),a=>(s(),g(S(a),{key:a,"form-data":e.formDataRef,field:l.field,options:e.options,"is-view":e.isView,disabled:e._disabled,"view-value":typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),"get-prop-value":e.getPropValue},null,8,["form-data","field","options","is-view","disabled","view-value","get-prop-value"]))),128)),(s(!0),V(v,null,b(e.getPropArrayValue(l.field.afterSlotName),a=>k(t.$slots,a,{formData:e.formDataRef,field:l.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof l.field.viewer=="function"?l.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0)),256))])}const Q=U(pe,[["render",Fe],["__scopeId","data-v-00770c8e"]]);const ve={components:{EasyFormItem:Q,QuestionFilled:fe},props:{fields:{type:Array,default:()=>[]},componentScope:{type:Object,default:()=>({})},formConfig:{type:Object,default:()=>({})},itemController:{type:Object,default:()=>({})},easyFormItemBindData:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},selectEditProps:{type:Array,default:()=>[]}},emits:["update:selectEditProps"],data(){return{layoutCache:{data:null,stringify:"",count:0,forceUpdate:!1}}},computed:{layout(){return this.renderLayout()},formInstance(){return this.componentScope.formInstance}},methods:{getValueByLevel:ae,getField(t){return this.fields.find(r=>r.prop===t)},getPropValue(t,...r){return typeof t=="function"?t(this.componentScope,...r):t},renderLayout(){const t=this.fields.map((i,e)=>({key:i.prop||e,...i,slotName:this.getPropValue(i.slotName),keepOnForm:this.getPropValue(i.keepOnForm),showInForm:this.getPropValue(i.showInForm),formSort:this.getPropValue(i.formSort)||1/0,type:this.getPropValue(i.type),span:this.getPropValue(i.span)})).sort((i,e)=>i.formSort-e.formSort),r=[];for(const i of t)i.showInForm!==!1&&r.push(i);const l=[];let o={type:"row",cols:[]};for(const i of r)if((i.type==="divider"||i.span===void 0)&&(i.span=24),i.span===24)o.cols.length>0&&(o.cols.push({empty:!0,span:24-o.cols.reduce((e,m)=>e+m.span,0)}),l.push(o),o={type:"row",cols:[]}),i.type==="divider"?(l.length>0&&(l[l.length-1].nextIsDivider=!0),l.push(i)):l.push({type:"row",cols:[i]});else{const e=o.cols.reduce((m,h)=>m+h.span,0);e+i.span>24?(o.cols.push({empty:!0,span:24-e}),l.push(o),o={type:"row",cols:[i]}):(o.cols.push(i),o.cols.reduce((m,h)=>m+h.span,0)===24&&(l.push(o),o={type:"row",cols:[]}))}return o.cols.length>0&&(o.cols.push({empty:!0,span:24-o.cols.reduce((i,e)=>i+e.span,0)}),l.push(o),o={type:"row",cols:[]}),this.layoutCache.stringify===X({showFields:l})?this.layoutCache.count>2?this.layoutCache.data:(this.layoutCache.count++,{showFields:l,forceUpdate:this.layoutCache.forceUpdate}):(this.layoutCache.count=0,this.layoutCache.data={showFields:l,forceUpdate:this.layoutCache.forceUpdate},this.layoutCache.stringify=X({showFields:l}),this.$nextTick(()=>{this.layoutCache.forceUpdate=!this.layoutCache.forceUpdate}),{showFields:l,forceUpdate:this.layoutCache.forceUpdate})},isView(t){return t.type==="view"||this.getValueByLevel(this.getPropValue(t.isView),this.getPropValue(this.formConfig.isView))},isDisabled(t){var r;return this.easyFormItemBindData.configReadOnly||this.getFormProps(t,"disabled")||this.getPropValue(t.disabled)||((r=this.itemController[t.prop])==null?void 0:r.disabled)},getFormProps(t,r){return(this.getPropValue(t.formProps)||{})[r]},getPropArrayValue(t,...r){const l=this.getPropValue(t,...r);return[null,void 0].includes(l)?[]:Array.isArray(l)?l:[l]}}},De={class:"default-layout"},ke={key:1},Se={key:0,class:"el-form-item-label-inline"},Oe={key:1},Me={key:1};function Re(t,r,l,o,i,e){const m=_("el-divider"),h=_("el-checkbox"),F=_("QuestionFilled"),C=_("el-icon"),p=_("el-tooltip"),d=_("EasyFormItem"),u=_("el-form-item"),n=_("el-col"),a=_("el-row");return s(),V("div",De,[(s(!0),V(v,null,b(e.layout.showFields,P=>(s(),V(v,null,[P.type==="divider"?k(t.$slots,P.slotName||"divider",{key:0,field:P,getPropValue:e.getPropValue,formData:l.formData},()=>[(s(),g(m,{key:P.key,"content-position":P.contentPosition},{default:c(()=>[A(D(e.getPropValue(P.label)),1)]),_:2},1032,["content-position"]))],!0):P.type==="row"?(s(),g(a,{key:P.cols.map(f=>f.key||f.prop).join(""),gutter:e.getValueByLevel(l.formConfig.gutter,20),class:L({["easy-form-row-"+P.cols.map(f=>e.getValueByLevel(f.prop,f.key,"")).join("-")]:!0,"next-is-divider":P.nextIsDivider})},{default:c(()=>[(s(!0),V(v,null,b(P.cols,f=>(s(),g(n,{key:f.key,span:f.span,style:$((e.getPropValue(f.styles)||{}).col),class:L(["easy-form-col-"+f.key,{"easy-form-col-view":e.isView(f),"easy-form-col-disbaled":e.isDisabled(f)}])},{default:c(()=>[f.empty?(s(),V("span",Me," ")):(s(),g(u,y({key:0,label:(e.getPropValue(f.label)||"")+(e.getValueByLevel(f.showColon,l.formConfig.showColon)?"：":""),prop:f.prop,style:{...(e.getPropValue(f.styles)||{}).formItem},class:{"hidden-label":e.getValueByLevel(f.hiddenLabel,l.formConfig.hiddenLabel),...(f.formItemProp||{}).class,["label-position-"+(l.formConfig.labelPosition||"top")]:!0,["item-type-"+(f.type||"")]:!0,["item-type-slot-"+(f.slotName||"")]:!!f.slotName},ref_for:!0},f.formItemProp),{label:c(()=>[e.getPropValue(l.formConfig.selectEditMode)&&!e.isView(f)?(s(),g(h,{key:0,checked:l.selectEditProps.includes(f.prop),onChange:O=>{O?t.$emit("update:selectEditProps",[...l.selectEditProps,f.prop]):t.$emit("update:selectEditProps",l.selectEditProps.filter(B=>B!==f.prop))}},null,8,["checked","onChange"])):w("",!0),e.getValueByLevel(f.hiddenLabel,l.formConfig.hiddenLabel)?(s(),V("span",ke)):k(t.$slots,e.getPropValue(e.getValueByLevel(f.labelSlotName,l.formConfig.labelSlotName))||"label",{key:2,formData:l.formData,field:f,getPropValue:e.getPropValue,formConfig:l.formConfig},()=>[e.getPropValue(f.label)?(s(),V("span",Se,D(e.getPropValue(f.label)+(e.getValueByLevel(f.showColon,l.formConfig.showColon)?"：":"")),1)):(s(),V("span",Oe," "))],!0),f.tips?(s(),g(p,{key:3,content:f.tips,placement:"top"},{default:c(()=>[I(C,{class:"tips"},{default:c(()=>[I(F)]),_:1})]),_:2},1032,["content"])):w("",!0)]),default:c(()=>[I(d,y({field:f,"item-controller":l.itemController[f.prop],ref_for:!0},l.easyFormItemBindData,{"onUpdate:rules":O=>{e.formInstance.updateRules(f.prop,O)},onCreated:O=>{e.formInstance.registerFormItem(f.prop,O)},onBeforeDestroy:O=>{e.formInstance.unRegisterFormItem(f.prop,O)},onChange:(O,B,se)=>{e.formInstance.clearValidate(f.prop),e.formInstance.callComponentOnChange(O,f,B,se)}}),E({[e.getPropValue(f.slotName)]:c(O=>[k(t.$slots,e.getPropValue(f.slotName),y({getField:e.getField,formConfig:l.formConfig,easyFormItemBindData:l.easyFormItemBindData,ref_for:!0},O),void 0,!0)]),_:2},[b(e.getPropArrayValue(f.beforeSlotName),O=>({name:O,fn:c(B=>[k(t.$slots,O,y({getField:e.getField,formConfig:l.formConfig,easyFormItemBindData:l.easyFormItemBindData,ref_for:!0},B),void 0,!0)])})),b(e.getPropArrayValue(f.afterSlotName),O=>({name:O,fn:c(B=>[k(t.$slots,O,y({getField:e.getField,formConfig:l.formConfig,easyFormItemBindData:l.easyFormItemBindData,ref_for:!0},B),void 0,!0)])}))]),1040,["field","item-controller","onUpdate:rules","onCreated","onBeforeDestroy","onChange"])]),_:2},1040,["label","prop","style","class"]))]),_:2},1032,["span","style","class"]))),128))]),_:2},1032,["gutter","class"])):w("",!0)],64))),256))])}const Ae=U(ve,[["render",Re],["__scopeId","data-v-fded4d70"]]);const Ie={name:"EasyForm",components:{EasyFormItem:Q,DefaultLayout:Ae},props:{fields:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>({})},formConfig:{type:Object,default:()=>({})},buttons:{type:Array,default:()=>[]},meta:{type:Object,default:()=>({})},customMode:{type:Boolean,default:()=>!1}},emits:["created","beforeDestroy","cancel","submit","valid","change"],data(){return{dontValidateRequired:!1,useSubmitValidate:!1,itemController:{},formRules:{},formItemRefs:{},selectEditProps:[]}},computed:{hiddenFields(){return this.fields.map((t,r)=>({key:t.prop||r,...t,slotName:this.getPropValue(t.slotName),keepOnForm:this.getPropValue(t.keepOnForm),showInForm:this.getPropValue(t.showInForm),formSort:this.getPropValue(t.formSort)||1/0,type:this.getPropValue(t.type),span:this.getPropValue(t.span)})).sort((t,r)=>t.formSort-r.formSort).filter(t=>t.showInForm===!1&&t.keepOnForm)},allSlotName(){return Object.keys(this.$slots)},componentScope(){return{formData:this.formData,formConfig:this._formConfig,formInstance:this,getOptionValue:this.getOptionValue,setOptionLoading:this.setOptionLoading,getPropValue:this.getPropValue,formRules:this.formRules,meta:this.meta,updateRules:this.updateRules,registerFormItem:this.registerFormItem,unRegisterFormItem:this.unRegisterFormItem}},formData(){return T(this.modelValue)},_formConfig(){return{...he,...this.formConfig}},_buttons(){return this.patchButtons(this.buttons),this.buttons},easyFormItemBindData(){return{componentScope:this.componentScope,configReadOnly:this.getPropValue(this._formConfig.readOnly),configIsView:this.getPropValue(this._formConfig.isView),configTrim:this.getPropValue(this._formConfig.trim),configDisableValidates:this.getPropValue(this._formConfig.disableValidates),configSelectEditMode:this.getPropValue(this._formConfig.selectEditMode),formData:this.formData,dontValidateRequired:this.dontValidateRequired,useSubmitValidate:this.useSubmitValidate,selectEditProps:this.selectEditProps}}},watch:{modelValue(t){for(const r of Object.values(this.formItemRefs))r.callOnChange(t[r.field.prop],!1)}},created(){this.$emit("created",this)},beforeUnmount(){this.$emit("beforeDestroy",this)},methods:{patchButtons(t){for(const r of t)r.loading=r.loading===void 0?!1:r.loading},getField(t){return this.fields.find(r=>r.prop===t)},getOptionValue(t,r){if(this.formItemRefs[t])return this.formItemRefs[t].getOptionValue(t,r)},setOptionLoading(t,r){r instanceof Promise&&(this.setItemControllerValue(t,"userOptionsLoading",!0),r.finally(()=>{this.setItemControllerValue(t,"userOptionsLoading",!1)}))},getPropValue(t,...r){return typeof t=="function"?t(this.componentScope,...r):t},registerFormItem(t,r){if(r.isEasyFormItem)this.formItemRefs[t]=r;else throw console.error(r),new Error("registerFormItem 方法注册的实例并非EasyFormItem实例")},unRegisterFormItem(t,r){this.formItemRefs[t]===r&&delete this.formItemRefs[t]},updateRules(t,r){this.formRules[t]=r},callButtonHandler(t){t.loading=!0;try{const r=t.handler(this.componentScope,t);r instanceof Promise?r.finally(()=>{t.loading=!1}):t.loading=!1}catch(r){console.error(r),t.loading=!1}},setItemControllerValue(t,r,l){this.itemController[t]||(this.itemController[t]={}),this.itemController[t][r]=l},setAllItemControllerValue(t,r){for(const l in this.itemController)this.setItemControllerValue(l,t,r)},getItemControllerValue(t,r){return this.itemController[t]||(this.itemController[t]={}),this.itemController[t][r]},callComponentOnChange(t,r,l,o){const i={scope:t,field:r,value:l,isFromUser:o};typeof this._formConfig.onChange=="function"&&this._formConfig.onChange(i),this.$emit("change",i)},submitForm(t={}){return new Promise((r,l)=>{const o=this.dontValidateRequired;this.dontValidateRequired=t.dontValidateRequired,this.useSubmitValidate=!0,this.$nextTick(()=>{this.$refs.form.validate((i,e)=>{if(i){const m=this.getParseFormData(t);this.$emit("submit",m),r(m)}else{if(this.$emit("valid",e),t.cleanDisabledOnValidError!==!1)for(const m in e)this.setItemControllerValue(m,"disabled",!1);ae(t.showValidMessage,this._formConfig.showValidMessage)!==!1&&this.$message({type:"warning",message:e[Object.keys(e)[0]][0].message,duration:5e3});try{this.formItemRefs[Object.keys(e)[0]].$el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}catch(m){console.error(m)}l(e)}this.dontValidateRequired=o,this.useSubmitValidate=!1})})})},getParseFormData(t={}){const r=this.getPropValue(this.formConfig.selectEditMode);t.fieldOnly=t.fieldOnly??r;const l=T(N(t.fieldOnly?{}:this.formData)),o=[];for(const i of this.fields)if(!(r&&!this.selectEditProps.includes(i.prop)))try{const e=this.getPropValue(i.formDataProp)||i.prop;if(this.getPropValue(i.showInForm)===!1&&!this.getPropValue(i.keepOnForm)&&!o.includes(i.prop))delete l[i.prop];else if(this.formItemRefs[i.prop]){o.push(i.prop);const{value:m,type:h}=this.formItemRefs[i.prop].parseData();h==="delete"?delete l[i.prop]:h==="value"&&(l[e]=m)}}catch(e){console.error(e)}return l},resetFormData(t={}){return this.updateValue(t).then(()=>{this.$nextTick(()=>{this.$refs.form&&this.$refs.form.clearValidate()})})},async setFieldValue(t={},r={}){r={setDisabled:!1,setDisabledForce:!1,dontUpdate:!1,...r},r={...r,disabledExclude:(Array.isArray(r.disabledExclude)?r.disabledExclude:[r.disabledExclude]).filter(e=>!!e),fieldExclude:(Array.isArray(r.fieldExclude)?r.fieldExclude:[r.fieldExclude]).filter(e=>!!e),restDisabledMap:r.restDisabledMap===void 0?r.setDisabled||r.setDisabledForce:r.restDisabledMap,copyAllData:typeof r.copyAllData=="boolean"?r.copyAllData:!1};const l=T(t),o=this.getParseFormData(),i=new Set;r.restDisabledMap&&this.setAllItemControllerValue("disabled",!1);for(const e of this.fields)e.prop&&i.add(e.prop),e.prop in l&&!r.fieldExclude.includes(e.prop)&&((r.setDisabledForce||r.setDisabled&&!["",void 0,null].includes(l[e.prop]))&&(r.disabledExclude.includes(e.prop)||(r.dontUpdate&&o[e.prop]!==l[e.prop]?this.setItemControllerValue(e.prop,"disabled",!1):this.setItemControllerValue(e.prop,"disabled",!0))),r.dontUpdate?([null,void 0,""].includes(this.formData[e.prop])&&(this.formData[e.prop]=l[e.prop]),this.formItemRefs[e.prop]&&this.formItemRefs[e.prop].isMultipleValue&&this.formData[e.prop].length===0&&(this.formData[e.prop]=l[e.prop])):this.formData[e.prop]=l[e.prop]);if(r.copyAllData)for(const e of l._pathKeys)!i.has(e)&&!r.fieldExclude.includes(e)&&(this.formData[e]=l[e]);return this.updateValue(this.formData).then(()=>{this.$nextTick(()=>{this.$refs.form&&this.$refs.form.clearValidate()})})},clearValidate(t){this.$refs.form&&this.$refs.form.clearValidate(t)},validateField(t){this.$refs.form&&this.$refs.form.validateField(t)},updateValue(t){let r=this,l=this.$parent,o="modelValue";for(;l;){for(const e in l.$props)if(l.$props[e]===this.modelValue){r=l,o=e;break}l=l.$parent}const i=[`update:${o}`];Object.keys(r.$listeners||{}).some(e=>i.includes(e))||console.warn(`[EasyForm] 祖辈组件未声明[${o}]监听器，表单值可能更新失效`);for(const e of i)r.$emit(e,t);return new Promise(e=>{this.$nextTick(()=>{e()})})}}},Ee={class:"easy-form"};function Le(t,r,l,o,i,e){const m=_("DefaultLayout"),h=_("el-form"),F=_("el-button"),C=_("EasyFormItem");return s(),V("div",Ee,[I(h,{ref:"form",model:e.formData,"label-position":e._formConfig.labelPosition,"label-width":e._formConfig.labelWidth||(["left","right"].includes(e._formConfig.labelPosition)?"100px":void 0),disabled:e.getPropValue(e._formConfig.readOnly),"validate-on-rule-change":!1,rules:i.formRules,class:L({"read-only":e.getPropValue(e._formConfig.readOnly),"is-view":e.getPropValue(e._formConfig.isView)})},{default:c(()=>[l.customMode?k(t.$slots,"default",y({key:0,easyFormItemBindData:e.easyFormItemBindData},e.componentScope),void 0,!0):(s(),g(m,{key:1,ref:"DefaultLayout",selectEditProps:i.selectEditProps,"onUpdate:selectEditProps":r[0]||(r[0]=p=>i.selectEditProps=p),fields:l.fields,"component-scope":e.componentScope,"form-config":e._formConfig,"item-controller":i.itemController,"easy-form-item-bind-data":e.easyFormItemBindData,"form-data":e.formData},E({_:2},[b(e.allSlotName,p=>({name:p,fn:c(d=>[k(t.$slots,p,Y(q(d)),void 0,!0)])}))]),1032,["selectEditProps","fields","component-scope","form-config","item-controller","easy-form-item-bind-data","form-data"]))]),_:3},8,["model","label-position","label-width","disabled","rules","class"]),!l.customMode&&(e._formConfig.showSubmit||e._formConfig.showCancel||e._buttons.filter(p=>e.getPropValue(p.show)!==!1).length>0)?(s(),V("div",{key:0,class:L(["btns",{"btn-position-center":e._formConfig.buttonPosition==="center","btn-position-left":e._formConfig.buttonPosition==="left","btn-position-right":e._formConfig.buttonPosition==="right"}])},[e._formConfig.showSubmit?(s(),g(F,{key:0,type:"primary",onClick:e.submitForm},{default:c(()=>r[2]||(r[2]=[A(" 提交 ")])),_:1},8,["onClick"])):w("",!0),e._formConfig.showCancel?(s(),g(F,{key:1,onClick:r[1]||(r[1]=p=>t.$emit("cancel"))},{default:c(()=>r[3]||(r[3]=[A(" 取消 ")])),_:1})):w("",!0),(s(!0),V(v,null,b(e._buttons.filter(p=>e.getPropValue(p.show)!==!1),p=>(s(),g(F,y({key:e.getPropValue(p.label),loading:e.getPropValue(p.loading),type:e.getPropValue(p.type),size:e.getPropValue(p.size),disabled:e.getPropValue(p.disabled),icon:e.getPropValue(p.leftIcon)||e.getPropValue(p.icon),ref_for:!0},e.getPropValue(p.buttonProps),{onClick:d=>e.callButtonHandler(p)}),{default:c(()=>[A(D(e.getPropValue(p.label))+" ",1),e.getPropValue(p.rightIcon)?(s(),V("i",{key:0,class:L(["el-icon--right",e.getPropValue(p.rightIcon)])},null,2)):w("",!0)]),_:2},1040,["loading","type","size","disabled","icon","onClick"]))),128))],2)):w("",!0),(s(!0),V(v,null,b(e.hiddenFields,p=>x((s(),g(C,y({key:p.prop,field:p,ref_for:!0},e.easyFormItemBindData,{"onUpdate:rules":d=>{e.updateRules(p.prop,d)},onCreated:d=>{e.registerFormItem(p.prop,d)},onBeforeDestroy:d=>{e.unRegisterFormItem(p.prop,d)},onChange:(d,u,n)=>{e.clearValidate(p.prop),e.callComponentOnChange(d,p,u,n)}}),{[e.getPropValue(p.slotName)]:c(d=>[k(t.$slots,e.getPropValue(p.slotName),y({getField:e.getField,formConfig:l.formConfig,easyFormItemBindData:e.easyFormItemBindData,ref_for:!0},d),void 0,!0)]),_:2},1040,["field","onUpdate:rules","onCreated","onBeforeDestroy","onChange"])),[[ee,!1]])),128))])}const oe=U(Ie,[["render",Le],["__scopeId","data-v-b2ffe7e3"]]);const Te={name:"EasyTable",props:{fields:{type:Array,default:()=>[]},tableConfig:{type:Object,default:()=>({})},buttons:{type:Array,default:()=>[]},emitLoadOnCreate:{type:Boolean,default:()=>!1},onLoad:{type:Function,default(t,r){return{tableData:this.tableData,total:this.total}}},modelValue:{type:Array,default:()=>[]},selected:{type:Array,default:()=>[]},meta:{type:Object,default:()=>({})},slotMode:{type:Boolean,default:()=>!1}},emits:["update:selected","update:modelValue"],data(){return{pageParam:{current:1,size:10},total:0,loading:!1,onPaginationChangeId:null,OptionsMap:R}},computed:{tableData:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},componentScope(){return{tableData:this.tableData,tableConfig:this._tableConfig,pageParam:this.pageParam,total:this.total,tableInstance:this,meta:this.meta}},_fields(){return this.fields.filter(t=>this.getPropValue(t.showInTable)!==!1).sort((t,r)=>t.tableSort-r.tableSort)},autoColWidthTotal(){let t=0;if(this.getPropValue(this._tableConfig.showIndex)){const r=this.getPropValue(this._tableConfig.indexAutoColWidth,[],0);t+=r}if(this.getPropValue(this._tableConfig.selection)){const r=this.getPropValue(this._tableConfig.selectionAutoColWidth,[],0);t+=r}if(this.buttons.length>0&&this.getPropValue(this._tableConfig.showHandler)!==!1){const r=this.getPropValue(this._tableConfig.handlerAutoColWidth,[],0);t+=r}return this._fields.map(r=>this.getPropValue(r.autoColWidth,[],0)).reduce((r,l)=>r+l,t)},_tableConfig(){return{...ce,...this.tableConfig}},_buttons(){return this.patchButtons(this.buttons),this.buttons}},watch:{selected:{handler(t){this.setSelected(t,!0)}}},created(){if(this.emitLoadOnCreate&&this.onPaginationChange(),this.tableData.length===0&&this._tableConfig.createRandomData){const t=typeof this._tableConfig.createRandomData=="number"?this._tableConfig.createRandomData:5;for(let r=0;r<t;r++){const l={};for(const o of this._fields)o.type==="date-picker"?l[o.prop]="2233-12-13":l[o.prop]=`${this.getPropValue(o.label)}-${r}`;this.tableData.push(l)}}},mounted(){this.setSelected(this.selected)},methods:{getDefaultFieldStyle(t,r){var l,o;return this.getPropValue((o=(l=this.fields.find(i=>i.prop===r.column.property))==null?void 0:l.styles)==null?void 0:o[t],[r])},patchButtons(t){for(const r of t)r.loading=r.loading===void 0?!1:r.loading},getPropValue(t,r=[],l){const o=typeof t=="function"?t(this.componentScope,...r):t;return o!==void 0?o:l},getAutoColWidth(t){if(t)return t/this.autoColWidthTotal*100},getFormProps(t,r){return(this.getPropValue(t.formProps)||{})[r]},createFormatter(t,r,l){const o=i=>{var C,p;if((C=t.tableProps)!=null&&C.formatter)return(p=t.tableProps)==null?void 0:p.formatter(l.row,l.column,i,l.$index);const e=t.optionsBaseCode?ie(this.getPropValue(t.optionsBaseCode)):[],m=t.options?this.getPropValue(t.options,[l,e])||[]:e,h=m.find(d=>d.value===i);if(h)return h.label;if(i&&this.getPropValue(t.type,[l])==="date-picker"){const d=K(i);return d.isValid()?d.format(this.getFormProps(t,"format")||"YYYY-MM-DD"):i}const F=this.getPropValue(t.valueSplitChar);return Array.isArray(i)||F&&typeof i=="string"?(Array.isArray(i)?i:i.split(F)).map(u=>(m.find(n=>n.value===u)||{}).label||u).join("、"):i};return r==="el-table"?(i,e,m,h)=>o(m):o},defaultIndexMethod(t){return(this.pageParam.current-1)*this.pageParam.size+t+1},onPaginationChange(){const t=new Date().valueOf();return this.onPaginationChangeId=t,this.loading=!0,Promise.resolve(this.onLoad(this.pageParam,this)).then(r=>r&&Array.isArray(r.tableData)||Array.isArray(r)?r:(console.warn("[EasyTable] onLoad参数指定的方法未返回有效数据: { tableData: Array, total?: number } | Array",r),{tableData:[],total:0})).then(r=>{if(t===this.onPaginationChangeId)if(this.tableData.splice(0,this.tableData.length),Array.isArray(r))this.tableData.push(...r),this.total=r.length;else{const{tableData:l=[],total:o}=r;this.tableData.push(...l),this.total=typeof o=="number"?o:l.length}}).catch(r=>{this.tableData.splice(0,this.tableData.length),this.total=0,console.error(r)}).finally(()=>{t===this.onPaginationChangeId&&(this.loading=!1)})},callButtonHandler(t,r){r.row&&(r.row._easytableLoading=!0),t.loading=!0;try{const l=t.handler(this.componentScope,r,t);l instanceof Promise?l.finally(()=>{r.row&&(r.row._easytableLoading=!1),t.loading=!1}):(r.row&&(r.row._easytableLoading=!1),t.loading=!1)}catch(l){console.error(l),r.row&&(r.row._easytableLoading=!1),t.loading=!1}},callFieldListeners(t,r,l,o,i){var e,m;for(const h of this.fields)h.prop===l.rawColumnKey&&((m=(e=h.tableListeners)==null?void 0:e[t])==null||m.call(e,r,l,o,i))},reset(){return this.pageParam={current:1,size:10},this.onPaginationChange()},setSelected(t,r=!1){var l,o;(l=this.$refs)==null||l.table.clearSelection(),r||this.$emit("update:selected",t);for(const i of this.modelValue)(o=this.$refs)==null||o.table.toggleRowSelection(i,t.includes(i))},getSelected(){return N(this.selected)}}},Be={class:"easy-table"},xe={key:0},Ne={class:"page-info"};function Ue(t,r,l,o,i,e){const m=_("el-table-column"),h=_("el-button"),F=_("el-table"),C=_("el-pagination"),p=_("el-col"),d=_("el-row"),u=G("loading");return s(),V("div",Be,[x((s(),g(F,y({ref:"table",data:e.tableData,"row-key":e._tableConfig.rowKey},{cellStyle:n=>e.getDefaultFieldStyle("cell",n),headerCellStyle:n=>e.getDefaultFieldStyle("headerCell",n),...e.getPropValue(e._tableConfig.tableProps)||{},class:{...(e.getPropValue(e._tableConfig.tableProps)||{}).class||{},"disable-select-all":e.getPropValue(e._tableConfig.disableSelectAll)}},{onSelect:r[0]||(r[0]=n=>{t.$emit("update:selected",n)}),onSelectAll:r[1]||(r[1]=n=>{t.$emit("update:selected",n)}),onCellClick:r[2]||(r[2]=(n,a,P,f)=>{e.callFieldListeners("click",n,a,P,f)}),onCellDblclick:r[3]||(r[3]=(n,a,P,f)=>{e.callFieldListeners("dblclick",n,a,P,f)}),onCellContextmenu:r[4]||(r[4]=(n,a,P,f)=>{e.callFieldListeners("contextmenu",n,a,P,f)})},M(e.getPropValue(e._tableConfig.tableListeners)||{})),E({default:c(()=>[(s(!0),V(v,null,b(e._tableConfig.sortCol||["selection","index"],n=>(s(),V(v,null,[n==="selection"&&e.getPropValue(e._tableConfig.selection)?(s(),g(m,y({key:n,type:"selection","min-width":e.getPropValue(e._tableConfig.tableSelectionProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.selectionAutoColWidth,[],0)),ref_for:!0},{width:e._tableConfig.selectionWidth,align:"center",headerAlign:"center",...e._tableConfig.publicTableProps,...e._tableConfig.tableSelectionProps}),null,16,["min-width"])):w("",!0),n==="index"&&e.getPropValue(e._tableConfig.showIndex)?(s(),g(m,y({key:n,index:a=>{const P=e.defaultIndexMethod(a);return typeof e._tableConfig.indexMethod=="function"?e._tableConfig.indexMethod(a,e.componentScope,P):P},type:"index","min-width":e.getPropValue(e._tableConfig.tableIndexProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.indexAutoColWidth,[],0)),ref_for:!0},{width:e._tableConfig.indexWidth,align:"center",headerAlign:"center",label:"序号",...e._tableConfig.publicTableProps,...e._tableConfig.tableIndexProps}),null,16,["index","min-width"])):w("",!0)],64))),256)),t.$slots["el-expand"]||t.$slots["el-expand"]?(s(),g(m,{key:0,type:"expand"},{default:c(n=>[k(t.$slots,"el-expand",y({...e.componentScope,...n},{isSelected:l.selected.includes(n.row)}),void 0,!0)]),_:3})):w("",!0),(s(!0),V(v,null,b(e._fields,n=>(s(),g(m,y({key:n.prop,prop:n.prop,label:e.getPropValue(n.label),"min-width":e.getPropValue(n.tableProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(n.autoColWidth,[],0))||e.getPropValue(e._tableConfig.publicTableProps,[],{}).minWidth,ref_for:!0},{showOverflowTooltip:e.getPropValue(n.type)==="textarea",...e._tableConfig.publicTableProps,...e.getPropValue(n.tableProps,[],{})}),{header:c(a=>[e.getPropValue(n.headerSlotName)?k(t.$slots,e.getPropValue(n.headerSlotName),y({key:0,field:n,componentScope:e.componentScope,formatter:e.createFormatter(n,"",a),ref_for:!0},a),void 0,!0):(s(),V("span",{key:1,class:L(`easy-table-header-cell-${n.prop}`)},D(e.getPropValue(n.label)),3))]),default:c(a=>[e.getPropValue(n.type)==="slot"||l.slotMode?k(t.$slots,l.slotMode?n.prop:e.getPropValue(n.slotName)||n.prop,y({key:0,ref_for:!0},a,{field:n,componentScope:e.componentScope,isSelected:l.selected.includes(a.row),formatter:e.createFormatter(n,"",a)}),void 0,!0):e.getPropValue(n.type)==="component"?(s(),g(S(e.getPropValue(n.is)),y({key:1,value:e.createFormatter(n,"el-table",a)(a.row,a.column,a.row[n.prop],a.$index),ref_for:!0},e.getPropValue(n.formProps),M(e.getPropValue(n.formListeners)||{})),null,16,["value"])):(s(),V("span",{key:2,class:L(`easy-table-cell-${n.prop}`)},D(e.createFormatter(n,"el-table",a)(a.row,a.column,a.row[n.prop],a.$index)),3))]),_:2},1040,["prop","label","min-width"]))),128)),l.buttons.length>0&&e.getPropValue(e._tableConfig.showHandler)!==!1?(s(),g(m,y({key:1,"min-width":e.getPropValue(e._tableConfig.tableHandlerProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.handlerAutoColWidth,[],0))},{className:"table-handler",fixed:"right",width:e.getPropValue(e._tableConfig.handlerWidth),...e.getPropValue(e._tableConfig.tableHandlerProps)||{}}),{header:c(n=>[(s(!0),V(v,null,b(e._buttons.filter(a=>a.position==="header"),a=>(s(),V(v,null,[e.getPropValue(a.show,[n])!==!1?(s(),g(h,y({key:e.getPropValue(a.label,[n]),loading:e.getPropValue(a.loading,[n]),type:e.getPropValue(a.type,[n]),size:e.getPropValue(a.size,[n]),disabled:e.getPropValue(a.disabled,[n]),ref_for:!0},e.getPropValue(a.buttonProps),{onClick:P=>e.callButtonHandler(a,n)}),{default:c(()=>[A(D(e.getPropValue(a.label,[n])),1)]),_:2},1040,["loading","type","size","disabled","onClick"])):w("",!0)],64))),256)),l.buttons.filter(a=>a.position==="header").length===0?(s(),V("span",xe,D(e.getPropValue(e._tableConfig.tableHandlerProps,[],{}).label||"操作"),1)):w("",!0)]),default:c(n=>[(s(!0),V(v,null,b(e._buttons.filter(a=>a.position!=="header"),a=>(s(),V(v,null,[e.getPropValue(a.show,[n])!==!1?(s(),g(h,y({key:e.getPropValue(a.label,[n]),loading:a.loading&&n.row._easytableLoading,type:e.getPropValue(a.type,[n]),size:e.getPropValue(a.size,[n]),disabled:e.getPropValue(a.disabled,[n]),ref_for:!0},e.getPropValue(a.buttonProps),{onClick:P=>e.callButtonHandler(a,n)}),{default:c(()=>[A(D(e.getPropValue(a.label,[n])),1)]),_:2},1040,["loading","type","size","disabled","onClick"])):w("",!0)],64))),256))]),_:1},16,["min-width"])):w("",!0)]),_:2},[t.$slots["el-empty"]||t.$slots["el-empty"]?{name:"empty",fn:c(()=>[k(t.$slots,"el-empty",Y(q(e.componentScope)),void 0,!0)]),key:"0"}:void 0]),1040,["data","row-key"])),[[u,i.loading]]),e._tableConfig.showPagination?(s(),g(d,{key:0,class:"pagination-con"},{default:c(()=>[I(p,{span:24,class:"pagination-con-col"},{default:c(()=>[k(t.$slots,e._tableConfig.paginationSlotName||"pagination",y({pageParam:i.pageParam,total:i.total,onPaginationChange:e.onPaginationChange},e.componentScope),()=>[I(C,{"page-size":i.pageParam.size,"current-page":i.pageParam.current,total:i.total,"page-sizes":[10,20,30,40,50,100,200],"pager-count":5,layout:`slot, total, sizes, prev, pager, next ${i.total/i.pageParam.size>10?", jumper":""}`,onSizeChange:r[5]||(r[5]=n=>{i.pageParam.size=n,e.onPaginationChange()}),onCurrentChange:r[6]||(r[6]=n=>{i.pageParam.current=n,e.onPaginationChange()})},{default:c(()=>[z("span",Ne," 第 "+D(i.pageParam.current)+" 页 / 共 "+D(i.total!==0?parseInt((i.total+i.pageParam.size-1)/i.pageParam.size):1)+" 页 ",1)]),_:1},8,["page-size","current-page","total","layout"])],!0)]),_:3})]),_:3})):w("",!0)])}const ne=U(Te,[["render",Ue],["__scopeId","data-v-7a9fb060"]]);const Ke={name:"EditTable",version:"3",components:{EasyTable:ne,EasyForm:oe,EasyFormItem:Q},props:{fields:{type:Array,default:()=>[]},tableProp:{type:Object,default:()=>({})},formProp:{type:Object,default:()=>({})},searchFormProp:{type:Object,default:()=>({})},dialogProp:{type:Object,default:()=>({})},meta:{type:Object,default:()=>({})},modelValue:{type:Array,default:()=>[]},rowKey:{type:String,default:()=>"id"},inlineMode:{type:Boolean,default:()=>!1},showSearchForm:{type:Boolean,default:()=>!1},searchLoader:{type:Function,default:void 0},alwaysEdit:{type:Boolean,default:!1}},emits:["update:selected","update:modelValue"],data(){return{dialogFormData:{},dialogVisible:!1,parseSearchFormData:{},searchForm:{},selected:[],virtualFormMap:{}}},computed:{valueRef(){return this.modelValue},tableFields(){return[...this.fields,{type:"slot",slotName:"virtualForm",label:"virtualForm",prop:"virtualForm",tableProps:{width:"1px",minWidth:"1px"}}]},componentScope(){return{searchForm:this.searchForm,selected:this.selected}},_selected:{set(t){this.$emit("update:selected",t),this.selected=t},get(){return this.selected}},_meta(){return{_editTable:{submitForm:(t,r)=>{const l=this.findRow(t);if(l)return this.virtualFormMap[l.row[this.rowKey]||l.row._virtualForm].submitForm(r);throw new Error("无法找到对应的表单实例")},editTableInstance:this},...this.meta}},allSlotName(){return Object.keys({...this.$slots})},that(){return this}},mounted(){this.tableProp.emitLoadOnCreate&&this.search()},methods:{createPathObject(...t){return T(...t)},getPropValue(t,...r){return typeof t=="function"?t(this.componentScope,...r):t},onTableLoad(t,r){return this.searchLoader(t,this.parseSearchFormData,r)},editReady(t={}){!t[this.rowKey]&&!t._tsid&&(t._tsid=new Date().valueOf());const r=!this.valueRef.some(o=>t._tsid?t._tsid===o._tsid:t[this.rowKey]?t[this.rowKey]===o[this.rowKey]:t===o),l={};for(const o in t)["_isEditing","_editRowClone"].includes(o)||(l[o]=t[o]);try{t._editRowClone=T(N(l))}catch(o){console.warn("深拷贝对象失败，将使用浅拷贝",o),t._editRowClone=T({...l})}t._editRowClone._isAdd=r,t._isEditing=!0,this.inlineMode?r&&(t._isNoSave=!0,this.valueRef.push(t),this.$emit("update:modelValue",this.valueRef)):(this.dialogVisible=!0,this.dialogFormData=t._editRowClone),this.$nextTick(()=>{this.$refs.EasyForm&&this.$refs.EasyForm.clearValidate()})},editConfirm(t){!t[this.rowKey]&&!t._tsid&&(t._tsid=new Date().valueOf());const r=this.valueRef.findIndex(o=>t._tsid?t._tsid===o._tsid:t[this.rowKey]?t[this.rowKey]===o[this.rowKey]:t===o),l={...t};for(const o in this.valueRef[r])o.startsWith("_")&&(l[o]=this.valueRef[r][o]);delete l._editRowClone,delete l._isNoSave,delete l._isEditing,r>-1?this.valueRef.splice(r,1,l):this.inlineMode||this.valueRef.push(l),this.$emit("update:modelValue",this.valueRef),this.dialogVisible=!1},deleteRow(t){const{index:r}=this.findRow(t);this.valueRef.splice(r,1),this.$emit("update:modelValue",this.valueRef)},cancelEdit(t){this.dialogVisible=!1;const{row:r}=this.findRow(t);delete r._isEditing,delete r._editRowClone,r._isNoSave&&this.deleteRow(r),delete r._isNoSave},findRow(t){for(let r=0;r<this.valueRef.length;r++){const l=this.valueRef[r];if(t._tsid&&t._tsid===l._tsid)return{row:t,index:r};if(t[this.rowKey]&&t[this.rowKey]===l[this.rowKey])return{row:t,index:r};if(t===l)return{row:t,index:r}}},setSelected(t){this.$refs.EasyTable.setSelected(t)},search(t={reset:!1,resetData:{}}){return this.showSearchForm?(t.reset&&this.$refs.SearchEasyForm.resetFormData(t.resetData),this.$refs.SearchEasyForm.submitForm({showValidMessage:!1}).then(r=>(this.parseSearchFormData=r,this.$refs.EasyTable.reset()))):(this.parseSearchFormData={},this.$refs.EasyTable.reset())}}},We={class:"edit-table"};function je(t,r,l,o,i,e){const m=_("EasyForm"),h=_("el-form-item"),F=_("EasyFormItem"),C=_("EasyTable"),p=_("el-dialog");return s(),V("div",We,[l.showSearchForm?(s(),g(m,y({key:0,ref:"SearchEasyForm",modelValue:i.searchForm,"onUpdate:modelValue":r[0]||(r[0]=d=>i.searchForm=d),class:"edit-table-search",meta:{isSearchForm:!0,...e._meta},fields:l.fields},l.searchFormProp),E({_:2},[b(e.allSlotName,d=>({name:d,fn:c(u=>[k(t.$slots,d,Y(q(u)),void 0,!0)])}))]),1040,["modelValue","meta","fields"])):w("",!0),k(t.$slots,"table-top",{instance:e.that},void 0,!0),I(C,y({ref:"EasyTable",modelValue:e.valueRef,"slot-mode":l.inlineMode,"on-load":l.tableProp.onLoad||(l.searchLoader?e.onTableLoad:void 0)},{...l.tableProp,emitLoadOnCreate:!1},{meta:{isTable:!0,...e._meta},fields:e.tableFields,"onUpdate:selected":r[1]||(r[1]=d=>{e._selected=d}),"onUpdate:modelValue":r[2]||(r[2]=d=>{t.$emit("update:modelValue",d)})}),E({virtualForm:c(d=>[(s(),g(m,{key:d.row[l.rowKey],value:d.row._editRowClone||d.row,class:"virtual-form","custom-mode":!0,fields:l.fields,onCreated:u=>{if(!d.row._virtualForm||!i.virtualFormMap[d.row[l.rowKey]||d.row._virtualForm]){const n=d.row[l.rowKey]||Math.random().toString();d.row._virtualForm=n,i.virtualFormMap[n]=u}},onBeforeDestroy:u=>{delete i.virtualFormMap[d.row[l.rowKey]||d.row._virtualForm]}},{default:c(()=>[(s(!0),V(v,null,b(l.fields,u=>x((s(),g(h,{key:u.prop,"show-message":!1,prop:u.prop},null,8,["prop"])),[[ee,!1]])),128))]),_:2},1032,["value","fields","onCreated","onBeforeDestroy"]))]),_:2},[b(e.allSlotName,d=>({name:d,fn:c(u=>[k(t.$slots,d,y({isEdit:u.row._isEditing||l.alwaysEdit,editFormData:u.row._editRowClone||u.row},u),void 0,!0)])})),b(l.fields,d=>({name:d.prop,fn:c(u=>[i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm]?(s(),g(F,y({key:d.prop,field:u.field,"config-is-view":!(u.row._isEditing||l.alwaysEdit)},{...i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm].easyFormItemBindData,formData:u.row._editRowClone||u.row,componentScope:{...i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm].easyFormItemBindData.componentScope,...u.componentScope}},{"onUpdate:rules":n=>{i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm].updateRules(u.field.prop,n)},onCreated:n=>{i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm].registerFormItem(u.field.prop,n)},onBeforeDestroy:n=>{const a=i.virtualFormMap[u.row[l.rowKey]||u.row._virtualForm];a&&a.unRegisterFormItem(u.field.prop,n)}}),E({_:2},[b(e.allSlotName,n=>({name:n,fn:c(a=>[k(t.$slots,n,y({isEdit:u.row._isEditing||l.alwaysEdit,editFormData:u.row._editRowClone||u.row},{...a,...u}),void 0,!0)])}))]),1040,["field","config-is-view","onUpdate:rules","onCreated","onBeforeDestroy"])):w("",!0)])}))]),1040,["modelValue","slot-mode","on-load","meta","fields"]),I(p,y({modelValue:i.dialogVisible,"onUpdate:modelValue":r[4]||(r[4]=d=>i.dialogVisible=d)},{closeOnClickModal:!1,appendToBody:!0,...l.dialogProp,title:e.getPropValue(l.dialogProp.title,i.dialogFormData,l.formProp)}),{default:c(()=>[I(m,y({ref:"EasyForm",modelValue:i.dialogFormData,"onUpdate:modelValue":r[3]||(r[3]=d=>i.dialogFormData=d)},l.formProp,{meta:{isForm:!0,...e._meta},fields:l.fields}),E({_:2},[b(e.allSlotName,d=>({name:d,fn:c(u=>[k(t.$slots,d,y({editFormData:i.dialogFormData,isEdit:!0},u),void 0,!0)])}))]),1040,["modelValue","meta","fields"])]),_:3},16,["modelValue"])])}const ze=U(Ke,[["render",je],["__scopeId","data-v-4547f7c1"]]),He={props:{options:{type:Object,default:()=>({})}},data(){return{visible:!0,lockClose:!1}},computed:{lockBind(){return this.lockClose?{closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1}:{}}}};function Ye(t,r,l,o,i,e){var h;const m=_("el-dialog");return s(),g(m,y({modelValue:i.visible,"onUpdate:modelValue":r[0]||(r[0]=F=>i.visible=F)},{closeOnClickModal:!1,closeOnPressEscape:!1,appendToBody:!0,destroyOnClose:!0,width:"50vw",...l.options.dialog,class:"easy-dialog "+((h=l.options.dialog)==null?void 0:h.customClass),...e.lockBind}),{default:c(()=>{var F;return[(s(),g(S((F=l.options.component)==null?void 0:F.is),Y(q(l.options.component)),null,16))]}),_:1},16,["modelValue"])}const qe=U(He,[["render",Ye]]),Qe=(t={},r)=>{const l=I(qe,{options:t});return l.appContext=r,me(l,document.createElement("div")),l.component.proxy},Je={install(t,r={}){t.config.globalProperties.$EasyDialog=(l,o)=>Qe(l,o||t._context)}},$e={install(t,r={}){t.component("EasyForm",oe),t.component("EasyFormItem",Q),t.component("EasyTable",ne),t.component("EditTable",ze),t.use(Je);const l=r.config||{};for(const o in l)H[o]=l[o]}};export{$e as default};
