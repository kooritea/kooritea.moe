import{_ as k,A as P,u as L,p as B,aU as c,aV as h,aI as g,k as n,b as i,z as m,f as o,w as f,l as v,F as S,B as V,d as C,t as _,n as w,j as d}from"./assets/index-Ba7ZBZX4.js";/* empty css         *//* empty css         */import{a as x,E as U}from"./xDZ9bOQHy.js";const A={components:{AsyncButtom:P,ElTimePicker:x,ElInputNumber:U},props:{modelValue:{type:String,default:()=>"00:00:00.0"},sourcePath:{type:String,default:()=>""},sourceKeyname:{type:String,default:()=>""}},emits:["update:modelValue"],setup(){const{onlineApiBaseURL:a}=L(),{accessKey:t}=B();return{accessKey:t,onlineApiBaseURL:a}},data(){return{images:[],timeControllers:[{label:"-1m",value:-60},{label:"-10s",value:-10},{label:"-1s",value:-1},{label:"+1s",value:1},{label:"+10s",value:10},{label:"+1m",value:60}]}},methods:{updateTimestring(a){this.$emit("update:modelValue",`${c(h(this.modelValue.split(".")[0])+a)}.${this.modelValue.split(".")[1]}`)},async refreshScreenshots(a){if(!this.sourcePath&&!this.sourceKeyname){this.$msgBox.warning("请先选择视频源");return}for(const l of this.images)l.originSrc&&URL.revokeObjectURL(l.originSrc),URL.revokeObjectURL(l.src);this.images=[{ts:this.modelValue,src:this.getScreenshots(this.modelValue,a)}];const t=h(this.modelValue),e=c(g.subtract(t,.1),!0);this.images.unshift({ts:e,src:this.getScreenshots(e,a)});for(const l in new Array(3).fill(null)){const r=c(g.add(t,(Number(l)+1)*.1),!0);this.images.push({ts:r,src:this.getScreenshots(r,a)})}},getScreenshots(a,t){const e=new URL(`${this.onlineApiBaseURL}/video/source/screenshots`);return e.searchParams.append("mass-controler-fingerprint",this.accessKey),e.searchParams.append("sourcePath",this.sourcePath),e.searchParams.append("sourceKeyname",this.sourceKeyname),e.searchParams.append("timestamps",a),e.searchParams.append("format",t),e.toString()}}},N={class:"preview-screenshots"},R={class:"screenshots-box"},T={class:"btn-box"},I={class:"image-box"},K={class:"ts"},j=["src","onClick"];function z(a,t,e,l,r,u){const b=d("el-time-picker"),y=d("el-input-number"),p=d("AsyncButtom");return n(),i("div",N,[m(b,{"model-value":e.modelValue.split(".")[0],"value-format":"HH:mm:ss",format:"HH:mm:ss",style:{width:"120px"},"onUpdate:modelValue":t[0]||(t[0]=s=>{a.$emit("update:modelValue",`${s||"00:00:00"}.${e.modelValue.split(".")[1]}`)})},null,8,["model-value"]),t[3]||(t[3]=o("span",null,".",-1)),m(y,{"model-value":+("0."+(e.modelValue.split(".")[1]||"0")),min:0,max:1,precision:3,step:.1,style:{width:"120px"},"onUpdate:modelValue":t[1]||(t[1]=s=>{a.$emit("update:modelValue",`${e.modelValue.split(".")[0]}.${String(s).split(".")[1]||0}`)})},null,8,["model-value"]),m(p,{type:"primary",size:"mini",onLoadingClick:()=>u.refreshScreenshots("jpg")},{default:f(()=>t[2]||(t[2]=[v(" 获取截图 ")])),_:1},8,["onLoadingClick"]),o("div",R,[o("div",T,[(n(!0),i(S,null,V(r.timeControllers,s=>(n(),C(p,{key:s.label,size:"mini",onLoadingClick:()=>{u.updateTimestring(s.value)}},{default:f(()=>[v(_(s.label),1)]),_:2},1032,["onLoadingClick"]))),128))]),o("div",I,[(n(!0),i(S,null,V(r.images,s=>(n(),i("div",{key:s.src,class:w(["item-box",{active:s.ts===e.modelValue}])},[o("div",K,_(s.ts),1),o("img",{class:"image",src:s.src,onClick:()=>{s.ts===e.modelValue?a.$imagePreview(()=>(s.originSrc||(s.originSrc=u.getScreenshots(s.ts,"png")),s.originSrc),{fileName:e.sourcePath.slice(e.sourcePath.lastIndexOf("/")+1).split(".")[0]}):a.$emit("update:modelValue",s.ts)}},null,8,j)],2))),128))])])])}const F=k(A,[["render",z],["__scopeId","data-v-12348109"]]);export{F as P};
