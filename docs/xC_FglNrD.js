import{P as E}from"./xzA4eLLiI.js";import{_ as O,K as S,A as $,M as N,N as P,u as U,r as w,O as x,P as j,Q as K,k as i,b as l,R as z,f as u,z as A,t as m,d as k,e as _,w as b,l as v,j as h,T as G,a as V,c as M,F as B,B as f,U as W,V as C,n as D}from"./assets/index-B1eEDWgP.js";import{I as F}from"./xD3RGWLI2.js";const H={components:{ImageCon:F,AsyncSwitch:S,AsyncButtom:$},directives:{mask:N},props:{bangumi:{type:Object,required:!0}},setup(c,{emit:o}){const{computedBangumi:d}=P(c,o),{mobileMode:e,isGreatOldOne:y}=U(),p=w(!1);return{cancel:()=>{e.value&&!p.value&&(d.value=null)},computedBangumi:d,isGreatOldOne:y,globalLoading:p}},methods:{onSwitchBangumiState(c,o){return x(c.id,{state:o})},onUpdateBangumiInfo(c){return j(c.subject).then(o=>{const d={...c,...o};return delete d.deletedAt,delete d.id,x(c.id,d).then(e=>{Object.assign(c,e)})})},deleteBangumi(c){return K(c.id).then(()=>{Object.assign(c,{isDel:!0})})}}},R={class:"bangumi-viewer-container"},T={class:"preview"},q={class:"name"},Q={class:"nname"},Y={class:"switch-time-episode"},J={class:"time-episode"},X={key:0};function Z(c,o,d,e,y,p){const g=h("ImageCon"),a=h("AsyncSwitch"),t=h("AsyncButtom"),s=G("mask");return i(),l("div",{class:"bangumi-viewer",onClick:o[2]||(o[2]=(...n)=>e.cancel&&e.cancel(...n))},[z((i(),l("div",R,[u("div",T,[A(g,{src:`https://lain.bgm.tv/pic/cover/l${e.computedBangumi.img}`},null,8,["src"])]),u("div",q,m(e.computedBangumi.name),1),u("div",Q,m(e.computedBangumi.nname),1),u("div",Y,[e.isGreatOldOne?(i(),k(a,{key:0,modelValue:e.computedBangumi.state,"onUpdate:modelValue":o[0]||(o[0]=n=>e.computedBangumi.state=n),loading:e.globalLoading,"onUpdate:loading":o[1]||(o[1]=n=>e.globalLoading=n),onLoadingClick:n=>p.onSwitchBangumiState(e.computedBangumi,n)},null,8,["modelValue","loading","onLoadingClick"])):_("",!0),e.isGreatOldOne?(i(),k(t,{key:1,type:"primary",size:"mini",onLoadingClick:()=>p.onUpdateBangumiInfo(e.computedBangumi)},{default:b(()=>o[3]||(o[3]=[v(" 更新信息 ")])),_:1},8,["onLoadingClick"])):_("",!0),e.isGreatOldOne&&!d.bangumi.isDel?(i(),k(t,{key:2,type:"danger",size:"mini",confirm:{message:`确认删除${d.bangumi.name||d.bangumi.nname}`},onLoadingClick:()=>p.deleteBangumi(e.computedBangumi)},{default:b(()=>o[4]||(o[4]=[v(" 删除 ")])),_:1},8,["confirm","onLoadingClick"])):_("",!0),u("span",J,[e.computedBangumi.episode?(i(),l("span",X," ("+m(e.computedBangumi.episode)+"话) ",1)):_("",!0),v(" "+m(e.computedBangumi.time),1)])])])),[[s,!0]])])}const I=O(H,[["render",Z],["__scopeId","data-v-9551b5b8"]]),ee={components:{PageHeader:E,BangumiViewer:I},setup(){const c=w(""),o=V([]),d=w(null),e=V({notExistDate:[],year:[]});e.notExistDate.open=!1;const y=()=>{o.splice(0,o.length),d.value=null,e.notExistDate=[],e.year=[],W().then(g=>{const a={};for(const t of g)if(!t.time)e.notExistDate.push(t);else{const s=new Date(t.time),n=s.getFullYear(),r=s.getMonth()+1;a[n]||(a[n]=[],a[n].year=n,a[n].open=!1,a[n].total=0,a[n].complete=0,e.year.push(a[n])),a[`${n}-${r}`]||(a[`${n}-${r}`]=[],a[`${n}-${r}`].month=`${n}-${r}`,a[`${n}-${r}`].monthNum=r,a[`${n}-${r}`].open=!1,a[`${n}-${r}`].total=0,a[`${n}-${r}`].complete=0,a[n].push(a[`${n}-${r}`])),a[n].total++,a[`${n}-${r}`].total++,t.state&&(a[n].complete++,a[`${n}-${r}`].complete++),a[`${n}-${r}`].push(t)}e.year=e.year.sort((t,s)=>s.year-t.year);for(const t in e.year){e.year[t]=e.year[t].sort((s,n)=>s.monthNum-n.monthNum);for(const s in e.year[t])Array.isArray(e.year[t][s])&&(e.year[t][s]=e.year[t][s].sort((n,r)=>new Date(n.time)-new Date(r.time)))}o.push(...g)})};y();const p=M(()=>c.value?o.filter(g=>{var a,t,s,n,r,L;return((s=(a=g.name)==null?void 0:a.toLowerCase())==null?void 0:s.includes((t=c.value)==null?void 0:t.toLowerCase()))||((L=(n=g.nname)==null?void 0:n.toLowerCase())==null?void 0:L.includes((r=c.value)==null?void 0:r.toLowerCase()))}):[]);return{selectedBangumi:d,bangumiDateList:e,bangumiSearchList:p,searchKeyWord:c,refreshList:y}},methods:{}},te={class:"page"},ne={class:"container"},oe={key:0,class:"list"},ae=["onClick"],se={class:"item-info"},ie={key:0},le=["onClick"],re={class:"item-info"},ce={key:0},de=["title","onClick"],me={key:0},ue=["title","onClick"],ge={key:1,class:"list search-list"},pe=["title","onClick"];function _e(c,o,d,e,y,p){const g=h("PageHeader"),a=h("BangumiViewer");return i(),l("div",te,[A(g,{modelValue:e.searchKeyWord,"onUpdate:modelValue":o[0]||(o[0]=t=>e.searchKeyWord=t),"show-search-input":!0},null,8,["modelValue"]),u("div",ne,[e.searchKeyWord?(i(),l("div",ge,[u("ul",null,[(i(!0),l(B,null,f(e.bangumiSearchList,t=>(i(),l("li",{key:t.id,class:D(["bangumi-item",{complete:t.state}]),title:t.nname,onClick:s=>e.selectedBangumi=t},m(t.name||t.nname),11,pe))),128))])])):(i(),l("div",oe,[u("ul",null,[(i(!0),l(B,null,f(e.bangumiDateList.year,t=>(i(),l("li",{key:t.year,class:"year-item",onClick:s=>t.open=!t.open},[u("div",se,[u("span",null,m(t.year),1),u("span",null,m(t.complete)+"/"+m(t.total),1)]),t.open?(i(),l("ul",ie,[(i(!0),l(B,null,f(t,s=>(i(),l("li",{key:s.month,class:"month-item",onClick:C(n=>s.open=!s.open,["stop"])},[u("div",re,[u("span",null,m(s.month),1),u("span",null,m(s.complete)+"/"+m(s.total),1)]),s.open?(i(),l("ul",ce,[(i(!0),l(B,null,f(s,n=>(i(),l("li",{key:n.id,class:D(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:C(r=>e.selectedBangumi=n,["stop"])},m(n.name||n.nname)+m(n.isDel?"[已删除]":""),11,de))),128))])):_("",!0)],8,le))),128))])):_("",!0)],8,ae))),128)),e.bangumiDateList.notExistDate.length>0?(i(),l("li",{key:0,class:"year-item",onClick:o[1]||(o[1]=t=>e.bangumiDateList.notExistDate.open=!e.bangumiDateList.notExistDate.open)},[o[3]||(o[3]=v(" 放送时间未确认 ")),e.bangumiDateList.notExistDate.open?(i(),l("ul",me,[(i(!0),l(B,null,f(e.bangumiDateList.notExistDate,t=>(i(),l("li",{key:t.id,class:D(["bangumi-item",{complete:t.state}]),title:t.nname,onClick:C(s=>e.selectedBangumi=t,["stop"])},m(t.name||t.nname),11,ue))),128))])):_("",!0)])):_("",!0)])])),e.selectedBangumi?(i(),k(a,{key:2,bangumi:e.selectedBangumi,"onUpdate:bangumi":o[2]||(o[2]=t=>e.selectedBangumi=t)},null,8,["bangumi"])):_("",!0)])])}const he=O(ee,[["render",_e],["__scopeId","data-v-1a984734"]]);export{he as default};
