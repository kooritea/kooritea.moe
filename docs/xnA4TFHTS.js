import{_ as P,a7 as j,I as K,g1 as F,g2 as O,j as g,k as u,d as S,w as B,b as y,e as E,f as d,l as N,p as _,S as L,q as W,a as C,r as k,F as I,E as A,t as M,n as R,g3 as q,g4 as z,a3 as T,g5 as G,Z as H,b1 as Z,u as J,K as Q,ai as X,aj as Y,aa as ee,c as te,g6 as oe,P as ae,co as se,T as le,aU as ne,$ as re,g7 as ie,g8 as ce,g9 as $,ga as de}from"./assets/index-Cidlq0aV.js";import{P as ue}from"./xSfWyVYh1.js";import{E as me}from"./xP3uMd1d2.js";import{M as pe}from"./xB98_U43i.js";import{I as fe}from"./xhnpPs0I2.js";/* empty css         *//* empty css         *//* empty css         */import{E as he}from"./xVhoNpuDM.js";import{E as ge}from"./xDlxOPoAU.js";const ve={components:{ElDialog:me,ButtonBox:j,AsyncSwitch:K,PreviewScreenshots:ue},data(){return{dialogVisible:!1,resolve:null,reject:null,file:null,sourceSrc:null,sourceKeyname:null,screenshots:"00:00:00.0",isLoop:!1,handlers:[{name:"返回",type:"default",handler:()=>{this.reject()}},{name:"确认",type:"primary",handler:async()=>{const o=await F(await this.$refs.PreviewScreenshots.getScreenshots(this.screenshots,"png"),"thumbnail.png");return this.resolve({thumbnail:o,file:this.file,isLoop:this.isLoop})}}]}},methods:{async open({callback:o,file:t}={}){return this.dialogVisible=!0,this.file=t,this.sourceSrc=URL.createObjectURL(t),this.sourceKeyname=await O(t),this.screenshots="00:00:00.0",this.isLoop=!1,new Promise((s,a)=>{this.resolve=e=>{if(this.reject=null,o){const c=o(e);return Promise.resolve(c).then(()=>{s(e)})}else s(e)},this.reject=e=>{a(e)}}).finally(()=>{this.dialogVisible=!1})}}},ye=["loop","src"],we={class:"cell"};function _e(o,t,s,a,e,c){const p=g("PreviewScreenshots"),f=g("AsyncSwitch"),n=g("ButtonBox"),w=g("el-dialog");return u(),S(w,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=l=>e.dialogVisible=l),top:"10px",class:"fv4w4f5616f5wefew",title:"视频上传","lock-scroll":!0,"close-on-click-modal":!1,"before-close":l=>{e.reject&&(l(),e.reject())}},{default:B(()=>[e.dialogVisible?(u(),y("video",{key:0,class:"video",controls:"",preload:"none",loop:e.isLoop,src:e.sourceSrc,onError:t[0]||(t[0]=l=>{o.$message({type:"error",message:"视频播放失败",duration:5e3})})},null,40,ye)):E("",!0),e.dialogVisible?(u(),S(p,{key:1,ref:"PreviewScreenshots",modelValue:e.screenshots,"onUpdate:modelValue":t[1]||(t[1]=l=>e.screenshots=l),sourceKeyname:e.sourceKeyname},null,8,["modelValue","sourceKeyname"])):E("",!0),d("div",we,[t[4]||(t[4]=N(" 循环播放： ")),_(f,{modelValue:e.isLoop,"onUpdate:modelValue":t[2]||(t[2]=l=>e.isLoop=l)},null,8,["modelValue"])]),_(n,{handlers:e.handlers},null,8,["handlers"])]),_:1},8,["modelValue","before-close"])}const Ve=P(ve,[["render",_e],["__scopeId","data-v-63f04aac"]]),Se={components:{SvgIcon:L,ImageCon:fe},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(o,{emit:t}){const{emoteHistory:s}=W(),a=C({name:"history",emote:s.value}),e=C([]),c=k("history"),p=l=>{if(c.value=l.name,l.emote.length===0)return q(l.name).then(v=>{c.value=l.name,l.emote=v.emote.map(r=>({...r,scope:l.name}))})},f=()=>{e.splice(0,e.length),e.push(a),z().then(l=>{e.push(...l.sort((v,r)=>{const x=s.value.findIndex(i=>i.scope===v.name),b=s.value.findIndex(i=>i.scope===r.name);return(x===-1?1/0:x)-(b===-1?1/0:b)})),e.push({name:"add",emote:[]})})};return f(),{onSelect:l=>{t("select",l),s.value=s.value.filter(v=>!(v.scope===l.scope&&v.name===l.name)),s.value=[l,...s.value].slice(0,30),a.emote=s.value},addEmotePackage:()=>{T({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:l=>G(l.inputValue).then(()=>{H.success("添加成功"),f()}),inputValidator:l=>/^\d+$/.test(l),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:c,emotePackages:e,selectScope:p}}},be={class:"emote-selector"},ke={class:"emotes"},Ee={class:"scopes"},Me=["onClick"];function Be(o,t,s,a,e,c){const p=g("ImageCon"),f=g("SvgIcon");return u(),y("div",be,[d("div",ke,[(u(!0),y(I,null,A((a.emotePackages.find(n=>n.name===a.currentScope)||{}).emote||[],n=>(u(),S(p,{key:n.name,class:"emote",alt:n.name,src:`/emoji/${n.scope}/${n.name}.png`,onClick:w=>a.onSelect(n)},{error:B(()=>[d("span",null,M(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),d("div",Ee,[(u(!0),y(I,null,A(a.emotePackages,n=>(u(),y("div",{key:n.name,class:R(["scope",{"selected-scope":a.currentScope===n.name}]),onClick:()=>{n.name==="add"?a.addEmotePackage():a.selectScope(n)}},[n.name==="history"?(u(),S(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(u(),S(f,{key:1,class:"emote history",name:"add"})):(u(),S(p,{key:2,class:"emote",src:`/emoji/${n.name}/${n.name}.png`},{error:B(()=>[d("span",null,M(n.name),1)]),_:2},1032,["src"]))],10,Me))),128))])])}const xe=P(Se,[["render",Be],["__scopeId","data-v-6872cbc5"]]);function He(o){const t=k(null),s=Z(he,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:t.value,"onUpdate:modelValue":a=>{var e;t.value=a,(e=s.component)!=null&&e.props&&(s.component.props.modelValue=a)}});T({title:"选择预约时间",message:s,confirmHandlerPromise:a=>o(t),inputValidator:a=>!!t.value,inputErrorMessage:"请选择预约时间"})}const D={},Ie={components:{SvgIcon:L,Markdown:pe,ButtonBox:j,EmoteSelector:xe,ElPopover:ge,VideoUploader:Ve},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(o,{emit:t}){const{darkMode:s}=J(),a=k(!0),{computedModelValue:e}=Q(o,t),c=k(!1),p=k(null);if(o.cache){const i=re();if(D[i.fullPath]&&o.cache===!0)H.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const m="MDEditorCache."+(o.cache===!0?i.fullPath:`${i.fullPath}.${o.cache}`);e.value=localStorage.getItem(m)||o.defaultValue,X(()=>{D[m]=!0}),Y(()=>{D[m]=!1});const h=de(()=>{c.value=!0,localStorage.setItem(m,e.value||"")},1e3);ee(e,()=>{c.value=!1,h()})}}const f=i=>{const m=p.value.selectionStart,h=e.value.slice(0,m),V=e.value.slice(m);e.value=`${h}${i}${V}`},n=k(e.value),w=({reservationDate:i}={})=>{const m=o.onSubmit(e.value,i==null?void 0:i.value);return m instanceof Promise?m.then(()=>{e.value=o.defaultValue||"",n.value=o.defaultValue||""}):(e.value=o.defaultValue||"",n.value=o.defaultValue||""),m},l=()=>{e.value=""},v=()=>{e.value=n.value},r=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("submit"):o.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{He(i=>{w({reservationDate:i})})},show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("reservation"):o.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:l,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("clean"):o.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:v,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("reset"):o.showDefaultHandlers)&&!!n.value,sort:30}],x=te(()=>[...r,...o.exHandlers]),b=i=>{const m=ie(URL.createObjectURL(i),{handlers:[{name:"上传",type:"primary",handler:()=>{const h=new Date().valueOf().toString();f(`![${h}](--------------------)`),ce(i,V=>{const U=Math.round(100*V.loaded/V.total)/10*2;e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),`![${h}](${"#".repeat(U)}${"-".repeat(20-U)})`)}).then(V=>{e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),`![${V.keyname}](${V.local})`)}).catch(()=>{e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),"")}),m.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{$(i,16,9).then(h=>{m.callClose(),b(h)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{$(i,160,67).then(h=>{m.callClose(),b(h)})}},{name:"取消",type:"default",handler:()=>{m.callClose()}}]})};return{darkMode:s,isEditMode:a,computedModelValue:e,resetCache:n,isSave:c,handlers:x,submitHandler:w,cleanHandler:l,resetHandler:v,previewImageBeforeUpload:b,textarea:p,insertText:f}},methods:{pasteHandler(o){if(!(o.clipboardData&&o.clipboardData.items))return;const t=Array.from(o.clipboardData.items).filter(s=>s.kind==="file");if(t.length===1){o.preventDefault();for(const s of t)if(s.type.startsWith("image/")){this.previewImageBeforeUpload(s.getAsFile());return}else if(s.type.startsWith("video/")){this.previewVideoBeforeUpload(s.getAsFile());return}else H.warning(`不支持的文件类型: ${s.type}`)}},dropHandler(o){for(const t of o.dataTransfer.files)if(o.preventDefault(),t.type.startsWith("image/")){this.previewImageBeforeUpload(t);return}else if(t.type.startsWith("video/")){this.previewVideoBeforeUpload(t.getAsFile());return}else H.warning(`不支持的文件类型: ${t.type}`)},previewVideoBeforeUpload(o){this.$refs.VideoUploader.open({file:o,callback:t=>{const s=new Date().valueOf().toString(),a=t.isLoop?"video-loop":"video";this.insertText(`[${a} ${s}](--------------------)`),oe(o,e=>{const p=Math.round(100*e.loaded/e.total)/10*2;this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${s}]\\((#*?)(-*?)\\)`),`[${a} ${s}](${"#".repeat(p)}${"-".repeat(20-p)})`)},t.thumbnail).then(e=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${s}]\\((#*?)(-*?)\\)`),`[${a} ${e.local}]`)}).catch(()=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${s}]\\((#*?)(-*?)\\)`),"")})}})}}},De={class:"fill"},Pe=["disabled"],Ue={key:1,class:"preview"},Ce={class:"bar"},Ae={class:"bar-left"},$e={class:"title"},je={class:"uploader"},Le={class:"uploader"},Re={class:"bar-right"},Te={key:0,class:"is-save info"};function Ke(o,t,s,a,e,c){const p=g("Markdown"),f=g("SvgIcon"),n=g("EmoteSelector"),w=g("el-popover"),l=g("ButtonBox"),v=g("VideoUploader");return u(),y(I,null,[d("div",ne({class:"md-editor"},o.$attrs),[a.isEditMode?(u(),y("div",{key:0,class:R(["textarea-box",{"auto-height":s.autoHeight}])},[d("pre",De,M(a.computedModelValue),1),ae(d("textarea",{ref:"textarea","onUpdate:modelValue":t[0]||(t[0]=r=>a.computedModelValue=r),class:"textarea",disabled:s.disabled,onPaste:t[1]||(t[1]=(...r)=>c.pasteHandler&&c.pasteHandler(...r)),onDragover:t[2]||(t[2]=le(()=>{},["prevent"])),onDrop:t[3]||(t[3]=(...r)=>c.dropHandler&&c.dropHandler(...r))},null,40,Pe),[[se,a.computedModelValue]])],2)):(u(),y("div",Ue,[_(p,{"model-value":a.computedModelValue},null,8,["model-value"])])),d("div",Ce,[d("div",Ae,[s.disabled?E("",!0):(u(),y(I,{key:0},[d("div",$e,M(s.title),1),d("label",je,[_(f,{class:"button",name:"14"}),d("input",{type:"file",accept:"image/*",onChange:t[4]||(t[4]=r=>{a.previewImageBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),d("label",Le,[_(f,{class:"button",name:"video"}),d("input",{type:"file",accept:"video/*",onChange:t[5]||(t[5]=r=>{c.previewVideoBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),_(w,{width:"auto",trigger:"click",effect:a.darkMode?"dark":"light"},{reference:B(()=>[_(f,{class:"button",name:"biaoqing"})]),default:B(()=>[_(n,{onSelect:t[6]||(t[6]=r=>{a.insertText(`[emoji ${r.scope}/${r.name}]`)})})]),_:1},8,["effect"])],64))]),d("div",Re,[a.isSave?(u(),y("span",Te,"已保存")):E("",!0),d("span",{class:"preview-switch button",onClick:t[7]||(t[7]=r=>a.isEditMode=!a.isEditMode)},M(a.isEditMode?"预览":"返回编辑"),1)])])],16),a.handlers.length>0?(u(),S(l,{key:0,handlers:a.handlers},null,8,["handlers"])):E("",!0),_(v,{ref:"VideoUploader"},null,512)],64)}const Fe=P(Ie,[["render",Ke],["__scopeId","data-v-24118e5a"]]),et=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Fe as M,et as a,He as u};
