import{_ as S,A as T,r as f,c as b,b as C,d as l,e as p,h as v,F as h,E as x,n as N,i as B,l as _,g as I,T as g,p as D,w as z,a as A,a2 as M,a3 as K,f as V,t as H}from"./assets/index-6204cb62.js";class k{constructor(e,t){this.x=e,this.y=t,this.key=String(Math.random())}}class w extends k{constructor(e,t){super(e,t),this.itemType="kabe"}}class y extends k{constructor(e,t){super(e,t),this.itemType="box"}}class L extends k{constructor(e,t){super(e,t),this.itemType="target"}}class E extends k{constructor(e,t){super(e,t),this.itemType="neko"}}class F{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let t=0;t<e.length;t++){const n=e[t],r=[];this.instance.push(r);for(let a=0;a<n.length;a++){const d=n[a];let c=null;for(const m of d.split(""))switch(m){case"k":{c=new w(a,t);break}case"x":{const s=new y(a,t);this.boxs.push(s),c=s;break}case"o":{this.targets.push(new L(a,t));break}case"s":{const s=new E(a,t);this.neko=s,c=s;break}}r.push(c)}}}getItem({x:e,y:t}){var n;return(n=this.instance[t])==null?void 0:n[e]}getDirectionCoordinate({x:e,y:t},n){switch(n){case"2":{t=t+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{t=t-1;break}}return{x:e,y:t}}getNextItem({x:e,y:t},n){const r=this.getItem(this.getDirectionCoordinate({x:e,y:t},n));return r===void 0||r instanceof w?!1:r}moveItem({x:e,y:t},n){const r=this.getItem({x:e,y:t}),a=this.getDirectionCoordinate({x:e,y:t},n);r.x=a.x,r.y=a.y,this.instance[t][e]=null,this.instance[a.y][a.x]=r}}let $=class{constructor(e){this.map=new F(e)}get neko(){return this.map.neko}operate(e){const t=this.map.getNextItem(this.neko,e);if(t===!1)return!1;if(t===null&&this.map.moveItem(this.neko,e),t instanceof y){if(this.map.getNextItem(t,e)!==null)return!1;this.map.moveItem(t,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof y))}};const j={components:{AsyncButtom:T},props:{map:{type:String,default:()=>""}},setup(i){const e=f(null),t=f(50),n=f(!1),r=function(){let s=[];const o=[];for(const u of i.map.split(","))u==="n"?(o.push(s),s=[]):s.push(u);e.value=A(new $(o)),n.value=!1};r();const a=function(s){s.preventDefault();const o={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(s.keyCode)];e.value.operate(o),n.value=e.value.check()},d=function(s,o){const u=e.value.neko;s-u.x===0&&o-u.y===1&&e.value.operate("2"),s-u.x===0&&o-u.y===-1&&e.value.operate("8"),s-u.x===1&&o-u.y===0&&e.value.operate("6"),s-u.x===-1&&o-u.y===0&&e.value.operate("4"),n.value=e.value.check()},c=b(()=>{var s,o;return((o=(s=e.value)==null?void 0:s.map)==null?void 0:o.targets)||[]}),m=function(s,o){return c.value.some(u=>u.x===s&&u.y===o)};return{mapInstance:b(()=>{var s,o;return((o=(s=e.value)==null?void 0:s.map)==null?void 0:o.instance)||[]}),isTarget:m,size:t,reset:r,congratulations:n,keyupHandler:a,touchMove:d}}},q=i=>(M("data-v-e740188f"),i=i(),K(),i),G={class:"sokoban-box"},J=["onClick"],O={key:0,class:"congratulations"},P=q(()=>v("div",{class:"mask"}," 点击开始 ",-1)),Q={class:"buttons"};function R(i,e,t,n,r,a){const d=C("AsyncButtom");return l(),p("div",G,[v("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=g(c=>{c.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=g(c=>{c.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=g((...c)=>n.keyupHandler&&n.keyupHandler(...c),["stop"]))},[(l(!0),p(h,null,x(n.mapInstance,(c,m)=>(l(),p("div",{key:m,class:"row"},[(l(!0),p(h,null,x(c,(s,o)=>(l(),p("div",{key:(s==null?void 0:s.key)||o+m,class:N(["col",{[(s==null?void 0:s.itemType)||"empty"]:!0,target:n.isTarget(o,m)}]),style:B({width:`${n.size}px`,height:`${n.size}px`}),onClick:()=>{n.touchMove(o,m)}},[(s==null?void 0:s.itemType)==="neko"?(l(),p(h,{key:0},[_(" 😾 ")],64)):(s==null?void 0:s.itemType)==="box"?(l(),p(h,{key:1},[_(" 📦 ")],64)):I("",!0)],14,J))),128))]))),128)),n.congratulations?(l(),p("div",O," 通关 ")):I("",!0),P],32),v("div",Q,[D(d,{type:"primary",onLoadingClick:n.reset},{default:z(()=>[_(" 重置 ")]),_:1},8,["onLoadingClick"])])])}const U=S(j,[["render",R],["__scopeId","data-v-e740188f"]]),W={components:{Sokoban:U},props:{content:{type:Array,default:()=>[]}}},X={key:1};function Y(i,e,t,n,r,a){const d=C("Sokoban");return l(),p("div",null,[t.content[0]==="sokoban"?(l(),V(d,{key:0,map:t.content[1]},null,8,["map"])):(l(),p("span",X,"[component "+H(t.content)+" not found]",1))])}const te=S(W,[["render",Y]]);export{te as default};
