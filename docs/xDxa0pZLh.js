import{_ as M,Z as E,p as S,r as g,ac as w,j as m,k as r,b as u,f as l,z as c,l as b,L as V,J as A,gC as B,a0 as C,gD as L,d as y,F as I,B as N,t as k,e as v}from"./assets/index-dK3A5pbu.js";import{I as x}from"./xCHSRk-Pr.js";import{M as T}from"./xCY4EuNqX.js";import{M as U}from"./xB4L2M6-r.js";import"./xsK7Tbxiu.js";/* empty css         *//* empty css         */import"./xCZZrobAw.js";import"./xDSpHJm7g.js";import"./vander_commonjsHelpers-CqkleIqs.js";import"./xCrBWEtQR.js";import"./xnMSaOKre.js";import"./xDamispQD.js";import"./xDXcFiglo.js";import"./xBWLwD-UA.js";import"./vander_baseFindIndex-D7XfJLKM.js";import"./xCfesGaoO.js";/* empty css         *//* empty css         */import"./xfZGbqDmi.js";import"./xDkLS8U1T.js";import"./vander_baseIteratee-DYrSvSGZ.js";import"./xDZ_LoW6I.js";/* empty css         */import"./xzmw4ilvk.js";import"./x1gGzKIyF.js";const q={components:{ImageCon:x,MDEditor:U,TextInput:E},props:{onCancel:{type:Function,default:null},onSubmit:{type:Function,default:null},title:{type:String,default:()=>""}},setup(){const{guestName:o,guestEmail:t}=S(),a=g(o.value||""),e=g(t.value||""),s=g(""),d=g("");w(a,()=>{o.value=a.value}),w(e,()=>{t.value=e.value});const p=async()=>{if(/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/.test(e.value)){const _=new TextEncoder().encode(e.value.trim().toLowerCase()),f=await window.crypto.subtle.digest("SHA-256",_),i=Array.from(new Uint8Array(f));s.value=i.map(h=>h.toString(16).padStart(2,"0")).join("")}};return p(),{name:a,email:e,gravatar:s,content:d,onEmailInput:p}},methods:{beforeSubmit(o){return this.onSubmit({content:o,name:this.name,email:this.email})}}},F={class:"comment-editor"},H={class:"editor-header"},j={class:"head-box"},z={class:"input name"},J={class:"input email"};function O(o,t,a,e,s,d){const p=m("ImageCon"),_=m("TextInput"),f=m("MDEditor");return r(),u("div",F,[l("div",H,[l("div",j,[c(p,{src:e.gravatar?`https://www.gravatar.com/avatar/${e.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),l("div",z,[t[3]||(t[3]=b(" 名称：")),c(_,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.name=i)},null,8,["modelValue"])]),l("div",J,[t[4]||(t[4]=b(" 邮箱：")),c(_,{modelValue:e.email,"onUpdate:modelValue":t[1]||(t[1]=i=>e.email=i),type:"email",onInput:e.onEmailInput},null,8,["modelValue","onInput"])])]),c(f,{"model-value":e.content,"onUpdate:modelValue":t[2]||(t[2]=i=>e.content=i),cache:!1,showDefaultHandlers:["submit","clean"],safeMode:!0,title:a.title,"on-submit":d.beforeSubmit,"ex-handlers":a.onCancel?[{name:"取消",handler:a.onCancel}]:[]},null,8,["model-value","title","on-submit","ex-handlers"])])}const Z=M(q,[["render",O],["__scopeId","data-v-f94c44d2"]]),G={name:"Comment",components:{LoadingIcon:V,ImageCon:x,Markdown:T,CommentMDEditor:Z},props:{deep:{type:Number,default:()=>0},query:{type:Object,default:()=>null},replys:{type:Array,default:()=>null}},data(){return{loading:!1,comments:[],parentId:null}},created(){this.load()},methods:{formatDate:A,load(){this.query?(this.loading=!0,B(this.query).then(o=>{this.comments=o}).finally(()=>{this.loading=!1})):this.replys&&(this.comments=this.replys)},async onSubmitComment(o){if(!o.name)throw C.warning("必须填写名称"),new Error("必须填写名称");if(!o.content)throw C.warning("必须填写内容"),new Error("必须填写内容");return L({...o,...this.query}).then(()=>{this.parentId=null,this.load()})}}},K={class:"comments"},P={class:"head-box"},Q={class:"content"},R={class:"info"},W={class:"name"},X={class:"time"},Y=["onClick"],$={key:0,class:"no-comment"};function ee(o,t,a,e,s,d){const p=m("LoadingIcon"),_=m("ImageCon"),f=m("Markdown"),i=m("Comment",!0),h=m("CommentMDEditor");return r(),u("div",K,[s.loading?(r(),y(p,{key:0})):(r(),u(I,{key:1},[(r(!0),u(I,null,N(s.comments,n=>(r(),u("div",{key:n.id,class:"comment"},[l("div",P,[c(_,{src:n.gravatar?`https://www.gravatar.com/avatar/${n.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),l("div",Q,[l("div",R,[l("div",W,k(n.name),1),l("div",X,k(d.formatDate(n.uptime||n.time,"yyyy-MM-dd HH:mm:ss UTC DD")),1),a.deep===0?(r(),u("div",{key:0,class:"reply",onClick:()=>{s.parentId=n.id}}," 回复 ",8,Y)):v("",!0)]),c(f,{"model-value":n.content,safeMode:!0},null,8,["model-value"]),c(i,{class:"replys",deep:1,replys:n.replys},null,8,["replys"]),a.deep===0&&s.parentId===n.id?(r(),y(h,{key:0,title:`回复${n.name}`,"on-submit":D=>d.onSubmitComment({parentId:n.id,...D}),"on-cancel":()=>{s.parentId=null}},null,8,["title","on-submit","on-cancel"])):v("",!0)])]))),128)),a.deep===0&&s.comments.length===0?(r(),u("div",$," 暂无评论 ")):v("",!0)],64)),a.deep===0&&s.parentId===null?(r(),y(h,{key:2,"on-submit":n=>d.onSubmitComment(n)},null,8,["on-submit"])):v("",!0)])}const De=M(G,[["render",ee],["__scopeId","data-v-ad0559b5"]]);export{De as default};
