import{_ as L,a9 as O,K as F,g8 as z,g9 as N,j as f,k as d,d as S,w as V,b as v,e as k,f as c,l as P,z as y,S as $,A as W,p as G,a as R,r as w,F as x,B as U,t as D,n as K,ga as q,gb as J,gc as Q,a0 as I,gd as X,b8 as Y,a5 as Z,u as ee,N as te,ak as oe,al as ae,ac as le,c as se,ge as ne,R as re,ct as ie,V as de,b0 as ce,a1 as ue,gf as me,gg as fe,gh as j,gi as pe}from"./assets/index-B1eEDWgP.js";import{P as he}from"./xDyDaTGEa.js";import{E as T}from"./xpESGtWU-.js";import{M as ge}from"./xDdD4P5DT.js";import{I as ve}from"./xD3RGWLI2.js";/* empty css         *//* empty css         *//* empty css         *//* empty css         */import{E as ye,a as _e}from"./xCEnewIpG.js";/* empty css         */import{E as Ve}from"./xDXAzHMle.js";import{E as be}from"./xBbA2YkB5.js";const we={components:{ElDialog:T,ButtonBox:O,AsyncSwitch:F,PreviewScreenshots:he},data(){return{dialogVisible:!1,resolve:null,reject:null,file:null,sourceSrc:null,sourceKeyname:null,screenshots:"00:00:00.0",isLoop:!1,handlers:[{name:"返回",type:"default",handler:()=>{this.reject()}},{name:"确认",type:"primary",handler:async()=>{const l=await z(await this.$refs.PreviewScreenshots.getScreenshots(this.screenshots,"png"),"thumbnail.png");return this.resolve({thumbnail:l,file:this.file,isLoop:this.isLoop})}}]}},methods:{async open({callback:l,file:e}={}){return this.dialogVisible=!0,this.file=e,this.sourceSrc=URL.createObjectURL(e),this.sourceKeyname=await N(e),this.screenshots="00:00:00.0",this.isLoop=!1,new Promise((s,o)=>{this.resolve=t=>{if(this.reject=null,l){const u=l(t);return Promise.resolve(u).then(()=>{s(t)})}else s(t)},this.reject=t=>{o(t)}}).finally(()=>{this.dialogVisible=!1})}}},Ee=["loop","src"],Se={class:"cell"};function Me(l,e,s,o,t,u){const p=f("PreviewScreenshots"),h=f("AsyncSwitch"),g=f("ButtonBox"),_=f("el-dialog");return d(),S(_,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[3]||(e[3]=m=>t.dialogVisible=m),top:"10px",class:"fv4w4f5616f5wefew",title:"视频上传","lock-scroll":!0,"close-on-click-modal":!1,"before-close":m=>{t.reject&&(m(),t.reject())}},{default:V(()=>[t.dialogVisible?(d(),v("video",{key:0,class:"video",controls:"",preload:"none",loop:t.isLoop,src:t.sourceSrc,onError:e[0]||(e[0]=m=>{l.$message({type:"error",message:"视频播放失败",duration:5e3})})},null,40,Ee)):k("",!0),t.dialogVisible?(d(),S(p,{key:1,ref:"PreviewScreenshots",modelValue:t.screenshots,"onUpdate:modelValue":e[1]||(e[1]=m=>t.screenshots=m),sourceKeyname:t.sourceKeyname},null,8,["modelValue","sourceKeyname"])):k("",!0),c("div",Se,[e[4]||(e[4]=P(" 循环播放： ")),y(h,{modelValue:t.isLoop,"onUpdate:modelValue":e[2]||(e[2]=m=>t.isLoop=m)},null,8,["modelValue"])]),y(g,{handlers:t.handlers},null,8,["handlers"])]),_:1},8,["modelValue","before-close"])}const ke=L(we,[["render",Me],["__scopeId","data-v-63f04aac"]]),De={components:{SvgIcon:$,ImageCon:ve,AsyncButtom:W,ElDialog:T,ElSelect:ye,ElOption:_e},props:{init:{type:Boolean,default:!0},safeMode:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:e}){const{emoteHistory:s}=G(),o=R({name:"history",emote:s.value}),t=R([]),u=w("history"),p=n=>{if(u.value=n.name,n.emote.length===0)return q(n.name).then(r=>{u.value=n.name,n.emote=r.emote.map(i=>({...i,scope:n.name}))})},h=()=>{t.splice(0,t.length),t.push(o),J().then(n=>{t.push(...n.sort((r,i)=>{const b=s.value.findIndex(B=>B.scope===r.name),C=s.value.findIndex(B=>B.scope===i.name);return(b===-1?1/0:b)-(C===-1?1/0:C)})),l.safeMode||t.push({name:"add",emote:[]})})};h();const g=n=>{e("select",n),s.value=s.value.filter(r=>!(r.scope===n.scope&&r.name===n.name)),s.value=[n,...s.value].slice(0,30),o.emote=s.value},_=w(!1),m=n=>Q(n).then(()=>{I.success("添加成功"),h()}),E=w(null),a=w([]),M=w(!1);return{onSelect:g,currentScope:u,emotePackages:t,selectScope:p,addEmotePackage:m,addEmoteDialogVisible:_,addEmoteDialogValue:E,addEmoteDialogOptions:a,addEmoteDialogRemoteMethod:n=>{n?(M.value=!0,X(n).then(r=>{a.value=r.map(i=>({...i,label:i.text,value:i.id})),M.value=!1})):(a.value=[],M.value=!1)},addEmoteDialogLoading:M}}},Be={class:"emote-selector"},xe={class:"emotes"},He={class:"scopes"},Ie=["onClick"],Ce={class:"option"},Ue={class:"info-box"},Ae={class:"label"},Pe={class:"value"},Le={class:"dialog-footer"};function Re(l,e,s,o,t,u){const p=f("ImageCon"),h=f("SvgIcon"),g=f("el-option"),_=f("el-select"),m=f("AsyncButtom"),E=f("el-dialog");return d(),v("div",Be,[c("div",xe,[(d(!0),v(x,null,U((o.emotePackages.find(a=>a.name===o.currentScope)||{}).emote||[],a=>(d(),S(p,{key:a.name,class:"emote",alt:a.name,src:`/emoji/${a.scope}/${a.name}.png`,onClick:M=>o.onSelect(a)},{error:V(()=>[c("span",null,D(a.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),c("div",He,[(d(!0),v(x,null,U(o.emotePackages,a=>(d(),v("div",{key:a.name,class:K(["scope",{"selected-scope":o.currentScope===a.name}]),onClick:()=>{a.name==="add"?o.addEmoteDialogVisible=!0:o.selectScope(a)}},[a.name==="history"?(d(),S(h,{key:0,class:"emote history",name:"icon-time"})):a.name==="add"?(d(),S(h,{key:1,class:"emote history",name:"add"})):(d(),S(p,{key:2,class:"emote",src:`/emoji/${a.name}/${a.name}.png`},{error:V(()=>[c("span",null,D(a.name),1)]),_:2},1032,["src"]))],10,Ie))),128))]),y(E,{modelValue:o.addEmoteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=a=>o.addEmoteDialogVisible=a),title:"添加表情包","close-on-click-modal":!1,"append-to-body":""},{footer:V(()=>[c("div",Le,[y(m,{type:"primary",size:"mini",onLoadingClick:()=>{o.addEmoteDialogVisible=!1}},{default:V(()=>e[2]||(e[2]=[P(" 取消 ")])),_:1},8,["onLoadingClick"]),y(m,{type:"primary",size:"mini",onLoadingClick:()=>(o.addEmoteDialogVisible=!1,o.addEmotePackage(o.addEmoteDialogValue))},{default:V(()=>e[3]||(e[3]=[P(" 确认 ")])),_:1},8,["onLoadingClick"])])]),default:V(()=>[y(_,{modelValue:o.addEmoteDialogValue,"onUpdate:modelValue":e[0]||(e[0]=a=>o.addEmoteDialogValue=a),filterable:"",remote:"","remote-method":o.addEmoteDialogRemoteMethod,loading:o.addEmoteDialogLoading,"popper-class":"add-emote-selector"},{default:V(()=>[(d(!0),v(x,null,U(o.addEmoteDialogOptions,a=>(d(),S(g,{key:a.value,label:a.label,value:a.value},{default:V(()=>[c("div",Ce,[c("div",Ue,[c("div",Ae,D(a.label),1),c("div",Pe,D(a.value),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","loading"])]),_:1},8,["modelValue"])])}const je=L(De,[["render",Re],["__scopeId","data-v-3b808619"]]);function Oe(l){const e=w(null),s=Y(Ve,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:e.value,"onUpdate:modelValue":o=>{var t;e.value=o,(t=s.component)!=null&&t.props&&(s.component.props.modelValue=o)}});Z({title:"选择预约时间",message:s,confirmHandlerPromise:o=>l(e),inputValidator:o=>!!e.value,inputErrorMessage:"请选择预约时间"})}const A={},$e={components:{SvgIcon:$,Markdown:ge,ButtonBox:O,EmoteSelector:je,ElPopover:be,VideoUploader:ke},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},safeMode:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(l,{emit:e}){const{darkMode:s}=ee(),o=w(!0),{computedModelValue:t}=te(l,e),u=w(!1),p=w(null);if(l.cache){const n=ue();if(A[n.fullPath]&&l.cache===!0)I.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const r="MDEditorCache."+(l.cache===!0?n.fullPath:`${n.fullPath}.${l.cache}`);t.value=localStorage.getItem(r)||l.defaultValue,oe(()=>{A[r]=!0}),ae(()=>{A[r]=!1});const i=pe(()=>{u.value=!0,localStorage.setItem(r,t.value||"")},1e3);le(t,()=>{u.value=!1,i()})}}const h=n=>{const r=p.value.selectionStart,i=t.value.slice(0,r),b=t.value.slice(r);t.value=`${i}${n}${b}`},g=w(t.value),_=({reservationDate:n}={})=>{const r=l.onSubmit(t.value,n==null?void 0:n.value);return r instanceof Promise?r.then(()=>{t.value=l.defaultValue||"",g.value=l.defaultValue||""}):(t.value=l.defaultValue||"",g.value=l.defaultValue||""),r},m=()=>{t.value=""},E=()=>{t.value=g.value},a=[{name:"提交",type:"primary",handler:_,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("submit"):l.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{Oe(n=>{_({reservationDate:n})})},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reservation"):l.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:m,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("clean"):l.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:E,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reset"):l.showDefaultHandlers)&&!!g.value,sort:30}],M=se(()=>[...a,...l.exHandlers]),H=n=>{const r=me(URL.createObjectURL(n),{handlers:[{name:"上传",type:"primary",handler:()=>{const i=new Date().valueOf().toString();h(`![${i}](--------------------)`),fe(n,b=>{const B=Math.round(100*b.loaded/b.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${i}](${"#".repeat(B)}${"-".repeat(20-B)})`)}).then(b=>{t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),`![${b.keyname}](${b.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${i}]\\((#*?)(-*?)\\)`),"")}),r.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{j(n,16,9).then(i=>{r.callClose(),H(i)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{j(n,160,67).then(i=>{r.callClose(),H(i)})}},{name:"取消",type:"default",handler:()=>{r.callClose()}}]})};return{darkMode:s,isEditMode:o,computedModelValue:t,resetCache:g,isSave:u,handlers:M,submitHandler:_,cleanHandler:m,resetHandler:E,previewImageBeforeUpload:H,textarea:p,insertText:h}},methods:{pasteHandler(l){if(!(l.clipboardData&&l.clipboardData.items))return;const e=Array.from(l.clipboardData.items).filter(s=>s.kind==="file");if(e.length===1){l.preventDefault();for(const s of e)if(s.type.startsWith("image/")){this.previewImageBeforeUpload(s.getAsFile());return}else if(s.type.startsWith("video/")){this.previewVideoBeforeUpload(s.getAsFile());return}else I.warning(`不支持的文件类型: ${s.type}`)}},dropHandler(l){for(const e of l.dataTransfer.files)if(l.preventDefault(),e.type.startsWith("image/")){this.previewImageBeforeUpload(e);return}else if(e.type.startsWith("video/")){this.previewVideoBeforeUpload(e.getAsFile());return}else I.warning(`不支持的文件类型: ${e.type}`)},previewVideoBeforeUpload(l){this.$refs.VideoUploader.open({file:l,callback:e=>{const s=new Date().valueOf().toString(),o=e.isLoop?"video-loop":"video";this.insertText(`[${o} ${s}](--------------------)`),ne(l,t=>{const p=Math.round(100*t.loaded/t.total)/10*2;this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),`[${o} ${s}](${"#".repeat(p)}${"-".repeat(20-p)})`)},e.thumbnail).then(t=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),`[${o} ${t.local}]`)}).catch(()=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${o} ${s}]\\((#*?)(-*?)\\)`),"")})}})}}},Ke={class:"fill"},Te=["disabled"],Fe={key:1,class:"preview"},ze={class:"bar"},Ne={class:"bar-left"},We={class:"title"},Ge={key:0,class:"uploader"},qe={key:1,class:"uploader"},Je={class:"bar-right"},Qe={key:0,class:"is-save info"};function Xe(l,e,s,o,t,u){const p=f("Markdown"),h=f("SvgIcon"),g=f("EmoteSelector"),_=f("el-popover"),m=f("ButtonBox"),E=f("VideoUploader");return d(),v(x,null,[c("div",ce({class:"md-editor"},l.$attrs),[o.isEditMode?(d(),v("div",{key:0,class:K(["textarea-box",{"auto-height":s.autoHeight}])},[c("pre",Ke,D(o.computedModelValue),1),re(c("textarea",{ref:"textarea","onUpdate:modelValue":e[0]||(e[0]=a=>o.computedModelValue=a),class:"textarea",disabled:s.disabled,onPaste:e[1]||(e[1]=(...a)=>u.pasteHandler&&u.pasteHandler(...a)),onDragover:e[2]||(e[2]=de(()=>{},["prevent"])),onDrop:e[3]||(e[3]=(...a)=>u.dropHandler&&u.dropHandler(...a))},null,40,Te),[[ie,o.computedModelValue]])],2)):(d(),v("div",Fe,[y(p,{"model-value":o.computedModelValue,safeMode:s.safeMode},null,8,["model-value","safeMode"])])),c("div",ze,[c("div",Ne,[s.disabled?k("",!0):(d(),v(x,{key:0},[c("div",We,D(s.title),1),s.safeMode?k("",!0):(d(),v("label",Ge,[y(h,{class:"button",name:"14"}),c("input",{type:"file",accept:"image/*",onChange:e[4]||(e[4]=a=>{o.previewImageBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)])),s.safeMode?k("",!0):(d(),v("label",qe,[y(h,{class:"button",name:"video"}),c("input",{type:"file",accept:"video/*",onChange:e[5]||(e[5]=a=>{u.previewVideoBeforeUpload(a.srcElement.files[0]),a.srcElement.value=""})},null,32)])),y(_,{width:"auto",trigger:"click",effect:o.darkMode?"dark":"light"},{reference:V(()=>[y(h,{class:"button",name:"biaoqing"})]),default:V(()=>[y(g,{safeMode:s.safeMode,onSelect:e[6]||(e[6]=a=>{o.insertText(`[emoji ${a.scope}/${a.name}]`)})},null,8,["safeMode"])]),_:1},8,["effect"])],64))]),c("div",Je,[o.isSave?(d(),v("span",Qe,"已保存")):k("",!0),c("span",{class:"preview-switch button",onClick:e[7]||(e[7]=a=>o.isEditMode=!o.isEditMode)},D(o.isEditMode?"预览":"返回编辑"),1)])])],16),o.handlers.length>0?(d(),S(m,{key:0,handlers:o.handlers},null,8,["handlers"])):k("",!0),y(E,{ref:"VideoUploader"},null,512)],64)}const Ye=L($e,[["render",Xe],["__scopeId","data-v-a40fff88"]]),mt=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{Ye as M,mt as a,Oe as u};
