import{_ as M,Z as S,p as D,r as y,ac as b,j as m,k as r,b as u,f as l,z as c,l as I,L as V,u as A,J as B,gF as L,a0 as w,gG as H,d as v,F as C,B as N,t as k,e as g}from"./assets/index-BJYhPSJA.js";import{I as x}from"./xBU5ceHTG.js";import{M as T}from"./xBFMtIYVl.js";import{M as U}from"./xPddYU-Au.js";import"./xCbPFfRpy.js";/* empty css         *//* empty css         */import"./x2KCuKX96.js";import"./xDSpHJm7g.js";import"./vander_commonjsHelpers-CqkleIqs.js";import"./xNOzwMRd7.js";import"./xVMvG-wq-.js";import"./xBcdE1o7i.js";import"./xDzVDCye4.js";import"./xDgExv7JF.js";import"./vander_baseFindIndex-D7XfJLKM.js";import"./xB_VITgwv.js";/* empty css         *//* empty css         */import"./x-i6IoIsu.js";import"./xuj2sLPmp.js";import"./vander_baseIteratee-BdFWqmwy.js";import"./xCvfKfLA1.js";/* empty css         */import"./x77awqKiv.js";import"./x4taewPTd.js";const F={components:{ImageCon:x,MDEditor:U,TextInput:S},props:{onCancel:{type:Function,default:null},onSubmit:{type:Function,default:null},title:{type:String,default:()=>""}},setup(){const{guestName:t,guestEmail:n}=D(),a=y(t.value||""),e=y(n.value||""),s=y(""),d=y("");b(a,()=>{t.value=a.value}),b(e,()=>{n.value=e.value});const p=async()=>{if(/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/.test(e.value)){const _=new TextEncoder().encode(e.value.trim().toLowerCase()),f=await window.crypto.subtle.digest("SHA-256",_),i=Array.from(new Uint8Array(f));s.value=i.map(h=>h.toString(16).padStart(2,"0")).join("")}};return p(),{name:a,email:e,gravatar:s,content:d,onEmailInput:p}},methods:{beforeSubmit(t){return this.onSubmit({content:t,name:this.name,email:this.email})}}},q={class:"comment-editor"},j={class:"editor-header"},z={class:"head-box"},G={class:"input name"},J={class:"input email"};function O(t,n,a,e,s,d){const p=m("ImageCon"),_=m("TextInput"),f=m("MDEditor");return r(),u("div",q,[l("div",j,[l("div",z,[c(p,{src:e.gravatar?`https://www.gravatar.com/avatar/${e.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),l("div",G,[n[3]||(n[3]=I(" 名称：")),c(_,{modelValue:e.name,"onUpdate:modelValue":n[0]||(n[0]=i=>e.name=i)},null,8,["modelValue"])]),l("div",J,[n[4]||(n[4]=I(" 邮箱：")),c(_,{modelValue:e.email,"onUpdate:modelValue":n[1]||(n[1]=i=>e.email=i),type:"email",onInput:e.onEmailInput},null,8,["modelValue","onInput"])])]),c(f,{"model-value":e.content,"onUpdate:modelValue":n[2]||(n[2]=i=>e.content=i),cache:!1,showDefaultHandlers:["submit","clean"],safeMode:!0,title:a.title,"on-submit":d.beforeSubmit,"ex-handlers":a.onCancel?[{name:"取消",handler:a.onCancel}]:[]},null,8,["model-value","title","on-submit","ex-handlers"])])}const Z=M(F,[["render",O],["__scopeId","data-v-a5ae52cc"]]),K={name:"Comment",components:{LoadingIcon:V,ImageCon:x,Markdown:T,CommentMDEditor:Z},props:{deep:{type:Number,default:()=>0},query:{type:Object,default:()=>null},replys:{type:Array,default:()=>null}},setup(){const{mobileMode:t}=A();return{mobileMode:t}},data(){return{loading:!1,comments:[],parentId:null}},created(){this.load()},methods:{formatDate:B,load(){this.query?(this.loading=!0,L(this.query).then(t=>{this.comments=t}).finally(()=>{this.loading=!1})):this.replys&&(this.comments=this.replys)},async onSubmitComment(t){if(!t.name)throw w.warning("必须填写名称"),new Error("必须填写名称");if(!t.content)throw w.warning("必须填写内容"),new Error("必须填写内容");if(t.email&&!/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/.test(t.email))throw w.warning("邮箱格式错误"),new Error("邮箱格式错误");return H({...t,...this.query}).then(()=>{this.parentId=null,this.load()})}}},P={class:"comments"},Q={class:"head-box"},R={class:"content"},W={class:"info"},X={class:"name"},Y={class:"time"},$=["onClick"],ee={key:0,class:"no-comment"};function te(t,n,a,e,s,d){const p=m("LoadingIcon"),_=m("ImageCon"),f=m("Markdown"),i=m("Comment",!0),h=m("CommentMDEditor");return r(),u("div",P,[s.loading?(r(),v(p,{key:0})):(r(),u(C,{key:1},[(r(!0),u(C,null,N(s.comments,o=>(r(),u("div",{key:o.id,class:"comment"},[l("div",Q,[c(_,{src:o.gravatar?`https://www.gravatar.com/avatar/${o.gravatar}?s=200&r=pg&d=404`:"/assets/Akkarin.webp",defaultImg:"/assets/Akkarin.webp"},null,8,["src"])]),l("div",R,[l("div",W,[l("div",X,k(o.name),1),l("div",Y,k(d.formatDate(o.uptime||o.time,e.mobileMode?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd HH:mm:ss UTC DD")),1),a.deep===0?(r(),u("div",{key:0,class:"reply",onClick:()=>{s.parentId=o.id}}," 回复 ",8,$)):g("",!0)]),c(f,{"model-value":o.content,safeMode:!0},null,8,["model-value"]),c(i,{class:"replys",deep:1,replys:o.replys},null,8,["replys"]),a.deep===0&&s.parentId===o.id?(r(),v(h,{key:0,title:`回复${o.name}`,"on-submit":E=>d.onSubmitComment({parentId:o.id,...E}),"on-cancel":()=>{s.parentId=null}},null,8,["title","on-submit","on-cancel"])):g("",!0)])]))),128)),a.deep===0&&s.comments.length===0?(r(),u("div",ee," 暂无评论 ")):g("",!0)],64)),a.deep===0&&s.parentId===null?(r(),v(h,{key:2,"on-submit":o=>d.onSubmitComment(o)},null,8,["on-submit"])):g("",!0)])}const Se=M(K,[["render",te],["__scopeId","data-v-46685625"]]);export{Se as default};
