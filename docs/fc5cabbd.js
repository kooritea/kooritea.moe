import{_ as U,a7 as j,I as K,f$ as F,g0 as O,b as g,d as u,f as S,w as x,e as _,g as k,h as d,l as N,p as w,S as L,q as W,a as C,r as E,F as D,E as $,t as M,n as R,g1 as q,g2 as z,a3 as T,g3 as G,a0 as I,b1 as Q,u as Y,K as J,Y as X,ai as Z,aj as ee,aa as te,c as oe,g4 as ae,Q as le,cu as se,T as ne,aU as re,g5 as ie,g6 as ce,g7 as A}from"./assets/index-26dd84fe.js";import{P as de}from"./0e306f35.js";import{E as ue}from"./5ba0721e.js";import{M as me}from"./ddf44a29.js";import{I as pe}from"./941e2839.js";/* empty css        *//* empty css        *//* empty css        */import{E as fe}from"./c2bca8df.js";import{E as he}from"./cbbe72ee.js";const ge={components:{ElDialog:ue,ButtonBox:j,AsyncSwitch:K,PreviewScreenshots:de},data(){return{dialogVisible:!1,resolve:null,reject:null,file:null,sourceSrc:null,sourceKeyname:null,screenshots:"00:00:00.0",isLoop:!1,handlers:[{name:"返回",type:"default",handler:()=>{this.reject()}},{name:"确认",type:"primary",handler:async()=>{const o=await F(await this.$refs.PreviewScreenshots.getScreenshots(this.screenshots,"png"),"thumbnail.png");return this.resolve({thumbnail:o,file:this.file,isLoop:this.isLoop})}}]}},methods:{async open({callback:o,file:t}={}){return this.dialogVisible=!0,this.file=t,this.sourceSrc=URL.createObjectURL(t),this.sourceKeyname=await O(t),this.screenshots="00:00:00.0",this.isLoop=!1,new Promise((l,a)=>{this.resolve=e=>{if(this.reject=null,o){const c=o(e);return Promise.resolve(c).then(()=>{l(e)})}else l(e)},this.reject=e=>{a(e)}}).finally(()=>{this.dialogVisible=!1})}}},ve=["src"],_e={class:"cell"};function ye(o,t,l,a,e,c){const p=g("PreviewScreenshots"),f=g("AsyncSwitch"),n=g("ButtonBox"),y=g("el-dialog");return u(),S(y,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=s=>e.dialogVisible=s),top:"10px",class:"fv4w4f5616f5wefew",title:"视频上传","lock-scroll":!0,"close-on-click-modal":!1,"before-close":s=>{e.reject&&(s(),e.reject())}},{default:x(()=>[e.dialogVisible?(u(),_("video",{key:0,class:"video",controls:"",preload:"none",src:e.sourceSrc,onError:t[0]||(t[0]=s=>{o.$message({type:"error",message:"视频播放失败",duration:5e3})})},null,40,ve)):k("",!0),e.dialogVisible?(u(),S(p,{key:1,ref:"PreviewScreenshots",modelValue:e.screenshots,"onUpdate:modelValue":t[1]||(t[1]=s=>e.screenshots=s),sourceKeyname:e.sourceKeyname},null,8,["modelValue","sourceKeyname"])):k("",!0),d("div",_e,[t[4]||(t[4]=N(" 循环播放： ")),w(f,{modelValue:e.isLoop,"onUpdate:modelValue":t[2]||(t[2]=s=>e.isLoop=s)},null,8,["modelValue"])]),w(n,{handlers:e.handlers},null,8,["handlers"])]),_:1},8,["modelValue","before-close"])}const we=U(ge,[["render",ye],["__scopeId","data-v-24a9c08f"]]);const Ve={components:{SvgIcon:L,ImageCon:pe},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(o,{emit:t}){const{emoteHistory:l}=W(),a=C({name:"history",emote:l.value}),e=C([]),c=E("history"),p=s=>{if(c.value=s.name,s.emote.length===0)return q(s.name).then(v=>{c.value=s.name,s.emote=v.emote.map(r=>({...r,scope:s.name}))})},f=()=>{e.splice(0,e.length),e.push(a),z().then(s=>{e.push(...s.sort((v,r)=>{const B=l.value.findIndex(i=>i.scope===v.name),b=l.value.findIndex(i=>i.scope===r.name);return(B===-1?1/0:B)-(b===-1?1/0:b)})),e.push({name:"add",emote:[]})})};return f(),{onSelect:s=>{t("select",s),l.value=l.value.filter(v=>!(v.scope===s.scope&&v.name===s.name)),l.value=[s,...l.value].slice(0,30),a.emote=l.value},addEmotePackage:()=>{T({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:s=>G(s.inputValue).then(()=>{I.success("添加成功"),f()}),inputValidator:s=>/^\d+$/.test(s),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:c,emotePackages:e,selectScope:p}}},Se={class:"emote-selector"},be={class:"emotes"},Ee={class:"scopes"},ke=["onClick"];function Me(o,t,l,a,e,c){const p=g("ImageCon"),f=g("SvgIcon");return u(),_("div",Se,[d("div",be,[(u(!0),_(D,null,$((a.emotePackages.find(n=>n.name===a.currentScope)||{}).emote||[],n=>(u(),S(p,{key:n.name,class:"emote",alt:n.name,src:`/emoji/${n.scope}/${n.name}.png`,onClick:y=>a.onSelect(n)},{error:x(()=>[d("span",null,M(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),d("div",Ee,[(u(!0),_(D,null,$(a.emotePackages,n=>(u(),_("div",{key:n.name,class:R(["scope",{"selected-scope":a.currentScope===n.name}]),onClick:()=>{n.name==="add"?a.addEmotePackage():a.selectScope(n)}},[n.name==="history"?(u(),S(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(u(),S(f,{key:1,class:"emote history",name:"add"})):(u(),S(p,{key:2,class:"emote",src:`/emoji/${n.name}/${n.name}.png`},{error:x(()=>[d("span",null,M(n.name),1)]),_:2},1032,["src"]))],10,ke))),128))])])}const xe=U(Ve,[["render",Me],["__scopeId","data-v-6872cbc5"]]);function Be(o){const t=E(null),l=Q(fe,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:t.value,"onUpdate:modelValue":a=>{var e;t.value=a,(e=l.component)!=null&&e.props&&(l.component.props.modelValue=a)}});T({title:"选择预约时间",message:l,confirmHandlerPromise:a=>o(t),inputValidator:a=>!!t.value,inputErrorMessage:"请选择预约时间"})}const H={},Ie={components:{SvgIcon:L,Markdown:me,ButtonBox:j,EmoteSelector:xe,ElPopover:he,VideoUploader:we},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},disabled:{type:Boolean,default:!1},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(o,{emit:t}){const{darkMode:l}=Y(),a=E(!0),{computedModelValue:e}=J(o,t),c=E(!1),p=E(null);if(o.cache){const i=X();if(H[i.fullPath]&&o.cache===!0)I.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const m="MDEditorCache."+(o.cache===!0?i.fullPath:`${i.fullPath}.${o.cache}`);e.value=localStorage.getItem(m)||o.defaultValue;let h=null;Z(()=>{H[m]=!0,h=setInterval(()=>{c.value=!0,localStorage.setItem(m,e.value||"")},1e3)}),ee(()=>{H[m]=!1,clearInterval(h)}),te(e,()=>{c.value=!1})}}const f=i=>{const m=p.value.selectionStart,h=e.value.slice(0,m),V=e.value.slice(m);e.value=`${h}${i}${V}`},n=E(e.value),y=({reservationDate:i}={})=>{const m=o.onSubmit(e.value,i==null?void 0:i.value);return m instanceof Promise?m.then(()=>{e.value=o.defaultValue,n.value=o.defaultValue}):(e.value=o.defaultValue,n.value=o.defaultValue),m},s=()=>{e.value=""},v=()=>{e.value=n.value},r=[{name:"提交",type:"primary",handler:y,show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("submit"):o.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{Be(i=>{y({reservationDate:i})})},show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("reservation"):o.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:s,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("clean"):o.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:v,confirm:{message:"确认重置内容?"},show:()=>(Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("reset"):o.showDefaultHandlers)&&!!n.value,sort:30}],B=oe(()=>[...r,...o.exHandlers]),b=i=>{const m=ie(URL.createObjectURL(i),{handlers:[{name:"上传",type:"primary",handler:()=>{const h=new Date().valueOf().toString();f(`![${h}](--------------------)`),ce(i,V=>{const P=Math.round(100*V.loaded/V.total)/10*2;e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),`![${h}](${"#".repeat(P)}${"-".repeat(20-P)})`)}).then(V=>{e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),`![${V.keyname}](${V.local})`)}).catch(()=>{e.value=e.value.replace(new RegExp(`\\!\\[${h}]\\((#*?)(-*?)\\)`),"")}),m.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{A(i,16,9).then(h=>{m.callClose(),b(h)})}},{name:"裁剪为电影尺寸",type:"default",show:()=>{},handler:()=>{A(i,160,67).then(h=>{m.callClose(),b(h)})}},{name:"取消",type:"default",handler:()=>{m.callClose()}}]})};return{darkMode:l,isEditMode:a,computedModelValue:e,resetCache:n,isSave:c,handlers:B,submitHandler:y,cleanHandler:s,resetHandler:v,previewImageBeforeUpload:b,textarea:p,insertText:f}},methods:{pasteHandler(o){if(!(o.clipboardData&&o.clipboardData.items))return;const t=Array.from(o.clipboardData.items).filter(l=>l.kind==="file");if(t.length===1){o.preventDefault();for(const l of t)if(l.type.startsWith("image/")){this.previewImageBeforeUpload(l.getAsFile());return}else if(l.type.startsWith("video/")){this.previewVideoBeforeUpload(l.getAsFile());return}else I.warning(`不支持的文件类型: ${l.type}`)}},dropHandler(o){for(const t of o.dataTransfer.files)if(o.preventDefault(),t.type.startsWith("image/")){this.previewImageBeforeUpload(t);return}else if(t.type.startsWith("video/")){this.previewVideoBeforeUpload(t.getAsFile());return}else I.warning(`不支持的文件类型: ${t.type}`)},previewVideoBeforeUpload(o){this.$refs.VideoUploader.open({file:o,callback:t=>{const l=new Date().valueOf().toString(),a=t.isLoop?"video-loop":"video";this.insertText(`[${a} ${l}](--------------------)`),ae(o,e=>{const p=Math.round(100*e.loaded/e.total)/10*2;this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${l}]\\((#*?)(-*?)\\)`),`[${a} ${l}](${"#".repeat(p)}${"-".repeat(20-p)})`)},t.thumbnail).then(e=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${l}]\\((#*?)(-*?)\\)`),`[${a} ${e.local}]`)}).catch(()=>{this.computedModelValue=this.computedModelValue.replace(new RegExp(`\\[${a} ${l}]\\((#*?)(-*?)\\)`),"")})}})}}},De={class:"fill"},He=["disabled"],Ue={key:1,class:"preview"},Pe={class:"bar"},Ce={class:"bar-left"},$e={class:"title"},Ae={class:"uploader"},je={class:"uploader"},Le={class:"bar-right"},Re={key:0,class:"is-save info"};function Te(o,t,l,a,e,c){const p=g("Markdown"),f=g("SvgIcon"),n=g("EmoteSelector"),y=g("el-popover"),s=g("ButtonBox"),v=g("VideoUploader");return u(),_(D,null,[d("div",re({class:"md-editor"},o.$attrs),[a.isEditMode?(u(),_("div",{key:0,class:R(["textarea-box",{"auto-height":l.autoHeight}])},[d("pre",De,M(a.computedModelValue),1),le(d("textarea",{ref:"textarea","onUpdate:modelValue":t[0]||(t[0]=r=>a.computedModelValue=r),class:"textarea",disabled:l.disabled,onPaste:t[1]||(t[1]=(...r)=>c.pasteHandler&&c.pasteHandler(...r)),onDragover:t[2]||(t[2]=ne(()=>{},["prevent"])),onDrop:t[3]||(t[3]=(...r)=>c.dropHandler&&c.dropHandler(...r))},null,40,He),[[se,a.computedModelValue]])],2)):(u(),_("div",Ue,[w(p,{"model-value":a.computedModelValue},null,8,["model-value"])])),d("div",Pe,[d("div",Ce,[l.disabled?k("",!0):(u(),_(D,{key:0},[d("div",$e,M(l.title),1),d("label",Ae,[w(f,{class:"button",name:"14"}),d("input",{type:"file",accept:"image/*",onChange:t[4]||(t[4]=r=>{a.previewImageBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),d("label",je,[w(f,{class:"button",name:"video"}),d("input",{type:"file",accept:"video/*",onChange:t[5]||(t[5]=r=>{c.previewVideoBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),w(y,{width:"auto",trigger:"click",effect:a.darkMode?"dark":"light"},{reference:x(()=>[w(f,{class:"button",name:"biaoqing"})]),default:x(()=>[w(n,{onSelect:t[6]||(t[6]=r=>{a.insertText(`[emoji ${r.scope}/${r.name}]`)})})]),_:1},8,["effect"])],64))]),d("div",Le,[a.isSave?(u(),_("span",Re,"已保存")):k("",!0),d("span",{class:"preview-switch button",onClick:t[7]||(t[7]=r=>a.isEditMode=!a.isEditMode)},M(a.isEditMode?"预览":"返回编辑"),1)])])],16),a.handlers.length>0?(u(),S(s,{key:0,handlers:a.handlers},null,8,["handlers"])):k("",!0),w(v,{ref:"VideoUploader"},null,512)],64)}const Ke=U(Ie,[["render",Te],["__scopeId","data-v-69a39bfc"]]),Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Ke as M,Ze as a,Be as u};
