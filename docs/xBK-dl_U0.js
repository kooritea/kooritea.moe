import{_ as T,A as N,S as B,r as g,c as I,k as u,b as p,f as k,F as h,B as w,n as D,g as z,l as v,e as S,z as y,Y as b,w as A,a as K,j as x,d as M,t as V}from"./assets/index--A2q1cxs.js";class f{constructor(e,t){this.x=e,this.y=t,this.key=String(Math.random())}}class C extends f{constructor(e,t){super(e,t),this.itemType="kabe"}}class _ extends f{constructor(e,t){super(e,t),this.itemType="box"}}class H extends f{constructor(e,t){super(e,t),this.itemType="target"}}class L extends f{constructor(e,t){super(e,t),this.itemType="neko"}}class F{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let t=0;t<e.length;t++){const o=e[t],i=[];this.instance.push(i);for(let r=0;r<o.length;r++){const m=o[r];let d=null;for(const c of m.split(""))switch(c){case"k":{d=new C(r,t);break}case"x":{const n=new _(r,t);this.boxs.push(n),d=n;break}case"o":{this.targets.push(new H(r,t));break}case"s":{const n=new L(r,t);this.neko=n,d=n;break}}i.push(d)}}}getItem({x:e,y:t}){var o;return(o=this.instance[t])==null?void 0:o[e]}getDirectionCoordinate({x:e,y:t},o){switch(o){case"2":{t=t+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{t=t-1;break}}return{x:e,y:t}}getNextItem({x:e,y:t},o){const i=this.getItem(this.getDirectionCoordinate({x:e,y:t},o));return i===void 0||i instanceof C?!1:i}moveItem({x:e,y:t},o){const i=this.getItem({x:e,y:t}),r=this.getDirectionCoordinate({x:e,y:t},o);i.x=r.x,i.y=r.y,this.instance[t][e]=null,this.instance[r.y][r.x]=i}}let $=class{constructor(e){this.map=new F(e)}get neko(){return this.map.neko}operate(e){const t=this.map.getNextItem(this.neko,e);if(t===!1)return!1;if(t===null&&this.map.moveItem(this.neko,e),t instanceof _){if(this.map.getNextItem(t,e)!==null)return!1;this.map.moveItem(t,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof _))}};const j={components:{AsyncButtom:N,SvgIcon:B},props:{map:{type:String,default:()=>""}},setup(l){const e=g(null),t=g(50),o=g(!1),i=function(){let n=[];const s=[];for(const a of l.map.split(","))a==="n"?(s.push(n),n=[]):n.push(a);e.value=K(new $(s)),o.value=!1};i();const r=function(n){n.preventDefault();const s={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(n.keyCode)];e.value.operate(s),o.value=e.value.check()},m=function(n,s){const a=e.value.neko;n-a.x===0&&s-a.y===1&&e.value.operate("2"),n-a.x===0&&s-a.y===-1&&e.value.operate("8"),n-a.x===1&&s-a.y===0&&e.value.operate("6"),n-a.x===-1&&s-a.y===0&&e.value.operate("4"),o.value=e.value.check()},d=I(()=>{var n,s;return((s=(n=e.value)==null?void 0:n.map)==null?void 0:s.targets)||[]}),c=function(n,s){return d.value.some(a=>a.x===n&&a.y===s)};return{mapInstance:I(()=>{var n,s;return((s=(n=e.value)==null?void 0:n.map)==null?void 0:s.instance)||[]}),isTarget:c,size:t,reset:i,congratulations:o,keyupHandler:r,touchMove:m}}},E={class:"sokoban-box"},Y=["onClick"],q={key:0,class:"congratulations"},G={class:"mask"},J={class:"buttons"};function O(l,e,t,o,i,r){const m=x("SvgIcon"),d=x("AsyncButtom");return u(),p("div",E,[k("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=b(c=>{c.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=b(c=>{c.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=b((...c)=>o.keyupHandler&&o.keyupHandler(...c),["stop"]))},[(u(!0),p(h,null,w(o.mapInstance,(c,n)=>(u(),p("div",{key:n,class:"row"},[(u(!0),p(h,null,w(c,(s,a)=>(u(),p("div",{key:(s==null?void 0:s.key)||a+n,class:D(["col",{[(s==null?void 0:s.itemType)||"empty"]:!0,target:o.isTarget(a,n)}]),style:z({width:`${o.size}px`,height:`${o.size}px`}),onClick:()=>{o.touchMove(a,n)}},[(s==null?void 0:s.itemType)==="neko"?(u(),p(h,{key:0},[v(" ðŸ˜¾ ")],64)):(s==null?void 0:s.itemType)==="box"?(u(),p(h,{key:1},[v(" ðŸ“¦ ")],64)):S("",!0)],14,Y))),128))]))),128)),o.congratulations?(u(),p("div",q," é€šå…³ ")):S("",!0),k("div",G,[e[3]||(e[3]=k("div",null," ç‚¹å‡»å¼€å§‹ ",-1)),k("div",null,[y(m,{name:"wasd"}),y(m,{name:"touch"})])])],32),k("div",J,[y(d,{type:"primary",onLoadingClick:o.reset},{default:A(()=>e[4]||(e[4]=[v(" é‡ç½® ")])),_:1},8,["onLoadingClick"])])])}const P=T(j,[["render",O],["__scopeId","data-v-7a64f7d8"]]),Q={components:{Sokoban:P},props:{content:{type:Array,default:()=>[]}}},R={key:1};function U(l,e,t,o,i,r){const m=x("Sokoban");return u(),p("div",null,[t.content[0]==="sokoban"?(u(),M(m,{key:0,map:t.content[1]},null,8,["map"])):(u(),p("span",R,"[component "+V(t.content)+" not found]",1))])}const Z=T(Q,[["render",U]]);export{Z as default};
